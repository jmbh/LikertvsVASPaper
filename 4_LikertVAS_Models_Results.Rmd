---
output: html_document
editor_options: 
  chunk_output_type: console
---

## Setup

```{r setup}

library(tidyverse)
library(brms)
library(psych)
library(ordbetareg)
library(magrittr)
library(tidybayes)        # Manipulate Stan objects in a tidy way
library(broom)            # Convert model objects to data frames
library(broom.mixed)      # Convert brms model objects to data frames
library(ggdist)           # Special geoms for posterior distributions
library(gghalves)         # Special half geoms
library(ggbeeswarm)       # Special distribution-shaped point jittering
library(ggrepel)          # Automatically position labels
library(patchwork)        # Combine ggplot objects
library(scales)           # Format numbers in nice ways
library(marginaleffects)  # Calculate marginal effects for regression models
library(modelsummary)     # Create side-by-side regression tables
library(ggthemes) # e.g. clean theme
library(tidybayes)
library(bayesplot)
library(gridExtra) # Arrange multiple plots in one
library(lme4) #ML models for correlations
library(sjPlot)
library(rsq)
library(emmeans)
library(posterior)

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))


```


## Data load

```{r}

#LikVAS <- readRDS("AggregateData_Fig1_Feb15_24_v2.RDS")

LikVAS <- readRDS("LikertvsVAS-main/Files/AggData.RDS")

durations <- readRDS("LikertvsVAS-main/Files/Duration.Rds")

NA_prop <- readRDS("NA_prop.RDS")

data_post <- readRDS("LikertvsVAS-main/Files/data_PostQuestions.RDS")

```

## Objects import

```{r objects.import}

##Import fitted models

load("figuredata.Rdata")

posterior_All1 <- figuredata[[1]]
posterior_All2 <- figuredata[[2]]

load("mod_Mean_zib_noLiktoVAS_fit.Rdata")
load("mod_SD_zib_noLiktoVAS_fit.Rdata")
load("mod_CorLag0_beta_noLiktoVAS_fit.Rdata")
load("mod_Skew_noLiktoVAS_fit.Rdata")
load("mod_RMSSD_zib_noLiktoVAS_fit.Rdata")
load("mod_AR_noLiktoVAS_fit.Rdata")
load("mod_Modality_noLiktoVAS_fit.Rdata")
load("mod_Mean_zib_fit.Rdata")
load("Model_BSI_group_fixed_fit.Rdata")
load("mod_IEB_noLiktoVAS_fit.Rdata")
load("mod_Missings_zoib_noVAS2Lik_fit.Rdata")
load("mod_duration_log_fit.Rdata")
load("model_post_fit.Rdata")

load("posterior_Variances.Rdata")

load("Model_BSI_group_fixed_fit.Rdata")

#Fitted model objects with Lik2VAS mapping included
load("mod_Mean_zib_fit.Rdata")
load("mod_CorLag0_beta_fit.Rdata")
load("mod_Skew_fit.Rdata")

##Couldn't upload this to github, too large - go down to Appendix figures -> Figure: pp Checks to create
# load("pp_figs.Rdata")
# 
# pp_Mean <- pp_figs[[1]]
# pp_SD <- pp_figs[[2]]
# pp_CorLag0 <- pp_figs[[3]]
# pp_Skew <- pp_figs[[4]]
# pp_RMSSD <- pp_figs[[5]]
# pp_AR <- pp_figs[[6]]
# pp_Modality <- pp_figs[[7]]

load("lv_m_long.Rdata")

load("EMM_EMV.Rdata")
#View(EMM_EMV %>% filter(Model == "Mean"))


```

## Marginal effects on Means

```{r results.EMM}

## Estimated marginal means with 90% credible intervals for Means

EMM_Mean <- mod_Mean_zib_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zi_"), "Zero", "Mu")),
         intercept = str_detect(.variable, "Intercept"),
         Model = "Mean") %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zi_formatVAS",
                                "valence" = "b_zi_valence",
                                "VAS:valence" = "b_zi_formatVAS:valence",
                                "Intercept" = "b_zi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw")) %>%
  mutate(Zero_Likert = plogis(Zero_Intercept),
         Zero_VAS = plogis(Zero_Intercept + Zero_VAS),
         Mean_Likert = (1-Zero_Likert)*plogis(Mu_Intercept),
         Mean_VAS = (1-Zero_VAS)*plogis(Mu_Intercept + Mu_VAS),
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Mean_Diff = Mean_VAS - Mean_Likert,
         Mean_Prop = Mean_VAS/Mean_Likert) %>%
  dplyr::summarise(
    Mean_Likert_Median = median(Mean_Likert),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_Diff_Median = median(Mean_Diff),
    Mean_Diff_Lower = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
    Mean_Diff_Upper = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high,
    Mean_Prop_Median = median(Mean_Prop),
    Mean_Prop_Lower = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_low,
    Mean_Prop_Upper = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_high
    ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "Mean")

## Estimated marginal means with 90% credible intervals for SDs

EMM_SD <- mod_SD_zib_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zi_"), "Zero", "Mean")),
         intercept = str_detect(.variable, "Intercept"),
         Model = "SD") %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zi_formatVAS",
                                "valence" = "b_zi_valence",
                                "VAS:valence" = "b_zi_formatVAS:valence",
                                "Intercept" = "b_zi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw")) %>%
  mutate(Zero_Likert = plogis(Zero_Intercept),
         Zero_VAS = plogis(Zero_Intercept + Zero_VAS),
         Mean_Likert = (1-Zero_Likert)*plogis(Mean_Intercept),
         Mean_VAS = (1-Zero_VAS)*plogis(Mean_Intercept + Mean_VAS),
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Mean_Diff = Mean_VAS - Mean_Likert,
         Mean_Prop = Mean_VAS/Mean_Likert) %>%
  summarise(
    Mean_Likert_Median = median(Mean_Likert),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_Diff_Median = median(Mean_Diff),
    Mean_Diff_Lower = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
    Mean_Diff_Upper = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high,
    Mean_Prop_Median = median(Mean_Prop),
    Mean_Prop_Lower = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_low,
    Mean_Prop_Upper = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_high
  ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "SD")

## Estimated marginal means with 90% credible intervals for SDs

EMM_CorLag0 <- mod_CorLag0_beta_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", "Mean"),
         intercept = str_detect(.variable, "Intercept"),
         Model = "CorLag0") %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw")) %>%
  mutate(Mean_Likert = plogis(Mean_Intercept),
         Mean_VAS = plogis(Mean_Intercept + Mean_VAS),
         Mean_Diff = Mean_VAS - Mean_Likert,
         Mean_Prop = Mean_VAS/Mean_Likert) %>%
  summarise(
    Mean_Likert_Median = median(Mean_Likert),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_Diff_Median = median(Mean_Diff),
    Mean_Diff_Lower = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
    Mean_Diff_Upper = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high,
    Mean_Prop_Median = median(Mean_Prop),
    Mean_Prop_Lower = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_low,
    Mean_Prop_Upper = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_high
  ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "CorLag0")

## Estimated marginal means with 90% credible intervals for Skewnesses

EMM_Skew <- mod_Skew_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "sigma_"), "Variance", "Mean"),
         intercept = str_detect(.variable, "Intercept"),
         Model = "Skew") %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_sigma_formatVAS",
                                "valence" = "b_sigma_valence",
                                "VAS:valence" = "b_sigma_formatVAS:valence",
                                "Intercept" = "b_sigma_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw")) %>%
  mutate(Mean_Likert = Mean_Intercept,
         Mean_VAS = Mean_Intercept + Mean_VAS,
         Mean_Diff = Mean_VAS - Mean_Likert,
         Mean_Prop = Mean_VAS/Mean_Likert) %>%
  summarise(
    Mean_Likert_Median = median(Mean_Likert),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_Diff_Median = median(Mean_Diff),
    Mean_Diff_Lower = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
    Mean_Diff_Upper = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high,
    Mean_Prop_Median = median(Mean_Prop),
    Mean_Prop_Lower = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_low,
    Mean_Prop_Upper = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_high
  ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "Skew")

## Estimated marginal means with 90% credible intervals for RMSSD

EMM_RMSSD <- mod_RMSSD_zib_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zi_"), "Zero", "Mean")),
         intercept = str_detect(.variable, "Intercept"),
         Model = "Mean") %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zi_formatVAS",
                                "valence" = "b_zi_valence",
                                "VAS:valence" = "b_zi_formatVAS:valence",
                                "Intercept" = "b_zi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw")) %>%
  mutate(Zero_Likert = plogis(Zero_Intercept),
         Zero_VAS = plogis(Zero_Intercept + Zero_VAS),
         Mean_Likert = (1-Zero_Likert)*plogis(Mean_Intercept),
         Mean_VAS = (1-Zero_VAS)*plogis(Mean_Intercept + Mean_VAS),
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Mean_Diff = Mean_VAS - Mean_Likert,
         Mean_Prop = Mean_VAS/Mean_Likert) %>%
  summarise(
    Mean_Likert_Median = median(Mean_Likert),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_Diff_Median = median(Mean_Diff),
    Mean_Diff_Lower = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
    Mean_Diff_Upper = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high,
    Mean_Prop_Median = median(Mean_Prop),
    Mean_Prop_Lower = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_low,
    Mean_Prop_Upper = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_high
  ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "RMSSD")

## Estimated marginal means with 90% credible intervals for Autocorrelations

EMM_AR <- mod_AR_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "sigma_"), "Variance", "Mean"),
         intercept = str_detect(.variable, "Intercept"),
         Model = "AR") %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_sigma_formatVAS",
                                "valence" = "b_sigma_valence",
                                "VAS:valence" = "b_sigma_formatVAS:valence",
                                "Intercept" = "b_sigma_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw")) %>%
  mutate(Mean_Likert = Mean_Intercept,
         Mean_VAS = Mean_Intercept + Mean_VAS,
         Mean_Diff = Mean_VAS - Mean_Likert,
         Mean_Prop = Mean_VAS/Mean_Likert) %>%
  summarise(
    Mean_Likert_Median = median(Mean_Likert),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_Diff_Median = median(Mean_Diff),
    Mean_Diff_Lower = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
    Mean_Diff_Upper = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high,
    Mean_Prop_Median = median(Mean_Prop),
    Mean_Prop_Lower = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_low,
    Mean_Prop_Upper = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_high
  ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "AR")

mmm <- mod_AR_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "sigma_"), "Variance", "Mean"),
         intercept = str_detect(.variable, "Intercept"),
         Model = "AR") %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_sigma_formatVAS",
                                "valence" = "b_sigma_valence",
                                "VAS:valence" = "b_sigma_formatVAS:valence",
                                "Intercept" = "b_sigma_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw")) %>%
  mutate(Mean_Likert = Mean_Intercept,
         Mean_VAS = Mean_Intercept + Mean_VAS,
         Mean_Diff = Mean_VAS - Mean_Likert,
         Mean_Prop = Mean_VAS/Mean_Likert)

hist(mmm$Mean_VAS)
describe(mmm$Mean_VAS)
bayestestR::hdi(mmm$Mean_VAS, ci = .9, )

## Estimated marginal means with 90% credible intervals for IEB

EMM_IEB <- mod_IEB_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "sigma_"), "Variance", "Mean"),
         intercept = str_detect(.variable, "Intercept"),
         Model = "Skew") %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_sigma_formatVAS",
                                "valence" = "b_sigma_valence",
                                "VAS:valence" = "b_sigma_formatVAS:valence",
                                "Intercept" = "b_sigma_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw")) %>%
  mutate(Mean_Likert = plogis(Mean_Intercept),
         Mean_VAS = plogis(Mean_Intercept + Mean_VAS),
         Mean_Diff = Mean_VAS - Mean_Likert,
         Mean_Prop = Mean_VAS/Mean_Likert) %>%
  summarise(
    Mean_Likert_Median = median(Mean_Likert),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_Diff_Median = median(Mean_Diff),
    Mean_Diff_Lower = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
    Mean_Diff_Upper = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high,
    Mean_Prop_Median = median(Mean_Prop),
    Mean_Prop_Lower = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_low,
    Mean_Prop_Upper = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_high
  ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "IEB")

## Estimated marginal means with 90% credible intervals for Modality

EMM_Modality <- mod_Modality_noLiktoVAS_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = "Mean",
         intercept = str_detect(.variable, "Intercept")) %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "Intercept" = "b_Intercept",
                                "Valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence"
                                )) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw")) %>%
  mutate(Mean_Likert = exp(Mean_Intercept),
         Mean_VAS = exp(Mean_Intercept + Mean_VAS),
         Mean_Diff = (Mean_VAS - Mean_Likert),
         Mean_Prop = Mean_VAS/Mean_Likert) %>%
  summarise(
    Mean_Likert_Median = median(Mean_Likert),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_Diff_Median = median(Mean_Diff),
    Mean_Diff_Lower = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
    Mean_Diff_Upper = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high,
    Mean_Prop_Median = median(Mean_Prop),
    Mean_Prop_Lower = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_low,
    Mean_Prop_Upper = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_high
  ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "Modality")

## Estimated marginal means with 90% credible intervals for Missings

EMM_Missings <- mod_Missings_zoib_noVAS2Lik_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zoi_"), "Zero/One", ifelse(str_detect(.variable, "coi_"), "One","Mean"))),
         intercept = str_detect(.variable, "Intercept")) %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zoi_formatVAS",
                                "Intercept" = "b_zoi_Intercept",
                                "VAS" = "b_coi_formatVAS",
                                "Intercept" = "b_coi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw")) %>%
  mutate(Zero_Likert = plogis(`Zero/One_Intercept`) - plogis(One_Intercept)*plogis(`Zero/One_Intercept`),
         Zero_VAS = plogis(`Zero/One_Intercept` + `Zero/One_VAS`) - plogis(One_Intercept + One_VAS)*plogis(`Zero/One_Intercept` + `Zero/One_VAS`),
         One_Likert = plogis(One_Intercept)*plogis(`Zero/One_Intercept`),
         One_VAS = plogis(One_Intercept + One_VAS)*plogis(`Zero/One_Intercept` + `Zero/One_VAS`),
         Mean_Likert = Zero_Likert*0 + (1 - Zero_Likert - One_Likert)*plogis(Mean_Intercept) + One_Likert*1,
         Mean_VAS = Zero_VAS*0 + (1-Zero_VAS - One_VAS)*plogis(Mean_Intercept + Mean_VAS) + One_VAS*1,
         Mean_Diff = (Mean_VAS - Mean_Likert),
         Mean_Prop = Mean_VAS/Mean_Likert) %>%
  summarise(
    Mean_Likert_Median = median(Mean_Likert),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_Diff_Median = median(Mean_Diff),
    Mean_Diff_Lower = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
    Mean_Diff_Upper = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high,
    Mean_Prop_Median = median(Mean_Prop),
    Mean_Prop_Lower = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_low,
    Mean_Prop_Upper = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_high
  ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "Missings")

## Estimated marginal means with 90% credible intervals for Durations

#Computed from posterior predictive draws because the implemented likelihood of the lognormal model in brms is unclear
#(i.e., marginal means and variances cannot be directly derived from posterior estimates)

durations$Lik$format <- "Likert"
durations$VAS$format <- "VAS"
duration <- rbind(durations$Lik,
              durations$VAS)
duration %<>%
  pivot_longer(c("Dur_Morning", "Dur_Day", "Dur_Evening"),
               names_to = "period",
               values_to = "duration"
  ) %>%
  mutate(ID = row.names(.))
describeBy(duration$duration, duration$format)

duration_pred <- posterior_predict(mod_duration_log_fit)

posterior_duration_Mean <- duration_pred %>%
  as.data.frame() %>%
  mutate(draw = row.names(.)) %>%
  pivot_longer(cols = -draw,
               names_to = "ID",
               values_to = "value") %>%
  mutate(ID = str_remove(ID, "V")) %>%
  merge(duration, by = "ID", all.x = TRUE, all.y = TRUE) %>%
  group_by(draw, format) %>%
  summarize(Mean = mean(value)) %>%
  pivot_wider(values_from = Mean, names_from = format) %>%
  rename(Mean_Likert = Likert,
         Mean_VAS = VAS) %>%
  mutate(Mean_Diff = Mean_VAS - Mean_Likert,
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Mean_Prop = Mean_Likert/Mean_VAS) %>%
  ungroup()

EMM_duration <- posterior_duration_Mean %>%
  ungroup() %>%
    dplyr::summarize(
    Mean_duration_Likert_Median = median(Mean_Likert),
    Mean_duration_Likert_Lower = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
    Mean_duration_Likert_Upper = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
    Mean_duration_VAS_Median = median(Mean_VAS),
    Mean_duration_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_duration_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_duration_Diff_Median = median(Mean_Diff),
    Mean_duration_Diff_Lower = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
    Mean_duration_Diff_Upper = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high,
    Mean_duration_Prop_Median = median(Mean_Prop),
    Mean_duration_Prop_Lower = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_low,
    Mean_duration_Prop_Upper = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_high
    ) %>% pivot_longer(cols = everything(),
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$") %>% select(-Component)

posterior_duration_Mean_long <- posterior_duration_Mean %>%
    pivot_longer(cols = c(Mean_Likert, Mean_VAS, Mean_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = "duration")
# 
# EMM_duration <- mod_duration_log_fit %>% 
#   gather_draws(`b_.*`, regex = TRUE) %>% 
#   mutate(component = ifelse(str_detect(.variable, "sigma_"), "Variance", "Mean"),
#          intercept = str_detect(.variable, "Intercept")) %>%
#   mutate(.variable = fct_recode(.variable,
#                                 "VAS" = "b_formatVAS",
#                                 "Intercept" = "b_Intercept",
#                                 "VAS" = "b_sigma_formatVAS",
#                                 "Intercept" = "b_sigma_Intercept")) %>%
#   mutate(.variable = fct_relevel(.variable,
#                                  c("Intercept", "VAS"))) %>%
#   mutate(.variable = fct_relevel(.variable,
#                                  c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
#   pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
#               id_cols = c(".chain", ".iteration", ".draw")) %>%
#   mutate(Mean_Likert = exp(Mean_Intercept),
#          Mean_VAS = exp(Mean_Intercept + Mean_VAS),
#          Mean_Diff = (Mean_VAS - Mean_Likert)) %>%
#   summarise(
#     Mean_Likert_Median = median(Mean_Likert),
#     Mean_Likert_Lower = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
#     Mean_Likert_Upper = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
#     Mean_VAS_Median = median(Mean_VAS),
#     Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
#     Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
#     Mean_Diff_Median = median(Mean_Diff),
#     Mean_Diff_Lower = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
#     Mean_Diff_Upper = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high
#   ) %>%
#   pivot_longer(cols = everything(),
#                names_to = c(".value", "Estimate"),
#                names_pattern = "^Mean_(.*)_(.*)$") %>%
#   mutate(Model = "duration")

## Post questionnaire

posterior_post <- model_post_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "disc_"), "Variance", "Mean"),
         intercept = str_detect(.variable, "Intercept")) %>%
  mutate(.variable = str_remove(.variable, "^b_disc_")) %>%
  mutate(.variable = str_remove(.variable, "^b_")) %>%
  separate(.variable, into = c("Variable", "Parameter"), sep = "_")

posterior_post_wider <- posterior_post %>%
  pivot_wider(names_from = "Parameter",
              values_from = ".value",
              id_cols = c("component", "Variable", ".draw"))

EMM_post <- posterior_post_wider %>%
  filter(component == "Mean") %>%
  group_by(Variable) %>%
  mutate(Mean_VAS = plogis(`Intercept[1]`)*1
                   + (plogis(`Intercept[2]` - GroupVAS) - plogis(`Intercept[1]` - GroupVAS))*2
                   + (plogis(`Intercept[3]` - GroupVAS) - plogis(`Intercept[2]` - GroupVAS))*3
                   + (plogis(`Intercept[4]` - GroupVAS) - plogis(`Intercept[3]` - GroupVAS))*4
                   + (plogis(`Intercept[5]` - GroupVAS) - plogis(`Intercept[4]` - GroupVAS))*5
                   + (plogis(`Intercept[6]` - GroupVAS) - plogis(`Intercept[5]` - GroupVAS))*6
                   + (1 - plogis(`Intercept[6]`))*7,
                   Mean_Likert = plogis(`Intercept[1]`)*1
                   + (plogis(`Intercept[2]`) - plogis(`Intercept[1]`))*2
                   + (plogis(`Intercept[3]`) - plogis(`Intercept[2]`))*3
                   + (plogis(`Intercept[4]`) - plogis(`Intercept[3]`))*4
                   + (plogis(`Intercept[5]`) - plogis(`Intercept[4]`))*5
                   + (plogis(`Intercept[6]`) - plogis(`Intercept[5]`))*6
                   + (1 - plogis(`Intercept[6]`))*7,
         Mean_Diff = Mean_VAS - Mean_Likert,
         Mean_Prop = Mean_VAS/Mean_Likert
                   ) %>%
  mutate(Var_Likert = (1-Mean_Likert)^2*plogis(`Intercept[1]`)
         + (2-Mean_Likert)^2*(plogis(`Intercept[2]`) - plogis(`Intercept[1]`))
         + (3-Mean_Likert)^2*(plogis(`Intercept[3]`) - plogis(`Intercept[2]`))
         + (4-Mean_Likert)^2*(plogis(`Intercept[4]`) - plogis(`Intercept[3]`))
         + (5-Mean_Likert)^2*(plogis(`Intercept[5]`) - plogis(`Intercept[4]`))
         + (6-Mean_Likert)^2*(plogis(`Intercept[6]`) - plogis(`Intercept[5]`))
         + (7-Mean_Likert)^2*(1 - plogis(`Intercept[6]`)),
         Var_VAS = (1-Mean_VAS)^2*plogis(`Intercept[1]` - GroupVAS)
         + (2-Mean_VAS)^2*(plogis(`Intercept[2]` - GroupVAS) - plogis(`Intercept[1]` - GroupVAS))
         + (3-Mean_VAS)^2*(plogis(`Intercept[3]` - GroupVAS) - plogis(`Intercept[2]` - GroupVAS))
         + (4-Mean_VAS)^2*(plogis(`Intercept[4]` - GroupVAS) - plogis(`Intercept[3]` - GroupVAS))
         + (5-Mean_VAS)^2*(plogis(`Intercept[5]` - GroupVAS) - plogis(`Intercept[4]` - GroupVAS))
         + (6-Mean_VAS)^2*(plogis(`Intercept[6]` - GroupVAS) - plogis(`Intercept[5]` - GroupVAS))
         + (7-Mean_VAS)^2*(1 - plogis(`Intercept[6]` - GroupVAS)),
         Var_Diff = Var_VAS - Var_Likert) %>%
  dplyr::summarise(Mean_Likert_Median = median(Mean_Likert),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_Diff_Median = median(Mean_Diff),
    Mean_Diff_Lower = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
    Mean_Diff_Upper = bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high,
    Mean_Prop_Median = median(Mean_Prop),
    Mean_Prop_Lower = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_low,
    Mean_Prop_Upper = bayestestR::hdi(Mean_Prop, ci = 0.9)$CI_high) %>%
  mutate(Model = fct_recode(Variable,
                            "Post_Burden" = "Burden",
                            "Post_Clear" = "Clear",
                            "Post_ExpNotif" = "ExpNotif",
                            "Post_Freq" = "Freq",
                            "Post_Infl" = "Infl",
                            "Post_KnowAnswer" = "KnowAnswer")) %>%
  select(-Variable) %>%
  pivot_longer(cols = c(Mean_Likert_Median:Mean_Prop_Upper),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$")

EMM <- rbind(EMM_Mean,
             EMM_SD,
             EMM_CorLag0,
             EMM_Skew,
             EMM_RMSSD,
             EMM_AR,
             EMM_IEB,
             EMM_Modality,
             EMM_Missings,
             EMM_duration,
             EMM_post)
EMM$Component <- "Mean"

save(EMM, file = "EMM.Rdata")

```

## Marginal effects on variances, zeros and ones

```{r fig.vars}

posterior_Mean <- mod_Mean_zib_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zi_"), "Zero", "Mean")),
         intercept = str_detect(.variable, "Intercept"),
         Model = "Mean")

posterior_SD <- mod_SD_zib_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zi_"), "Zero", "Mean")),
         intercept = str_detect(.variable, "Intercept"),
         Model = "SD")

posterior_CorLag0 <- mod_CorLag0_beta_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", "Mean"),
         intercept = str_detect(.variable, "Intercept"),
         Model = "CorLag0")

posterior_Skew <- mod_Skew_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "sigma_"), "Variance", "Mean"),
         intercept = str_detect(.variable, "Intercept"),
         Model = "Skew")

posterior_RMSSD <- mod_RMSSD_zib_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zi_"), "Zero", "Mean")),
         intercept = str_detect(.variable, "Intercept"),
         Model = "RMSSD")

posterior_AR <- mod_AR_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "sigma_"), "Variance", "Mean"),
         intercept = str_detect(.variable, "Intercept"),
         Model = "AR")

posterior_IEB <- mod_IEB_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "sigma_"), "Variance", "Mean"),
         intercept = str_detect(.variable, "Intercept"),
         Model = "IEB")

posterior_Missings <- mod_Missings_zoib_noVAS2Lik_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zoi_"), "Zero/One", ifelse(str_detect(.variable, "coi_"), "One","Mean"))),
         intercept = str_detect(.variable, "Intercept"))

posterior_duration <- mod_duration_log_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "sigma_"), "Variance", "Mean"),
         intercept = str_detect(.variable, "Intercept"))

#Plotting

posterior_Mean_wider <- posterior_Mean %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zi_formatVAS",
                                "valence" = "b_zi_valence",
                                "VAS:valence" = "b_zi_formatVAS:valence",
                                "Intercept" = "b_zi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw"))


posterior_Mean_Variance <- posterior_Mean_wider %>%
  mutate(Zero_Likert = plogis(Zero_Intercept),
         Zero_VAS = plogis(Zero_Intercept + Zero_VAS),
         Zero_Diff = Zero_VAS - Zero_Likert,
         Zero_Prop = Zero_VAS/Zero_Likert,
         Mean_Likert = Zero_Likert*0 + (1 - Zero_Likert)*plogis(Mean_Intercept),
         Mean_VAS = Zero_VAS*0 + (1-Zero_VAS)*plogis(Mean_Intercept + Mean_VAS),
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Precision_VAS = Precision_Intercept + Precision_VAS,
         Var_Likert = Zero_Likert*0 + (1-Zero_Likert)*(Mean_Likert*(1-Mean_Likert)/(1 + Precision_Intercept)) + Zero_Likert*(0 - Mean_Likert)^2 + (1 - Zero_Likert)*(plogis(Mean_Intercept) - Mean_Likert)^2,
         Var_VAS = Zero_VAS*0 + (1-Zero_VAS)*(Mean_VAS*(1-Mean_VAS)/(1 + Precision_Intercept)) + Zero_VAS*(0 - Mean_VAS)^2 + (1 - Zero_VAS)*(plogis(Mean_Intercept) - Mean_VAS)^2,
         Var_Total = (Var_Likert + Var_VAS)/2,
         Var_Diff = Var_VAS - Var_Likert,
         Var_Prop = Var_VAS/Var_Likert)
#Var(X)=p1​Var(X1​)+p2​Var(X2​)+p1​(μ1​−μ)2+p2​(μ2​−μ)2

posterior_Mean_Variance_long <- posterior_Mean_Variance %>%
  pivot_longer(cols = c(Var_Likert, Var_VAS, Var_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = "Mean")

posterior_Mean_Variance_summary_stats <- posterior_Mean_Variance %>%
  summarise(
    Var_Mean_Likert_Median = median(Var_Likert),
    Var_Mean_Likert_Lower = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_low,
    Var_Mean_Likert_Upper = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_high,
    Var_Mean_VAS_Median = median(Var_VAS),
    Var_Mean_VAS_Lower = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_low,
    Var_Mean_VAS_Upper = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_high,
    Var_Mean_Diff_Median = median(Var_Diff),
    Var_Mean_Diff_Lower = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_low,
    Var_Mean_Diff_Upper = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_high,
    Var_Mean_Prop_Median = median(Var_Prop),
    Var_Mean_Prop_Lower = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_low,
    Var_Mean_Prop_Upper = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_high,
    Zero_Mean_Likert_Median = median(Zero_Likert),
    Zero_Mean_Likert_Lower = bayestestR::hdi(Zero_Likert, ci = 0.9)$CI_low,
    Zero_Mean_Likert_Upper = bayestestR::hdi(Zero_Likert, ci = 0.9)$CI_high,
    Zero_Mean_VAS_Median = median(Zero_VAS),
    Zero_Mean_VAS_Lower = bayestestR::hdi(Zero_VAS, ci = 0.9)$CI_low,
    Zero_Mean_VAS_Upper = bayestestR::hdi(Zero_VAS, ci = 0.9)$CI_high,
    Zero_Mean_Diff_Median = median(Zero_Diff),
    Zero_Mean_Diff_Lower = bayestestR::hdi(Zero_Diff, ci = 0.9)$CI_low,
    Zero_Mean_Diff_Upper = bayestestR::hdi(Zero_Diff, ci = 0.9)$CI_high,
    Zero_Mean_Prop_Median = median(Zero_Prop),
    Zero_Mean_Prop_Lower = bayestestR::hdi(Zero_Prop, ci = 0.9)$CI_low,
    Zero_Mean_Prop_Upper = bayestestR::hdi(Zero_Prop, ci = 0.9)$CI_high,
  )  %>%
  pivot_longer(cols = everything(),
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$")
# 
# #Proportions of zeros and variances of VAS in comparison to Likert
# View(posterior_Mean_Variance_summary_stats)
# 
# Var_Mean_Likert <- lv_m_long %>%
#   filter(format == "Likert") %>%
#   dplyr::select(Mean) %>% as.data.frame() %>% summarize(Var_Lik = sd(Mean)^2)
# Var_Mean_VAS <- lv_m_long %>%
#   filter(format == "VAS") %>%
#   dplyr::select(Mean) %>% as.data.frame() %>% summarize(Var_Lik = sd(Mean)^2)
# Var_Mean_Total <- lv_m_long %>%
#   filter(format == "VAS" | format == "Likert") %>%
#   dplyr::select(Mean) %>% as.data.frame() %>% summarize(Var_Lik = sd(Mean)^2)
# Var_Mean_Diff = Var_Mean_VAS - Var_Mean_Likert
# Var_Mean_Diff
# posterior_Mean_Variance_summary_stats$Var_Mean_Diff_Median
# 
# ggplot(posterior_Mean_Variance_long, aes(x = value, y = fct_relevel(Parameter,
#                                                                     c("Var_Likert", "Var_VAS", "Var_Diff")))) +
#   geom_vline(xintercept = 0) +
#   stat_halfeye(aes(slab_alpha = value), 
#                .width = c(0.9, 0.9), point_interval = "median_hdi") +
#   scale_fill_viridis_d(option = "viridis", end = 0.6) +
#   scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
#   guides(fill = "none", slab_alpha = "none") +
#   labs(x = "Coefficient", y = "Parameter") +
#   ggthemes::theme_clean()
# 
# ggsave("ridge_Mean_Var.pdf", dpi = 450, width = 7, height = 7)


## SDs

posterior_SD_wider <- posterior_SD %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zi_formatVAS",
                                "valence" = "b_zi_valence",
                                "VAS:valence" = "b_zi_formatVAS:valence",
                                "Intercept" = "b_zi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw"))


posterior_SD_Variance <- posterior_SD_wider %>%
  mutate(Zero_Likert = plogis(Zero_Intercept),
         Zero_VAS = plogis(Zero_Intercept + Zero_VAS),
         Zero_Diff = Zero_VAS - Zero_Likert,
         Zero_Prop = Zero_VAS/Zero_Likert,
         Mean_Likert = Zero_Likert*0 + (1 - Zero_Likert)*plogis(Mean_Intercept),
         Mean_VAS = Zero_VAS*0 + (1-Zero_VAS)*plogis(Mean_Intercept + Mean_VAS),
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Precision_VAS = Precision_Intercept + Precision_VAS,
         Var_Likert = Zero_Likert*0 + (1-Zero_Likert)*(Mean_Likert*(1-Mean_Likert)/(1 + Precision_Intercept)) + Zero_Likert*(0 - Mean_Likert)^2 + (1 - Zero_Likert)*(plogis(Mean_Intercept) - Mean_Likert)^2,
         Var_VAS = Zero_VAS*0 + (1-Zero_VAS)*(Mean_VAS*(1-Mean_VAS)/(1 + Precision_Intercept)) + Zero_VAS*(0 - Mean_VAS)^2 + (1 - Zero_VAS)*(plogis(Mean_Intercept) - Mean_VAS)^2,
         Var_Total = (Var_Likert + Var_VAS)/2,
         Var_Diff = Var_VAS - Var_Likert,
         Var_Prop = Var_VAS/Var_Likert)

posterior_SD_Variance_long <- posterior_SD_Variance %>%
  pivot_longer(cols = c(Var_Likert, Var_VAS, Var_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = "SD")

posterior_SD_Variance_summary_stats <- posterior_SD_Variance %>%
  summarise(
    Var_SD_Likert_Median = median(Var_Likert),
    Var_SD_Likert_Lower = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_low,
    Var_SD_Likert_Upper = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_high,
    Var_SD_VAS_Median = median(Var_VAS),
    Var_SD_VAS_Lower = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_low,
    Var_SD_VAS_Upper = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_high,
    Var_SD_Diff_Median = median(Var_Diff),
    Var_SD_Diff_Lower = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_low,
    Var_SD_Diff_Upper = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_high,
    Var_SD_Prop_Median = median(Var_Prop),
    Var_SD_Prop_Lower = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_low,
    Var_SD_Prop_Upper = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_high,
    Zero_SD_Likert_Median = median(Zero_Likert),
    Zero_SD_Likert_Lower = bayestestR::hdi(Zero_Likert, ci = 0.9)$CI_low,
    Zero_SD_Likert_Upper = bayestestR::hdi(Zero_Likert, ci = 0.9)$CI_high,
    Zero_SD_VAS_Median = median(Zero_VAS),
    Zero_SD_VAS_Lower = bayestestR::hdi(Zero_VAS, ci = 0.9)$CI_low,
    Zero_SD_VAS_Upper = bayestestR::hdi(Zero_VAS, ci = 0.9)$CI_high,
    Zero_SD_Diff_Median = median(Zero_Diff),
    Zero_SD_Diff_Lower = bayestestR::hdi(Zero_Diff, ci = 0.9)$CI_low,
    Zero_SD_Diff_Upper = bayestestR::hdi(Zero_Diff, ci = 0.9)$CI_high,
    Zero_SD_Prop_Median = median(Zero_Prop),
    Zero_SD_Prop_Lower = bayestestR::hdi(Zero_Prop, ci = 0.9)$CI_low,
    Zero_SD_Prop_Upper = bayestestR::hdi(Zero_Prop, ci = 0.9)$CI_high
  )  %>%
  pivot_longer(cols = everything(),
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$")

#View(posterior_SD_Variance_summary_stats)

## Correlations

posterior_CorLag0_wider <- posterior_CorLag0 %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw"))


posterior_CorLag0_Variance <- posterior_CorLag0_wider %>%
  mutate(Mean_Likert = plogis(Mean_Intercept),
         Mean_VAS = plogis(Mean_Intercept + Mean_VAS),
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Precision_VAS = Precision_Intercept + Precision_VAS,
         Var_Likert = Mean_Likert*(1-Mean_Likert)/(1 + Precision_Intercept),
         Var_VAS = Mean_VAS*(1-Mean_VAS)/(1 + Precision_Intercept),
         Var_Total = (Var_Likert + Var_VAS)/2,
         Var_Diff = Var_VAS - Var_Likert,
         Var_Prop = Var_VAS/Var_Likert)

posterior_CorLag0_Variance_long <- posterior_CorLag0_Variance %>%
  pivot_longer(cols = c(Var_Likert, Var_VAS, Var_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = "CorLag0")

posterior_CorLag0_Variance_summary_stats <- posterior_CorLag0_Variance %>%
  summarise(
    Var_CorLag0_Likert_Median = median(Var_Likert),
    Var_CorLag0_Likert_Lower = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_low,
    Var_CorLag0_Likert_Upper = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_high,
    Var_CorLag0_VAS_Median = median(Var_VAS),
    Var_CorLag0_VAS_Lower = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_low,
    Var_CorLag0_VAS_Upper = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_high,
    Var_CorLag0_Diff_Median = median(Var_Diff),
    Var_CorLag0_Diff_Lower = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_low,
    Var_CorLag0_Diff_Upper = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_high,
    Var_CorLag0_Prop_Median = median(Var_Prop),
    Var_CorLag0_Prop_Lower = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_low,
    Var_CorLag0_Prop_Upper = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_high
  )  %>%
  pivot_longer(cols = everything(),
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$")

## Skewnesses

posterior_Skew_wider <- posterior_Skew %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_sigma_formatVAS",
                                "valence" = "b_sigma_valence",
                                "VAS:valence" = "b_sigma_formatVAS:valence",
                                "Intercept" = "b_sigma_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw"))


posterior_Skew_Variance <- posterior_Skew_wider %>%
  mutate(Mean_Likert = Mean_Intercept,
         Mean_VAS = Mean_Intercept + Mean_VAS,
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Var_Likert = exp(Variance_Intercept)^2,
         Var_VAS = exp(Variance_Intercept + Variance_VAS)^2,
         Var_Total = (Var_Likert + Var_VAS)/2,
         Var_Diff = Var_VAS - Var_Likert,
         Var_Prop = Var_VAS/Var_Likert)

posterior_Skew_Variance_long <- posterior_Skew_Variance %>%
  pivot_longer(cols = c(Var_Likert, Var_VAS, Var_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = "Skew")

posterior_Skew_Variance_summary_stats <- posterior_Skew_Variance %>%
  summarise(
    Var_Skew_Likert_Median = median(Var_Likert),
    Var_Skew_Likert_Lower = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_low,
    Var_Skew_Likert_Upper = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_high,
    Var_Skew_VAS_Median = median(Var_VAS),
    Var_Skew_VAS_Lower = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_low,
    Var_Skew_VAS_Upper = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_high,
    Var_Skew_Diff_Median = median(Var_Diff),
    Var_Skew_Diff_Lower = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_low,
    Var_Skew_Diff_Upper = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_high,
    Var_Skew_Prop_Median = median(Var_Prop),
    Var_Skew_Prop_Lower = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_low,
    Var_Skew_Prop_Upper = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_high
  )  %>%
  pivot_longer(cols = everything(),
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$")

## RMSSDs

posterior_RMSSD_wider <- posterior_RMSSD %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zi_formatVAS",
                                "valence" = "b_zi_valence",
                                "VAS:valence" = "b_zi_formatVAS:valence",
                                "Intercept" = "b_zi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw"))


posterior_RMSSD_Variance <- posterior_RMSSD_wider %>%
  mutate(Zero_Likert = plogis(Zero_Intercept),
         Zero_VAS = plogis(Zero_Intercept + Zero_VAS),
         Zero_Diff = Zero_VAS - Zero_Likert,
         Zero_Prop = Zero_VAS/Zero_Likert,
         Mean_Likert = Zero_Likert*0 + (1 - Zero_Likert)*plogis(Mean_Intercept),
         Mean_VAS = Zero_VAS*0 + (1-Zero_VAS)*plogis(Mean_Intercept + Mean_VAS),
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Precision_VAS = Precision_Intercept + Precision_VAS,
         Var_Likert = Zero_Likert*0 + (1-Zero_Likert)*(Mean_Likert*(1-Mean_Likert)/(1 + Precision_Intercept)) + Zero_Likert*(0 - Mean_Likert)^2 + (1 - Zero_Likert)*(plogis(Mean_Intercept) - Mean_Likert)^2,
         Var_VAS = Zero_VAS*0 + (1-Zero_VAS)*(Mean_VAS*(1-Mean_VAS)/(1 + Precision_Intercept)) + Zero_VAS*(0 - Mean_VAS)^2 + (1 - Zero_VAS)*(plogis(Mean_Intercept) - Mean_VAS)^2,
         Var_Total = (Var_Likert + Var_VAS)/2,
         Var_Diff = Var_VAS - Var_Likert,
         Var_Prop = Var_VAS/Var_Likert)

posterior_RMSSD_Variance_long <- posterior_RMSSD_Variance %>%
  pivot_longer(cols = c(Var_Likert, Var_VAS, Var_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = "RMSSD")

posterior_RMSSD_Variance_summary_stats <- posterior_RMSSD_Variance %>%
  summarise(
    Var_RMSSD_Likert_Median = median(Var_Likert),
    Var_RMSSD_Likert_Lower = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_low,
    Var_RMSSD_Likert_Upper = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_high,
    Var_RMSSD_VAS_Median = median(Var_VAS),
    Var_RMSSD_VAS_Lower = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_low,
    Var_RMSSD_VAS_Upper = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_high,
    Var_RMSSD_Diff_Median = median(Var_Diff),
    Var_RMSSD_Diff_Lower = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_low,
    Var_RMSSD_Diff_Upper = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_high,
    Var_RMSSD_Prop_Median = median(Var_Prop),
    Var_RMSSD_Prop_Lower = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_low,
    Var_RMSSD_Prop_Upper = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_high,
    Zero_RMSSD_Likert_Median = median(Zero_Likert),
    Zero_RMSSD_Likert_Lower = bayestestR::hdi(Zero_Likert, ci = 0.9)$CI_low,
    Zero_RMSSD_Likert_Upper = bayestestR::hdi(Zero_Likert, ci = 0.9)$CI_high,
    Zero_RMSSD_VAS_Median = median(Zero_VAS),
    Zero_RMSSD_VAS_Lower = bayestestR::hdi(Zero_VAS, ci = 0.9)$CI_low,
    Zero_RMSSD_VAS_Upper = bayestestR::hdi(Zero_VAS, ci = 0.9)$CI_high,
    Zero_RMSSD_Diff_Median = median(Zero_Diff),
    Zero_RMSSD_Diff_Lower = bayestestR::hdi(Zero_Diff, ci = 0.9)$CI_low,
    Zero_RMSSD_Diff_Upper = bayestestR::hdi(Zero_Diff, ci = 0.9)$CI_high,
    Zero_RMSSD_Prop_Median = median(Zero_Prop),
    Zero_RMSSD_Prop_Lower = bayestestR::hdi(Zero_Prop, ci = 0.9)$CI_low,
    Zero_RMSSD_Prop_Upper = bayestestR::hdi(Zero_Prop, ci = 0.9)$CI_high
  )  %>%
  pivot_longer(cols = everything(),
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$")


## AR

posterior_AR_wider <- posterior_AR %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_sigma_formatVAS",
                                "valence" = "b_sigma_valence",
                                "VAS:valence" = "b_sigma_formatVAS:valence",
                                "Intercept" = "b_sigma_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw"))


posterior_AR_Variance <- posterior_AR_wider %>%
  mutate(Mean_Likert = Mean_Intercept,
         Mean_VAS = Mean_Intercept + Mean_VAS,
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Var_Likert = exp(Variance_Intercept)^2,
         Var_VAS = exp(Variance_Intercept + Variance_VAS)^2,
         Var_Total = (Var_Likert + Var_VAS)/2,
         Var_Diff = Var_VAS - Var_Likert,
         Var_Prop = Var_VAS/Var_Likert)

posterior_AR_Variance_long <- posterior_AR_Variance %>%
  pivot_longer(cols = c(Var_Likert, Var_VAS, Var_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = "AR")

posterior_AR_Variance_summary_stats <- posterior_AR_Variance %>%
  summarise(
    Var_AR_Likert_Median = median(Var_Likert),
    Var_AR_Likert_Lower = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_low,
    Var_AR_Likert_Upper = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_high,
    Var_AR_VAS_Median = median(Var_VAS),
    Var_AR_VAS_Lower = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_low,
    Var_AR_VAS_Upper = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_high,
    Var_AR_Diff_Median = median(Var_Diff),
    Var_AR_Diff_Lower = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_low,
    Var_AR_Diff_Upper = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_high,
    Var_AR_Prop_Median = median(Var_Prop),
    Var_AR_Prop_Lower = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_low,
    Var_AR_Prop_Upper = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_high
  )  %>%
  pivot_longer(cols = everything(),
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$")

## IEB

posterior_IEB_wider <- posterior_IEB %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_sigma_formatVAS",
                                "valence" = "b_sigma_valence",
                                "VAS:valence" = "b_sigma_formatVAS:valence",
                                "Intercept" = "b_sigma_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw"))


posterior_IEB_Variance <- posterior_IEB_wider %>%
  mutate(Mean_Likert = Mean_Intercept,
         Mean_VAS = Mean_Intercept + Mean_VAS,
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Var_Likert = exp(Variance_Intercept)^2,
         Var_VAS = exp(Variance_Intercept + Variance_VAS)^2,
         Var_Total = (Var_Likert + Var_VAS)/2,
         Var_Diff = Var_VAS - Var_Likert,
         Var_Prop = Var_VAS/Var_Likert)

posterior_IEB_Variance_long <- posterior_IEB_Variance %>%
  pivot_longer(cols = c(Var_Likert, Var_VAS, Var_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = "IEB")

posterior_IEB_Variance_summary_stats <- posterior_IEB_Variance %>%
  summarise(
    Var_IEB_Likert_Median = median(Var_Likert),
    Var_IEB_Likert_Lower = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_low,
    Var_IEB_Likert_Upper = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_high,
    Var_IEB_VAS_Median = median(Var_VAS),
    Var_IEB_VAS_Lower = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_low,
    Var_IEB_VAS_Upper = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_high,
    Var_IEB_Diff_Median = median(Var_Diff),
    Var_IEB_Diff_Lower = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_low,
    Var_IEB_Diff_Upper = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_high,
    Var_IEB_Prop_Median = median(Var_Prop),
    Var_IEB_Prop_Lower = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_low,
    Var_IEB_Prop_Upper = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_high
  )  %>%
  pivot_longer(cols = everything(),
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$")

## Missings

posterior_Missings <- mod_Missings_zoib_noVAS2Lik_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zoi_"), "Zero/One", ifelse(str_detect(.variable, "coi_"), "One","Mean"))),
         intercept = str_detect(.variable, "Intercept"))

posterior_Missings_wider <- posterior_Missings %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zoi_formatVAS",
                                "Intercept" = "b_zoi_Intercept",
                                "VAS" = "b_coi_formatVAS",
                                "Intercept" = "b_coi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw"))


posterior_Missings_Variance <- posterior_Missings_wider %>%
  mutate(ZeroOne_Likert = plogis(`Zero/One_Intercept`) - plogis(One_Intercept)*plogis(`Zero/One_Intercept`),
         ZeroOne_VAS = plogis(`Zero/One_Intercept` + `Zero/One_VAS`) - plogis(One_Intercept + One_VAS)*plogis(`Zero/One_Intercept` + `Zero/One_VAS`),
         ZeroOne_Diff = ZeroOne_VAS - ZeroOne_Likert,
         ZeroOne_Prop = ZeroOne_VAS/ZeroOne_Likert,
         One_Likert = plogis(One_Intercept)*plogis(`Zero/One_Intercept`),
         One_VAS = plogis(One_Intercept + One_VAS)*plogis(`Zero/One_Intercept` + `Zero/One_VAS`),
         One_Diff = One_VAS - One_Likert,
         One_Prop = One_VAS/One_Likert,
         Zero_Likert = ZeroOne_Likert - One_Likert,
         Zero_VAS = ZeroOne_VAS - One_VAS,
         Zero_Diff = Zero_VAS - Zero_Likert,
         Zero_Prop = Zero_VAS/Zero_Likert,
         Mean_Likert = ZeroOne_Likert*0 + (1 - ZeroOne_Likert - One_Likert)*plogis(Mean_Intercept) + One_Likert*1,
         Mean_VAS = ZeroOne_VAS*0 + (1-ZeroOne_VAS - One_VAS)*plogis(Mean_Intercept + Mean_VAS) + One_VAS*1,
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Precision_VAS = Precision_Intercept + Precision_VAS,
         Var_Likert = ZeroOne_Likert*0 + (1-ZeroOne_Likert)*(Mean_Likert*(1-Mean_Likert)/(1 + Precision_Intercept)) + ZeroOne_Likert*(0 - Mean_Likert)^2 + (1 - ZeroOne_Likert)*(plogis(Mean_Intercept) - Mean_Likert)^2,
         Var_VAS = ZeroOne_VAS*0 + (1-ZeroOne_VAS-One_VAS)*(Mean_VAS*(1-Mean_VAS)/(1 + Precision_Intercept)) + ZeroOne_VAS*(0 - Mean_VAS)^2 + One_VAS*(0 - Mean_VAS)^2 + (1 - ZeroOne_VAS - One_VAS)*(plogis(Mean_Intercept) - Mean_VAS)^2,
         Var_Total = (Var_Likert + Var_VAS)/2,
         Var_Diff = Var_VAS - Var_Likert,
         Var_Prop = Var_VAS/Var_Likert)
#Var(X)=p1​Var(X1​)+p2​Var(X2​)+p1​(μ1​−μ)2+p2​(μ2​−μ)2

posterior_Missings_Variance_long <- posterior_Missings_Variance %>%
  pivot_longer(cols = c(Var_Likert, Var_VAS, Var_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = "Missings")

posterior_Missings_Variance_summary_stats <- posterior_Missings_Variance %>%
  summarise(
    Var_Missings_Likert_Median = median(Var_Likert),
    Var_Missings_Likert_Lower = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_low,
    Var_Missings_Likert_Upper = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_high,
    Var_Missings_VAS_Median = median(Var_VAS),
    Var_Missings_VAS_Lower = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_low,
    Var_Missings_VAS_Upper = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_high,
    Var_Missings_Diff_Median = median(Var_Diff),
    Var_Missings_Diff_Lower = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_low,
    Var_Missings_Diff_Upper = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_high,
    Var_Missings_Prop_Median = median(Var_Prop),
    Var_Missings_Prop_Lower = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_low,
    Var_Missings_Prop_Upper = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_high,
    ZeroOne_Missings_Prop_Median = median(ZeroOne_Prop),
    ZeroOne_Missings_Prop_Lower = bayestestR::hdi(ZeroOne_Prop, ci = 0.9)$CI_low,
    ZeroOne_Missings_Prop_Upper = bayestestR::hdi(ZeroOne_Prop, ci = 0.9)$CI_high,
    ZeroOne_Missings_Likert_Median = median(ZeroOne_Likert),
    ZeroOne_Missings_Likert_Lower = bayestestR::hdi(ZeroOne_Likert, ci = 0.9)$CI_low,
    ZeroOne_Missings_Likert_Upper = bayestestR::hdi(ZeroOne_Likert, ci = 0.9)$CI_high,
    ZeroOne_Missings_VAS_Median = median(ZeroOne_VAS),
    ZeroOne_Missings_VAS_Lower = bayestestR::hdi(ZeroOne_VAS, ci = 0.9)$CI_low,
    ZeroOne_Missings_VAS_Upper = bayestestR::hdi(ZeroOne_VAS, ci = 0.9)$CI_high,
    ZeroOne_Missings_Diff_Median = median(ZeroOne_Diff),
    ZeroOne_Missings_Diff_Lower = bayestestR::hdi(ZeroOne_Diff, ci = 0.9)$CI_low,
    ZeroOne_Missings_Diff_Upper = bayestestR::hdi(ZeroOne_Diff, ci = 0.9)$CI_high,
    ZeroOne_Missings_Prop_Median = median(ZeroOne_Prop),
    Zero_Missings_Likert_Median = median(Zero_Likert),
    Zero_Missings_Likert_Lower = bayestestR::hdi(Zero_Likert, ci = 0.9)$CI_low,
    Zero_Missings_Likert_Upper = bayestestR::hdi(Zero_Likert, ci = 0.9)$CI_high,
    Zero_Missings_VAS_Median = median(Zero_VAS),
    Zero_Missings_VAS_Lower = bayestestR::hdi(Zero_VAS, ci = 0.9)$CI_low,
    Zero_Missings_VAS_Upper = bayestestR::hdi(Zero_VAS, ci = 0.9)$CI_high,
    Zero_Missings_Diff_Median = median(Zero_Diff),
    Zero_Missings_Diff_Lower = bayestestR::hdi(Zero_Diff, ci = 0.9)$CI_low,
    Zero_Missings_Diff_Upper = bayestestR::hdi(Zero_Diff, ci = 0.9)$CI_high,
    Zero_Missings_Prop_Median = median(Zero_Prop),
    Zero_Missings_Prop_Lower = bayestestR::hdi(Zero_Prop, ci = 0.9)$CI_low,
    Zero_Missings_Prop_Upper = bayestestR::hdi(Zero_Prop, ci = 0.9)$CI_high
  )  %>%
  pivot_longer(cols = everything(),
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$")

## Modality

posterior_Modality_Variance <- mod_Modality_noLiktoVAS_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = "Mean",
         intercept = str_detect(.variable, "Intercept")) %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "Intercept" = "b_Intercept",
                                "Valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence"
                                )) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw")) %>%
  mutate(Mean_Likert = exp(Mean_Intercept),
         Mean_VAS = exp(Mean_Intercept + Mean_VAS),
         Mean_Diff = (Mean_VAS - Mean_Likert)) %>%
  mutate(Var_Likert = Mean_Likert*(1-Mean_Likert),
         Var_VAS = Mean_VAS*(1-Mean_VAS),
         Var_Total = (Var_Likert + Var_VAS)/2,
         Var_Diff = Var_VAS - Var_Likert,
         Var_Prop = Var_VAS/Var_Likert)

posterior_Modality_Variance_long <- posterior_Modality_Variance %>%
    pivot_longer(cols = c(Var_Likert, Var_VAS, Var_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = "Modality")

posterior_Modality_Variance_summary_stats <- posterior_Modality_Variance %>%
  summarise(
    Var_Modality_Likert_Median = median(Var_Likert),
    Var_Modality_Likert_Lower = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_low,
    Var_Modality_Likert_Upper = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_high,
    Var_Modality_VAS_Median = median(Var_VAS),
    Var_Modality_VAS_Lower = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_low,
    Var_Modality_VAS_Upper = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_high,
    Var_Modality_Diff_Median = median(Var_Diff),
    Var_Modality_Diff_Lower = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_low,
    Var_Modality_Diff_Upper = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_high,
    Var_Modality_Prop_Median = median(Var_Prop),
    Var_Modality_Prop_Lower = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_low,
    Var_Modality_Prop_Upper = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_high
  )   %>%
  pivot_longer(cols = everything(),
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$")

## Duration

# Exchanging the posteriors-implementation for the posterior predictive-implementation
# (see down below)

# posterior_duration_wider <- mod_duration_log_fit %>% 
#   gather_draws(`b_.*`, regex = TRUE) %>% 
#   mutate(component = ifelse(str_detect(.variable, "sigma_"), "Variance", "Mean"),
#          intercept = str_detect(.variable, "Intercept")) %>%
#   mutate(.variable = fct_recode(.variable,
#                                 "VAS" = "b_formatVAS",
#                                 "Intercept" = "b_Intercept",
#                                 "VAS" = "b_sigma_formatVAS",
#                                 "Intercept" = "b_sigma_Intercept")) %>%
#   mutate(.variable = fct_relevel(.variable,
#                                  c("Intercept", "VAS"))) %>%
#   mutate(.variable = fct_relevel(.variable,
#                                  c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
#   pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
#               id_cols = c(".chain", ".iteration", ".draw"))
# 
# posterior_duration_Variance <- posterior_duration_wider %>%
#   mutate(Var_Likert = (exp((Variance_Intercept)^2) - 1) * exp(2 * log(Mean_Intercept) + (Variance_Intercept)^2),
#          Var_VAS = (exp((Variance_Intercept + Variance_VAS)^2) - 1) * exp(2 * log(Mean_Intercept + Mean_VAS) + (Variance_Intercept + Variance_VAS)^2),
#          Var_Diff = (Var_VAS - Var_Likert),
#          Var_Total = (Var_VAS + Var_Likert)/2,
#          Var_Prop = Var_VAS/Var_Likert)
#Computed from posterior predictive draws because the implemented likelihood of the lognormal model in brms is unclear
#(i.e., marginal means and variances cannot be directly derived from posterior estimates)
#Through pp
durations$Lik$format <- "Likert"
durations$VAS$format <- "VAS"
duration <- rbind(durations$Lik,
              durations$VAS)
duration %<>%
  pivot_longer(c("Dur_Morning", "Dur_Day", "Dur_Evening"),
               names_to = "period",
               values_to = "duration"
  ) %>%
  mutate(ID = row.names(.))
describeBy(duration$duration, duration$format)

duration_pred <- posterior_predict(mod_duration_log_fit)

posterior_duration_Variance <- duration_pred %>%
  as.data.frame() %>%
  mutate(draw = row.names(.)) %>%
  pivot_longer(cols = -draw,
               names_to = "ID",
               values_to = "value") %>%
  mutate(ID = str_remove(ID, "V")) %>%
  merge(duration, by = "ID", all.x = TRUE, all.y = TRUE) %>%
  group_by(draw, format) %>%
  summarize(Variance = sd(value)^2) %>%
  pivot_wider(values_from = Variance, names_from = format) %>%
  rename(Var_Likert = Likert,
         Var_VAS = VAS) %>%
  mutate(Var_Diff = Var_VAS - Var_Likert,
         Var_Total = (Var_Likert + Var_VAS)/2,
         Var_Prop = Var_Likert/Var_VAS) %>%
  ungroup()

posterior_duration_Variance_stats <- posterior_duration_Variance %>%
  ungroup() %>%
    dplyr::summarize(
    Var_duration_Likert_Median = median(Var_Likert),
    Var_duration_Likert_Lower = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_low,
    Var_duration_Likert_Upper = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_high,
    Var_duration_VAS_Median = median(Var_VAS),
    Var_duration_VAS_Lower = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_low,
    Var_duration_VAS_Upper = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_high,
    Var_duration_Diff_Median = median(Var_Diff),
    Var_duration_Diff_Lower = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_low,
    Var_duration_Diff_Upper = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_high,
    Var_duration_Prop_Median = median(Var_Prop),
    Var_duration_Prop_Lower = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_low,
    Var_duration_Prop_Upper = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_high
    ) %>% pivot_longer(cols = everything(),
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$")

posterior_duration_Variance_long <- posterior_duration_Variance %>%
    pivot_longer(cols = c(Var_Likert, Var_VAS, Var_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = "duration")

posterior_duration_Variance_summary_stats <- posterior_duration_Variance %>%
  summarise(
    Var_duration_Likert_Median = median(Var_Likert),
    Var_duration_Likert_Lower = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_low,
    Var_duration_Likert_Upper = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_high,
    Var_duration_VAS_Median = median(Var_VAS),
    Var_duration_VAS_Lower = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_low,
    Var_duration_VAS_Upper = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_high,
    Var_duration_Diff_Median = median(Var_Diff),
    Var_duration_Diff_Lower = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_low,
    Var_duration_Diff_Upper = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_high,
    Var_duration_Prop_Median = median(Var_Prop),
    Var_duration_Prop_Lower = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_low,
    Var_duration_Prop_Upper = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_high
    ) %>%
  pivot_longer(cols = everything(),
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$")


##Post questionnaire

posterior_post <- model_post_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "disc_"), "Variance", "Mean"),
         intercept = str_detect(.variable, "Intercept")) %>%
  mutate(.variable = str_remove(.variable, "^b_disc_")) %>%
  mutate(.variable = str_remove(.variable, "^b_")) %>%
  separate(.variable, into = c("Variable", "Parameter"), sep = "_")

posterior_post_wider <- posterior_post %>%
  pivot_wider(names_from = "Parameter",
              values_from = ".value",
              id_cols = c("component", "Variable", ".draw"))

posterior_post_Variance <- posterior_post_wider %>%
  filter(component == "Mean") %>%
#  group_by(Variable) %>%
  mutate(Mean_VAS = plogis(`Intercept[1]`)*1
                   + (plogis(`Intercept[2]` - GroupVAS) - plogis(`Intercept[1]` - GroupVAS))*2
                   + (plogis(`Intercept[3]` - GroupVAS) - plogis(`Intercept[2]` - GroupVAS))*3
                   + (plogis(`Intercept[4]` - GroupVAS) - plogis(`Intercept[3]` - GroupVAS))*4
                   + (plogis(`Intercept[5]` - GroupVAS) - plogis(`Intercept[4]` - GroupVAS))*5
                   + (plogis(`Intercept[6]` - GroupVAS) - plogis(`Intercept[5]` - GroupVAS))*6
                   + (1 - plogis(`Intercept[6]`))*7,
                   Mean_Likert = plogis(`Intercept[1]`)*1
                   + (plogis(`Intercept[2]`) - plogis(`Intercept[1]`))*2
                   + (plogis(`Intercept[3]`) - plogis(`Intercept[2]`))*3
                   + (plogis(`Intercept[4]`) - plogis(`Intercept[3]`))*4
                   + (plogis(`Intercept[5]`) - plogis(`Intercept[4]`))*5
                   + (plogis(`Intercept[6]`) - plogis(`Intercept[5]`))*6
                   + (1 - plogis(`Intercept[6]`))*7,
         Mean_Diff = Mean_VAS - Mean_Likert
                   ) %>%
  mutate(Var_Likert = (1-Mean_Likert)^2*plogis(`Intercept[1]`)
         + (2-Mean_Likert)^2*(plogis(`Intercept[2]`) - plogis(`Intercept[1]`))
         + (3-Mean_Likert)^2*(plogis(`Intercept[3]`) - plogis(`Intercept[2]`))
         + (4-Mean_Likert)^2*(plogis(`Intercept[4]`) - plogis(`Intercept[3]`))
         + (5-Mean_Likert)^2*(plogis(`Intercept[5]`) - plogis(`Intercept[4]`))
         + (6-Mean_Likert)^2*(plogis(`Intercept[6]`) - plogis(`Intercept[5]`))
         + (7-Mean_Likert)^2*(1 - plogis(`Intercept[6]`)),
         Var_VAS = (1-Mean_VAS)^2*plogis(`Intercept[1]` - GroupVAS)
         + (2-Mean_VAS)^2*(plogis(`Intercept[2]` - GroupVAS) - plogis(`Intercept[1]` - GroupVAS))
         + (3-Mean_VAS)^2*(plogis(`Intercept[3]` - GroupVAS) - plogis(`Intercept[2]` - GroupVAS))
         + (4-Mean_VAS)^2*(plogis(`Intercept[4]` - GroupVAS) - plogis(`Intercept[3]` - GroupVAS))
         + (5-Mean_VAS)^2*(plogis(`Intercept[5]` - GroupVAS) - plogis(`Intercept[4]` - GroupVAS))
         + (6-Mean_VAS)^2*(plogis(`Intercept[6]` - GroupVAS) - plogis(`Intercept[5]` - GroupVAS))
         + (7-Mean_VAS)^2*(1 - plogis(`Intercept[6]` - GroupVAS)),
         Var_Diff = Var_VAS - Var_Likert,
         Var_Total = (Var_VAS + Var_Likert)/2,
         Var_Prop = Var_VAS/Var_Likert)


# %>%
#   summarize(Mean_Likert = median(Mean_Likert),
#             Mean_VAS = median(Mean_VAS),
#             Mean_Diff = median(Mean_Diff),
#             Var_Likert = median(Var_Likert),
#             Var_VAS = median(Var_VAS),
#             Var_Total = median((Var_VAS + Var_Likert)/2)
#             Var_Diff = median(Var_Diff),
#          Var_Prop = median(Var_VAS/Var_Likert*100))

posterior_post_Variance_long <- posterior_post_Variance %>%
    pivot_longer(cols = c(Var_Likert, Var_VAS, Var_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = fct_recode(Variable,
                            "Post_Burden" = "Burden",
                            "Post_Clear" = "Clear",
                            "Post_ExpNotif" = "ExpNotif",
                            "Post_Freq" = "Freq",
                            "Post_Infl" = "Infl",
                            "Post_KnowAnswer" = "KnowAnswer"))

posterior_post_Variance_summary_stats <- posterior_post_Variance %>%
  group_by(Variable) %>%
  dplyr::summarise(
    Var_post_Likert_Median = median(Var_Likert),
    Var_post_Likert_Lower = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_low,
    Var_post_Likert_Upper = bayestestR::hdi(Var_Likert, ci = 0.9)$CI_high,
    Var_post_VAS_Median = median(Var_VAS),
    Var_post_VAS_Lower = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_low,
    Var_post_VAS_Upper = bayestestR::hdi(Var_VAS, ci = 0.9)$CI_high,
    Var_post_Diff_Median = median(Var_Diff),
    Var_post_Diff_Lower = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_low,
    Var_post_Diff_Upper = bayestestR::hdi(Var_Diff, ci = 0.9)$CI_high,
    Var_post_Prop_Median = median(Var_Prop),
    Var_post_Prop_Lower = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_low,
    Var_post_Prop_Upper = bayestestR::hdi(Var_Prop, ci = 0.9)$CI_high,
    .groups = "keep"
  )  %>%
  pivot_longer(cols = -Variable,
               names_to = c("Component", "Model", ".value", "Estimate"),
               names_pattern = "(.*)_(.*)_(.*)_(.*)$") %>%
  mutate(Model = paste0("Post_", Variable)) %>%
  ungroup() %>%
  select(-Variable)

## Figure

posterior_Variances <- rbind(posterior_Mean_Variance_long %>% dplyr::select(Model, Parameter, value),
      posterior_SD_Variance_long %>% dplyr::select(Model, Parameter, value),
      posterior_CorLag0_Variance_long %>% dplyr::select(Model, Parameter, value),
      posterior_Skew_Variance_long %>% dplyr::select(Model, Parameter, value),
      posterior_RMSSD_Variance_long %>% dplyr::select(Model, Parameter, value),
      posterior_AR_Variance_long %>% dplyr::select(Model, Parameter, value),
      posterior_IEB_Variance_long %>% dplyr::select(Model, Parameter, value),
      posterior_Missings_Variance_long %>% dplyr::select(Model, Parameter, value),
      posterior_Modality_Variance_long %>% dplyr::select(Model, Parameter, value),
      posterior_duration_Variance_long %>% dplyr::select(Model, Parameter, value),
      posterior_post_Variance_long  %>% dplyr::select(Model, Parameter, value)) %>%
    mutate(Model = fct_relevel(Model,
                             c("Mean", "SD", "CorLag0", "Skew", "RMSSD", "AR", "IEB", "Missings", "Modality", "duration", "Post_Burden", "Post_Clear", "Post_ExpNotif", "Post_Freq", "Post_Infl", "Post_KnowAnswer"))) %>%
  mutate(Model = fct_recode(Model,
                            "Means" = "Mean",
                            "Standard deviations" = "SD",
                            "Mean item correlations" = "CorLag0",
                            "Skewnesses" = "Skew",
                            "RMSSD" = "RMSSD",
                            "Autocorrelations" = "AR",
                            "Initial elevation bias" = "IEB",
                            "Missingsness" = "Missings",
                            "Modality" = "Modality",
                            "Durations" = "duration")) %>%
  mutate(Parameter = fct_relevel(Parameter,
                                 c("Var_Diff",
                                   "Var_VAS",
                                   "Var_Likert"))) %>%
  mutate(Parameter = fct_recode(Parameter,
                                "Likert" = "Var_Likert",
                                "VAS" = "Var_VAS",
                                "Difference" = "Var_Diff"))
  
ggplot(posterior_Variances, aes(x = value, y = Parameter, fill = Model)) +
  geom_vline(xintercept = 0) +
  ggdist::stat_pointinterval(aes(slab_alpha = value), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "", y = "") +
  facet_wrap(vars(Model), ncol = 2, scales = "free_x") +
  ggthemes::theme_clean() +
  ylab("") +
  theme(plot.background = element_rect(colour = "white"),
        panel.spacing = unit(2, "lines"))
  # theme(panel.spacing = unit(2, "lines"),
  #       panel.border = element_blank())+ 
  #       theme(axis.line.x = element_line(colour = "black", size = 0.5, 
  #           linetype = "solid"), axis.line.y = element_line(colour = "black", 
  #           size = 0.5, linetype = "solid"), axis.text = element_text(size = ceiling(base_size * 
  #           0.7), colour = "black"), axis.title = element_text(size = ceiling(base_size * 
  #           0.8)), panel.grid.minor = element_blank(), panel.grid.major.y = element_line(colour = "gray", 
  #           linetype = "dotted"), panel.grid.major.x = element_blank(), 
  #           panel.background = element_blank(), panel.border = element_blank(), 
  #           strip.background = element_rect(linetype = 0), strip.text = element_text(), 
  #           strip.text.x = element_text(vjust = 0.5), strip.text.y = element_text(angle = -90), 
  #           legend.text = element_text(size = ceiling(base_size * 
  #               0.9), family = "sans"), legend.title = element_text(size = base_size, 
  #               face = "bold", family = "sans"), legend.position = "right", 
  #           legend.key = element_rect(fill = "white", colour = NA), 
  #           legend.background = element_rect(colour = "black"), 
  #           plot.background = element_rect(colour = "black"), 
  #           plot.title = element_text(size = ceiling(base_size * 
  #               1.1), face = "bold"), plot.subtitle = element_text(size = ceiling(base_size * 
  #               1.05)))

ggsave("ridge_Variances.pdf", dpi = 450, width = 8, height = 12)

##Export EMVs
EMV <- rbind(posterior_Mean_Variance_summary_stats,
posterior_SD_Variance_summary_stats,
posterior_CorLag0_Variance_summary_stats,
posterior_Skew_Variance_summary_stats,
posterior_RMSSD_Variance_summary_stats,
posterior_AR_Variance_summary_stats,
posterior_IEB_Variance_summary_stats,
posterior_Missings_Variance_summary_stats,
posterior_Modality_Variance_summary_stats,
posterior_duration_Variance_summary_stats,
posterior_post_Variance_summary_stats
)

save(EMV, file = "EMV.Rdata")

EMM_EMV <- rbind(EMM, EMV)

save(EMM_EMV, file = "EMM_EMV.Rdata")

```

## Figures: Two main parameter plots

```{r}

##First posterior plot

ggplot(posterior_All1, aes(x = .value, y = fct_rev(.variable), fill = Model)) +
  geom_vline(xintercept = 0) +
  stat_pointinterval(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_qi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(Model), ncol = 1, scales = "free_y") +
  ggthemes::theme_clean()

ggsave("ridge_All1.pdf", dpi = 450, width = 6, height = 6)

## Second posterior plot

ggplot(posterior_All2, aes(x = .value, y = fct_rev(.variable), fill = Model)) +
  geom_vline(xintercept = 0) +
  stat_pointinterval(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_qi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(Model), ncol = 1, scales = "free") +
  ggthemes::theme_clean()

ggsave("ridge_All2.pdf", dpi = 450, width = 6, height = 5)

```

## Correlations with BSI: Results

```{r correlations.BSI}
load("Model_BSI_group_fixed_fit.Rdata")
summary(Model_BSI_group_fixed_fit)

variables(Model_BSI_group_fixed_fit)

Model_BSI_group_fixed_fit_draws_long <- Model_BSI_group_fixed_fit %>% posterior_samples() %>% dplyr::select(starts_with("b_")) %>%
  dplyr::select(-contains("sigma")) %>% as_draws_array() %>% as_draws_df() %>%
  pivot_longer(cols = starts_with("b_"), names_to = "parameter", values_to = "value") %>% mutate(parameter = str_remove(parameter, "_BSIz"),
                    parameter = str_remove(parameter, "b_"),
                    parameter = str_remove(parameter, "format")) %>% mutate(OriginalParameter = parameter) %>%
  # Now separate the copied 'OriginalParameter' column into two new columns
  separate(OriginalParameter, into = c("Emotion", "Format"), sep = ":", extra = "merge") %>% mutate(Emotion = str_remove(Emotion, "z")) # %>% dplyr::select(-`.chain`, -`.iteration`, -`.draw`) %>%
  

Correlations_BSI_summary_stats <- Model_BSI_group_fixed_fit_draws_long %>%
  group_by(Emotion, Format) %>%
  dplyr::summarise(
    Median = median(value),
    HDI_Lower =bayestestR::hdi(value, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(value, ci = 0.9)$CI_high
  ) 

Model_BSI_group_fixed_fit_draws_wider <- Model_BSI_group_fixed_fit_draws_long %>%
  pivot_wider(names_from = Format, values_from = value,
              id_cols = c(".chain", "Emotion", ".iteration", ".draw")) %>%
  mutate(Difference_VASLik = VAS - Likert) %>%
  mutate(Emotion = gsub("b_", "", Emotion)) %>%
  mutate(valence = fct_recode(Emotion,
                              "positive" = "Energetic",
                              "positive" = "Happy",
                              "positive" = "LookForward",
                              "positive" = "SatisfiedS",
                              "positive" = "SatisfiedB",
                              "negative" = "Anxious",
                              "negative" = "Ashamed",
                              "negative" = "Discomfort",
                              "negative" = "Disgusted",
                              "negative" = "Guilty",
                              "negative" = "Irritated",
                              "negative" = "Lonely",
                              "negative" = "Sad",
                              "negative" = "Stressed"))

Correlations_BSI_summary_stats_Diff <- Model_BSI_group_fixed_fit_draws_wider %>%
  group_by(Emotion) %>%
  summarise(
    Median = median(Difference_VASLik),
    HDI_Lower =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_high
  ) 


save(Correlations_BSI_summary_stats, file = "Correlations_BSI_summary_stats.Rdata")

Model_BSI_group_fixed_fit_draws_long

Model_BSI_group_fixed_fit_draws_wider

BSI_fixedeffects <- Model_BSI_group_fixed_fit_draws_wider %>%
  group_by(valence, .draw) %>%
  dplyr::summarize(BSI_Likert = mean(Likert),
                   BSI_VAS = mean(VAS),
                   BSI_Diff = mean(VAS - Likert)) %>%
  pivot_wider(values_from = c(BSI_Likert, BSI_VAS, BSI_Diff), names_from = valence) %>%
  mutate(BSI_Likert = (abs(BSI_Likert_negative) + abs(BSI_Likert_positive))/2,
         BSI_VAS = (abs(BSI_VAS_negative) + abs(BSI_VAS_positive))/2,
         BSI_Diff = (abs(BSI_Diff_negative) + abs(BSI_Diff_positive))/2) %>%
  ungroup %>%
  dplyr::summarize(corr_BSI_Likert = median(BSI_Likert),
                   corr_BSI_VAS = median(BSI_VAS),
                   corr_BSI_Diff = median(BSI_Diff),
                   HDI_Likert_Lower =bayestestR::hdi(BSI_Likert, ci = 0.9)$CI_low,
                   HDI_Likert_Upper =bayestestR::hdi(BSI_Likert, ci = 0.9)$CI_high,
                   HDI_VAS_Lower =bayestestR::hdi(BSI_VAS, ci = 0.9)$CI_low,
                   HDI_VAS_Upper =bayestestR::hdi(BSI_VAS, ci = 0.9)$CI_high,
                   HDI_Diff_Lower =bayestestR::hdi(BSI_Diff, ci = 0.9)$CI_low,
                   HDI_Diff_Upper =bayestestR::hdi(BSI_Diff, ci = 0.9)$CI_high)
#Likert .29, VAS .52, diff .22

#Compare with full post hoc thingie
Correlations_BSI_summary_stats %>%
  group_by(Format) %>%
  dplyr::summarize(corr_BSI = mean(abs(Median)))
#Likert .30, VAS .54, Diff .24 I guess...

BSI_fixedeffects_valence <- Model_BSI_group_fixed_fit_draws_wider %>%
  group_by(valence, .draw) %>%
  dplyr::summarize(BSI_Likert = mean(Likert),
                   BSI_VAS = mean(VAS),
                   BSI_Diff = mean(VAS - Likert)) %>%
  ungroup %>%
  group_by(valence) %>%
  dplyr::summarize(corr_BSI_Likert = median(BSI_Likert),
                   corr_BSI_VAS = median(BSI_VAS),
                   corr_BSI_Diff = median(BSI_Diff),
                   HDI_Likert_Lower =bayestestR::hdi(BSI_Likert, ci = 0.9)$CI_low,
                   HDI_Likert_Upper =bayestestR::hdi(BSI_Likert, ci = 0.9)$CI_high,
                   HDI_VAS_Lower =bayestestR::hdi(BSI_VAS, ci = 0.9)$CI_low,
                   HDI_VAS_Upper =bayestestR::hdi(BSI_VAS, ci = 0.9)$CI_high,
                   HDI_Diff_Lower =bayestestR::hdi(BSI_Diff, ci = 0.9)$CI_low,
                   HDI_Diff_Upper =bayestestR::hdi(BSI_Diff, ci = 0.9)$CI_high) 

Correlations_BSI_summary_stats[dim(Correlations_BSI_summary_stats)[1] + 1,] <- c("Average", "Likert", BSI_fixedeffects[1, 1], BSI_fixedeffects[1, 4], BSI_fixedeffects[1, 5])

Correlations_BSI_summary_stats[dim(Correlations_BSI_summary_stats)[1] + 1,] <- c("Average", "VAS", BSI_fixedeffects[1, 2], BSI_fixedeffects[1, 6], BSI_fixedeffects[1, 7])

Correlations_BSI_summary_stats[dim(Correlations_BSI_summary_stats)[1] + 1,] <- c("Average", "Diff", BSI_fixedeffects[1, 3], BSI_fixedeffects[1, 8], BSI_fixedeffects[1, 9])

save(Correlations_BSI_summary_stats, file = "Correlations_BSI_summary_stats.Rdata")

##Descriptive check
# Correlations_BSI_summary_stats %>% filter(Emotion != "Average") %>%
#   group_by(Format) %>%
#   summarize(Average = mean(abs(Median)))
#.30 and .54 for Lik and VAS - fits!

```

## Correlations with DASS: Results

### Correlations with DASS_S: Results

```{r correlations.DASS_S}

load("Model_DASS_S_group_fixed_fit.Rdata")

summary(Model_DASS_S_group_fixed_fit)

variables(Model_DASS_S_group_fixed_fit)

Model_DASS_S_group_fixed_fit_draws_long <- Model_DASS_S_group_fixed_fit %>% posterior_samples() %>% dplyr::select(starts_with("b_")) %>%
  dplyr::select(-contains("sigma")) %>% as_draws_array() %>% as_draws_df() %>%
  pivot_longer(cols = starts_with("b_"), names_to = "parameter", values_to = "value") %>% mutate(parameter = str_remove(parameter, "_DASS_Sz"),
                    parameter = str_remove(parameter, "b_"),
                    parameter = str_remove(parameter, "format")) %>% mutate(OriginalParameter = parameter) %>%
  # Now separate the copied 'OriginalParameter' column into two new columns
  separate(OriginalParameter, into = c("Emotion", "Format"), sep = ":", extra = "merge") %>% mutate(Emotion = str_remove(Emotion, "z")) # %>% dplyr::select(-`.chain`, -`.iteration`, -`.draw`) %>%
  

Correlations_DASS_S_summary_stats <- Model_DASS_S_group_fixed_fit_draws_long %>%
  group_by(Emotion, Format) %>%
  dplyr::summarise(
    Median = median(value),
    HDI_Lower =bayestestR::hdi(value, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(value, ci = 0.9)$CI_high
  ) 

Model_DASS_S_group_fixed_fit_draws_wider <- Model_DASS_S_group_fixed_fit_draws_long %>%
  pivot_wider(names_from = Format, values_from = value,
              id_cols = c(".chain", "Emotion", ".iteration", ".draw")) %>%
  mutate(Difference_VASLik = VAS - Likert) %>%
  mutate(Emotion = gsub("b_", "", Emotion)) %>%
  mutate(valence = fct_recode(Emotion,
                              "positive" = "Energetic",
                              "positive" = "Happy",
                              "positive" = "LookForward",
                              "positive" = "SatisfiedS",
                              "positive" = "SatisfiedB",
                              "negative" = "Anxious",
                              "negative" = "Ashamed",
                              "negative" = "Discomfort",
                              "negative" = "Disgusted",
                              "negative" = "Guilty",
                              "negative" = "Irritated",
                              "negative" = "Lonely",
                              "negative" = "Sad",
                              "negative" = "Stressed"))

Correlations_DASS_S_summary_stats_Diff <- Model_DASS_S_group_fixed_fit_draws_wider %>%
  group_by(Emotion) %>%
  summarise(
    Median = median(Difference_VASLik),
    HDI_Lower =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_high
  ) 

Model_DASS_S_group_fixed_fit_draws_long

Model_DASS_S_group_fixed_fit_draws_wider

DASS_S_fixedeffects <- Model_DASS_S_group_fixed_fit_draws_wider %>%
  group_by(valence, .draw) %>%
  dplyr::summarize(DASS_S_Likert = mean(Likert),
                   DASS_S_VAS = mean(VAS),
                   DASS_S_Diff = mean(VAS - Likert)) %>%
  pivot_wider(values_from = c(DASS_S_Likert, DASS_S_VAS, DASS_S_Diff), names_from = valence) %>%
  mutate(DASS_S_Likert = (abs(DASS_S_Likert_negative) + abs(DASS_S_Likert_positive))/2,
         DASS_S_VAS = (abs(DASS_S_VAS_negative) + abs(DASS_S_VAS_positive))/2,
         DASS_S_Diff = (abs(DASS_S_Diff_negative) + abs(DASS_S_Diff_positive))/2) %>%
  ungroup %>%
  dplyr::summarize(corr_DASS_S_Likert = median(DASS_S_Likert),
                   corr_DASS_S_VAS = median(DASS_S_VAS),
                   corr_DASS_S_Diff = median(DASS_S_Diff),
                   HDI_Likert_Lower =bayestestR::hdi(DASS_S_Likert, ci = 0.9)$CI_low,
                   HDI_Likert_Upper =bayestestR::hdi(DASS_S_Likert, ci = 0.9)$CI_high,
                   HDI_VAS_Lower =bayestestR::hdi(DASS_S_VAS, ci = 0.9)$CI_low,
                   HDI_VAS_Upper =bayestestR::hdi(DASS_S_VAS, ci = 0.9)$CI_high,
                   HDI_Diff_Lower =bayestestR::hdi(DASS_S_Diff, ci = 0.9)$CI_low,
                   HDI_Diff_Upper =bayestestR::hdi(DASS_S_Diff, ci = 0.9)$CI_high)
#Likert .19, VAS .48, diff .29

#Compare with full post hoc thingie
Correlations_DASS_S_summary_stats %>%
  group_by(Format) %>%
  dplyr::summarize(corr_DASS_S = mean(abs(Median)))
#Likert .23, VAS .49, Diff .26 I guess...

DASS_S_fixedeffects_valence <- Model_DASS_S_group_fixed_fit_draws_wider %>%
  group_by(valence, .draw) %>%
  dplyr::summarize(DASS_S_Likert = mean(Likert),
                   DASS_S_VAS = mean(VAS),
                   DASS_S_Diff = mean(VAS - Likert)) %>%
  ungroup %>%
  group_by(valence) %>%
  dplyr::summarize(corr_DASS_S_Likert = median(DASS_S_Likert),
                   corr_DASS_S_VAS = median(DASS_S_VAS),
                   corr_DASS_S_Diff = median(DASS_S_Diff),
                   HDI_Likert_Lower =bayestestR::hdi(DASS_S_Likert, ci = 0.9)$CI_low,
                   HDI_Likert_Upper =bayestestR::hdi(DASS_S_Likert, ci = 0.9)$CI_high,
                   HDI_VAS_Lower =bayestestR::hdi(DASS_S_VAS, ci = 0.9)$CI_low,
                   HDI_VAS_Upper =bayestestR::hdi(DASS_S_VAS, ci = 0.9)$CI_high,
                   HDI_Diff_Lower =bayestestR::hdi(DASS_S_Diff, ci = 0.9)$CI_low,
                   HDI_Diff_Upper =bayestestR::hdi(DASS_S_Diff, ci = 0.9)$CI_high) 


# Correlations_DASS_S_summary_stats
# DASS_S_fixedeffects_valence
# DASS_S_fixedeffects
# 
# Correlations_DASS_S_summary_stats[dim(Correlations_DASS_S_summary_stats)[1] + 1,] <- c(DASS_S_fixedeffects_valence[1, 1], "Likert", DASS_S_fixedeffects_valence[1, 2], DASS_S_fixedeffects_valence[1, 5], DASS_S_fixedeffects_valence[1, 6])
# 
# Correlations_DASS_S_summary_stats[dim(Correlations_DASS_S_summary_stats)[1] + 2,] <- c(DASS_S_fixedeffects_valence[2, 1], "VAS", DASS_S_fixedeffects_valence[2, 2], DASS_S_fixedeffects_valence[2, 5], DASS_S_fixedeffects_valence[2, 6])
# 
# View(DASS_S_fixedeffects)

Correlations_DASS_S_summary_stats[dim(Correlations_DASS_S_summary_stats)[1] + 1,] <- c("Average", "Likert", DASS_S_fixedeffects[1, 1], DASS_S_fixedeffects[1, 4], DASS_S_fixedeffects[1, 5])

Correlations_DASS_S_summary_stats[dim(Correlations_DASS_S_summary_stats)[1] + 1,] <- c("Average", "VAS", DASS_S_fixedeffects[1, 2], DASS_S_fixedeffects[1, 6], DASS_S_fixedeffects[1, 7])

Correlations_DASS_S_summary_stats[dim(Correlations_DASS_S_summary_stats)[1] + 1,] <- c("Average", "Diff", DASS_S_fixedeffects[1, 3], DASS_S_fixedeffects[1, 8], DASS_S_fixedeffects[1, 9])

save(Correlations_DASS_S_summary_stats, file = "Correlations_DASS_S_summary_stats.Rdata")

```

### Correlations with DASS_A: Results

```{r correlations.DASS_A}

load("Model_DASS_A_group_fixed_fit.Rdata")

summary(Model_DASS_A_group_fixed_fit)

variables(Model_DASS_A_group_fixed_fit)

Model_DASS_A_group_fixed_fit_draws_long <- Model_DASS_A_group_fixed_fit %>% posterior_samples() %>% dplyr::select(starts_with("b_")) %>%
  dplyr::select(-contains("sigma")) %>% as_draws_array() %>% as_draws_df() %>%
  pivot_longer(cols = starts_with("b_"), names_to = "parameter", values_to = "value") %>% mutate(parameter = str_remove(parameter, "_DASS_Az"),
                    parameter = str_remove(parameter, "b_"),
                    parameter = str_remove(parameter, "format")) %>% mutate(OriginalParameter = parameter) %>%
  # Now separate the copied 'OriginalParameter' column into two new columns
  separate(OriginalParameter, into = c("Emotion", "Format"), sep = ":", extra = "merge") %>% mutate(Emotion = str_remove(Emotion, "z")) # %>% dplyr::select(-`.chain`, -`.iteration`, -`.draw`) %>%
  

Correlations_DASS_A_summary_stats <- Model_DASS_A_group_fixed_fit_draws_long %>%
  group_by(Emotion, Format) %>%
  dplyr::summarise(
    Median = median(value),
    HDI_Lower =bayestestR::hdi(value, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(value, ci = 0.9)$CI_high
  ) 

Model_DASS_A_group_fixed_fit_draws_wider <- Model_DASS_A_group_fixed_fit_draws_long %>%
  pivot_wider(names_from = Format, values_from = value,
              id_cols = c(".chain", "Emotion", ".iteration", ".draw")) %>%
  mutate(Difference_VASLik = VAS - Likert) %>%
  mutate(Emotion = gsub("b_", "", Emotion)) %>%
  mutate(valence = fct_recode(Emotion,
                              "positive" = "Energetic",
                              "positive" = "Happy",
                              "positive" = "LookForward",
                              "positive" = "SatisfiedS",
                              "positive" = "SatisfiedB",
                              "negative" = "Anxious",
                              "negative" = "Ashamed",
                              "negative" = "Discomfort",
                              "negative" = "Disgusted",
                              "negative" = "Guilty",
                              "negative" = "Irritated",
                              "negative" = "Lonely",
                              "negative" = "Sad",
                              "negative" = "Stressed"))

Correlations_DASS_A_summary_stats_Diff <- Model_DASS_A_group_fixed_fit_draws_wider %>%
  group_by(Emotion) %>%
  summarise(
    Median = median(Difference_VASLik),
    HDI_Lower =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_high
  ) 


save(Correlations_DASS_A_summary_stats, file = "Correlations_DASS_A_summary_stats.Rdata")

Model_DASS_A_group_fixed_fit_draws_long

Model_DASS_A_group_fixed_fit_draws_wider

DASS_A_fixedeffects <- Model_DASS_A_group_fixed_fit_draws_wider %>%
  group_by(valence, .draw) %>%
  dplyr::summarize(DASS_A_Likert = mean(Likert),
                   DASS_A_VAS = mean(VAS),
                   DASS_A_Diff = mean(VAS - Likert)) %>%
  pivot_wider(values_from = c(DASS_A_Likert, DASS_A_VAS, DASS_A_Diff), names_from = valence) %>%
  mutate(DASS_A_Likert = (abs(DASS_A_Likert_negative) + abs(DASS_A_Likert_positive))/2,
         DASS_A_VAS = (abs(DASS_A_VAS_negative) + abs(DASS_A_VAS_positive))/2,
         DASS_A_Diff = (abs(DASS_A_Diff_negative) + abs(DASS_A_Diff_positive))/2) %>%
  ungroup %>%
  dplyr::summarize(corr_DASS_A_Likert = median(DASS_A_Likert),
                   corr_DASS_A_VAS = median(DASS_A_VAS),
                   corr_DASS_A_Diff = median(DASS_A_Diff),
                   HDI_Likert_Lower =bayestestR::hdi(DASS_A_Likert, ci = 0.9)$CI_low,
                   HDI_Likert_Upper =bayestestR::hdi(DASS_A_Likert, ci = 0.9)$CI_high,
                   HDI_VAS_Lower =bayestestR::hdi(DASS_A_VAS, ci = 0.9)$CI_low,
                   HDI_VAS_Upper =bayestestR::hdi(DASS_A_VAS, ci = 0.9)$CI_high,
                   HDI_Diff_Lower =bayestestR::hdi(DASS_A_Diff, ci = 0.9)$CI_low,
                   HDI_Diff_Upper =bayestestR::hdi(DASS_A_Diff, ci = 0.9)$CI_high)
#Likert .19, VAS .48, diff .29

#Compare with full post hoc thingie
Correlations_DASS_A_summary_stats %>%
  group_by(Format) %>%
  dplyr::summarize(corr_DASS_A = mean(abs(Median)))
#Likert .23, VAS .49, Diff .26 I guess...

DASS_A_fixedeffects_valence <- Model_DASS_A_group_fixed_fit_draws_wider %>%
  group_by(valence, .draw) %>%
  dplyr::summarize(DASS_A_Likert = mean(Likert),
                   DASS_A_VAS = mean(VAS),
                   DASS_A_Diff = mean(VAS - Likert)) %>%
  ungroup %>%
  group_by(valence) %>%
  dplyr::summarize(corr_DASS_A_Likert = median(DASS_A_Likert),
                   corr_DASS_A_VAS = median(DASS_A_VAS),
                   corr_DASS_A_Diff = median(DASS_A_Diff),
                   HDI_Likert_Lower =bayestestR::hdi(DASS_A_Likert, ci = 0.9)$CI_low,
                   HDI_Likert_Upper =bayestestR::hdi(DASS_A_Likert, ci = 0.9)$CI_high,
                   HDI_VAS_Lower =bayestestR::hdi(DASS_A_VAS, ci = 0.9)$CI_low,
                   HDI_VAS_Upper =bayestestR::hdi(DASS_A_VAS, ci = 0.9)$CI_high,
                   HDI_Diff_Lower =bayestestR::hdi(DASS_A_Diff, ci = 0.9)$CI_low,
                   HDI_Diff_Upper =bayestestR::hdi(DASS_A_Diff, ci = 0.9)$CI_high) 

Correlations_DASS_A_summary_stats[dim(Correlations_DASS_A_summary_stats)[1] + 1,] <- c("Average", "Likert", DASS_A_fixedeffects[1, 1], DASS_A_fixedeffects[1, 4], DASS_A_fixedeffects[1, 5])

Correlations_DASS_A_summary_stats[dim(Correlations_DASS_A_summary_stats)[1] + 1,] <- c("Average", "VAS", DASS_A_fixedeffects[1, 2], DASS_A_fixedeffects[1, 6], DASS_A_fixedeffects[1, 7])

Correlations_DASS_A_summary_stats[dim(Correlations_DASS_A_summary_stats)[1] + 1,] <- c("Average", "Diff", DASS_A_fixedeffects[1, 3], DASS_A_fixedeffects[1, 8], DASS_A_fixedeffects[1, 9])

save(Correlations_DASS_A_summary_stats, file = "Correlations_DASS_A_summary_stats.Rdata")

```

### Correlations with DASS_D: Results

```{r correlations.DASS_D}

load("Model_DASS_D_group_fixed_fit.Rdata")

summary(Model_DASS_D_group_fixed_fit)

variables(Model_DASS_D_group_fixed_fit)

Model_DASS_D_group_fixed_fit_draws_long <- Model_DASS_D_group_fixed_fit %>% posterior_samples() %>% dplyr::select(starts_with("b_")) %>%
  dplyr::select(-contains("sigma")) %>% as_draws_array() %>% as_draws_df() %>%
  pivot_longer(cols = starts_with("b_"), names_to = "parameter", values_to = "value") %>% mutate(parameter = str_remove(parameter, "_DASS_Dz"),
                    parameter = str_remove(parameter, "b_"),
                    parameter = str_remove(parameter, "format")) %>% mutate(OriginalParameter = parameter) %>%
  # Now separate the copied 'OriginalParameter' column into two new columns
  separate(OriginalParameter, into = c("Emotion", "Format"), sep = ":", extra = "merge") %>% mutate(Emotion = str_remove(Emotion, "z")) # %>% dplyr::select(-`.chain`, -`.iteration`, -`.draw`) %>%
  

Correlations_DASS_D_summary_stats <- Model_DASS_D_group_fixed_fit_draws_long %>%
  group_by(Emotion, Format) %>%
  dplyr::summarise(
    Median = median(value),
    HDI_Lower =bayestestR::hdi(value, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(value, ci = 0.9)$CI_high
  ) 

Model_DASS_D_group_fixed_fit_draws_wider <- Model_DASS_D_group_fixed_fit_draws_long %>%
  pivot_wider(names_from = Format, values_from = value,
              id_cols = c(".chain", "Emotion", ".iteration", ".draw")) %>%
  mutate(Difference_VASLik = VAS - Likert) %>%
  mutate(Emotion = gsub("b_", "", Emotion)) %>%
  mutate(valence = fct_recode(Emotion,
                              "positive" = "Energetic",
                              "positive" = "Happy",
                              "positive" = "LookForward",
                              "positive" = "SatisfiedS",
                              "positive" = "SatisfiedB",
                              "negative" = "Anxious",
                              "negative" = "Ashamed",
                              "negative" = "Discomfort",
                              "negative" = "Disgusted",
                              "negative" = "Guilty",
                              "negative" = "Irritated",
                              "negative" = "Lonely",
                              "negative" = "Sad",
                              "negative" = "Stressed"))

Correlations_DASS_D_summary_stats_Diff <- Model_DASS_D_group_fixed_fit_draws_wider %>%
  group_by(Emotion) %>%
  summarise(
    Median = median(Difference_VASLik),
    HDI_Lower =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_high
  ) 


save(Correlations_DASS_D_summary_stats, file = "Correlations_DASS_D_summary_stats.Rdata")

Model_DASS_D_group_fixed_fit_draws_long

Model_DASS_D_group_fixed_fit_draws_wider

DASS_D_fixedeffects <- Model_DASS_D_group_fixed_fit_draws_wider %>%
  group_by(valence, .draw) %>%
  dplyr::summarize(DASS_D_Likert = mean(Likert),
                   DASS_D_VAS = mean(VAS),
                   DASS_D_Diff = mean(VAS - Likert)) %>%
  pivot_wider(values_from = c(DASS_D_Likert, DASS_D_VAS, DASS_D_Diff), names_from = valence) %>%
  mutate(DASS_D_Likert = (abs(DASS_D_Likert_negative) + abs(DASS_D_Likert_positive))/2,
         DASS_D_VAS = (abs(DASS_D_VAS_negative) + abs(DASS_D_VAS_positive))/2,
         DASS_D_Diff = (abs(DASS_D_Diff_negative) + abs(DASS_D_Diff_positive))/2) %>%
  ungroup %>%
  dplyr::summarize(corr_DASS_D_Likert = median(DASS_D_Likert),
                   corr_DASS_D_VAS = median(DASS_D_VAS),
                   corr_DASS_D_Diff = median(DASS_D_Diff),
                   HDI_Likert_Lower =bayestestR::hdi(DASS_D_Likert, ci = 0.9)$CI_low,
                   HDI_Likert_Upper =bayestestR::hdi(DASS_D_Likert, ci = 0.9)$CI_high,
                   HDI_VAS_Lower =bayestestR::hdi(DASS_D_VAS, ci = 0.9)$CI_low,
                   HDI_VAS_Upper =bayestestR::hdi(DASS_D_VAS, ci = 0.9)$CI_high,
                   HDI_Diff_Lower =bayestestR::hdi(DASS_D_Diff, ci = 0.9)$CI_low,
                   HDI_Diff_Upper =bayestestR::hdi(DASS_D_Diff, ci = 0.9)$CI_high)
#Likert .19, VAS .48, diff .29

#Compare with full post hoc thingie
Correlations_DASS_D_summary_stats %>%
  group_by(Format) %>%
  dplyr::summarize(corr_DASS_D = mean(abs(Median)))
#Likert .23, VAS .49, Diff .26 I guess...

DASS_D_fixedeffects_valence <- Model_DASS_D_group_fixed_fit_draws_wider %>%
  group_by(valence, .draw) %>%
  dplyr::summarize(DASS_D_Likert = mean(Likert),
                   DASS_D_VAS = mean(VAS),
                   DASS_D_Diff = mean(VAS - Likert)) %>%
  ungroup %>%
  group_by(valence) %>%
  dplyr::summarize(corr_DASS_D_Likert = median(DASS_D_Likert),
                   corr_DASS_D_VAS = median(DASS_D_VAS),
                   corr_DASS_D_Diff = median(DASS_D_Diff),
                   HDI_Likert_Lower =bayestestR::hdi(DASS_D_Likert, ci = 0.9)$CI_low,
                   HDI_Likert_Upper =bayestestR::hdi(DASS_D_Likert, ci = 0.9)$CI_high,
                   HDI_VAS_Lower =bayestestR::hdi(DASS_D_VAS, ci = 0.9)$CI_low,
                   HDI_VAS_Upper =bayestestR::hdi(DASS_D_VAS, ci = 0.9)$CI_high,
                   HDI_Diff_Lower =bayestestR::hdi(DASS_D_Diff, ci = 0.9)$CI_low,
                   HDI_Diff_Upper =bayestestR::hdi(DASS_D_Diff, ci = 0.9)$CI_high) 

Correlations_DASS_D_summary_stats[dim(Correlations_DASS_D_summary_stats)[1] + 1,] <- c("Average", "Likert", DASS_D_fixedeffects[1, 1], DASS_D_fixedeffects[1, 4], DASS_D_fixedeffects[1, 5])

Correlations_DASS_D_summary_stats[dim(Correlations_DASS_D_summary_stats)[1] + 1,] <- c("Average", "VAS", DASS_D_fixedeffects[1, 2], DASS_D_fixedeffects[1, 6], DASS_D_fixedeffects[1, 7])

Correlations_DASS_D_summary_stats[dim(Correlations_DASS_D_summary_stats)[1] + 1,] <- c("Average", "Diff", DASS_D_fixedeffects[1, 3], DASS_D_fixedeffects[1, 8], DASS_D_fixedeffects[1, 9])

save(Correlations_DASS_D_summary_stats, file = "Correlations_DASS_D_summary_stats.Rdata")

```

## VAS2Lik: Means: Explanation of VAS/Likert-difference

How much of the difference between the mean item correlation on VAS and Likert is explained by the VAS to Likert mapping-process?

### VAS2Lik: Means

```{r Means.Vas2Lik}

##Results inspection

load("mod_Mean_zib_fit.Rdata")
summary(mod_Mean_zib_fit)

##Percent explained across all items (both valences)

EMM_MappingMean <- mod_Mean_zib_fit %>% spread_draws(b_Intercept, b_formatVAS, b_formatVAS2Lik, b_zi_Intercept, b_zi_formatVAS, b_zi_formatVAS2Lik) %>%
  mutate(Mean_Lik = plogis(b_zi_Intercept)*0 + (1 -plogis(b_zi_Intercept))*plogis(b_Intercept),
         Mean_VAS = plogis(b_zi_Intercept + b_zi_formatVAS)*0 + (1 -plogis(b_zi_Intercept + b_zi_formatVAS))*plogis(b_Intercept + b_formatVAS),
         Mean_VAS2Lik = plogis(b_zi_Intercept + b_zi_formatVAS2Lik)*0 + (1 -plogis(b_zi_Intercept + b_zi_formatVAS2Lik))*plogis(b_Intercept + b_formatVAS2Lik),
         Diff_VAS2Lik_Lik = Mean_VAS2Lik - Mean_Lik,
         Diff_VAS_Lik = Mean_VAS - Mean_Lik,
         Diff_VAS_VAS2Lik = Mean_VAS - Mean_VAS2Lik,
         PercExpl = (Mean_VAS - Mean_VAS2Lik) / (Mean_VAS - Mean_Lik)) %>%
  dplyr::summarise(
    Mean_Likert_Median = median(Mean_Lik),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Lik, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Lik, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_VAS2Lik_Median = median(Mean_VAS2Lik),
    Mean_VAS2Lik_Lower = bayestestR::hdi(Mean_VAS2Lik, ci = 0.9)$CI_low,
    Mean_VAS2Lik_Upper = bayestestR::hdi(Mean_VAS2Lik, ci = 0.9)$CI_high,
    Mean_DiffVAS2LikLik_Median = median(Diff_VAS2Lik_Lik),
    Mean_DiffVAS2LikLik_Lower = bayestestR::hdi(Diff_VAS2Lik_Lik, ci = 0.9)$CI_low,
    Mean_DiffVAS2LikLik_Upper = bayestestR::hdi(Diff_VAS2Lik_Lik, ci = 0.9)$CI_high,
    Mean_DiffVASLik_Median = median(Diff_VAS_Lik),
    Mean_DiffVASLik_Lower = bayestestR::hdi(Diff_VAS_Lik, ci = 0.9)$CI_low,
    Mean_DiffVASLik_Upper = bayestestR::hdi(Diff_VAS_Lik, ci = 0.9)$CI_high,
    Mean_DiffVASVAS2Lik_Median = median(Diff_VAS_VAS2Lik),
    Mean_DiffVASVAS2Lik_Lower = bayestestR::hdi(Diff_VAS_VAS2Lik, ci = 0.9)$CI_low,
    Mean_DiffVASVAS2Lik_Upper = bayestestR::hdi(Diff_VAS_VAS2Lik, ci = 0.9)$CI_high,    
    Mean_PercExpl_Median = median(PercExpl),
    Mean_PercExpl_Lower = bayestestR::hdi(PercExpl, ci = 0.9)$CI_low,
    Mean_PercExpl_Upper = bayestestR::hdi(PercExpl, ci = 0.9)$CI_high
    ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "MappingMean")

  #describe() #Likert: 0.20 predicted mean. VAS: .26 predicted mean. Also medians the same. Descriptive:
lv_m_long %>% filter(format == "Likert") %>% describe() #.22 (Median: .16)
lv_m_long %>% filter(format == "VAS") %>% describe() #.29 (Median: .24)
#Means generally slightly underestimated by .02?
#pp_check(mod_Mean_zib_fit, draws = 30) #Might well be; overestimates means in .20s, underestimates larger ones slightly.

##Now percentage explained for positive and negative valence items

EMM_MappingMean_Valence <- mod_Mean_zib_fit %>% spread_draws(b_Intercept, b_formatVAS, b_formatVAS2Lik, b_valence, b_zi_Intercept, b_zi_formatVAS, b_zi_formatVAS2Lik, b_zi_valence,
          `b_formatVAS:valence`, `b_formatVAS2Lik:valence`, `b_zi_formatVAS:valence`, `b_zi_formatVAS2Lik:valence`) %>%
  mutate(Mean_Lik_pos = plogis(b_zi_Intercept + b_zi_valence)*0 + (1 -plogis(b_zi_Intercept + b_zi_valence))*plogis(b_Intercept + b_valence),
         Mean_Lik_neg = plogis(b_zi_Intercept - b_zi_valence)*0 + (1 -plogis(b_zi_Intercept - b_zi_valence))*plogis(b_Intercept - b_valence),
         Mean_VAS_pos = plogis(b_zi_Intercept + b_zi_formatVAS + b_zi_valence + `b_zi_formatVAS:valence`)*0 + (1 - plogis(b_zi_Intercept + b_zi_formatVAS + b_zi_valence + `b_zi_formatVAS:valence`))*plogis(b_Intercept + b_formatVAS + b_valence + `b_formatVAS:valence`),
         Mean_VAS2Lik_pos = plogis(b_zi_Intercept + b_zi_formatVAS2Lik + b_zi_valence + `b_zi_formatVAS2Lik:valence`)*0 + (1 - plogis(b_zi_Intercept + b_zi_formatVAS2Lik + b_zi_valence + `b_zi_formatVAS2Lik:valence`))*plogis(b_Intercept + b_formatVAS2Lik + b_valence + `b_formatVAS2Lik:valence`),
         Mean_VAS_neg = plogis(b_zi_Intercept + b_zi_formatVAS - b_zi_valence - `b_zi_formatVAS:valence`)*0 + (1 - plogis(b_zi_Intercept + b_zi_formatVAS - b_zi_valence - `b_zi_formatVAS:valence`))*plogis(b_Intercept + b_formatVAS - b_valence - `b_formatVAS:valence`),
         Mean_VAS2Lik_neg = plogis(b_zi_Intercept + b_zi_formatVAS2Lik - b_zi_valence - `b_zi_formatVAS2Lik:valence`)*0 + (1 - plogis(b_zi_Intercept + b_zi_formatVAS2Lik - b_zi_valence - `b_zi_formatVAS2Lik:valence`))*plogis(b_Intercept + b_formatVAS2Lik - b_valence - `b_formatVAS2Lik:valence`),
         Diff_VAS2Lik_Lik_pos = Mean_VAS2Lik_pos - Mean_Lik_pos,
         Diff_VAS_Lik_pos = Mean_VAS_pos - Mean_Lik_pos,
         PercExpl_pos = (Mean_VAS_pos - Mean_VAS2Lik_pos) / (Mean_VAS_pos - Mean_Lik_pos),
         Diff_VAS2Lik_Lik_neg = Mean_VAS2Lik_neg - Mean_Lik_neg,
         Diff_VAS_Lik_neg = Mean_VAS_neg - Mean_Lik_neg,
         PercExpl_neg = (Mean_VAS_neg - Mean_VAS2Lik_neg) / (Mean_VAS_neg - Mean_Lik_neg)) %>%
  dplyr::summarise(
    Mean_Likert_pos_Median = median(Mean_Lik_pos),
    Mean_Likert_pos_Lower = bayestestR::hdi(Mean_Lik_pos, ci = 0.9)$CI_low,
    Mean_Likert_pos_Upper = bayestestR::hdi(Mean_Lik_pos, ci = 0.9)$CI_high,
    Mean_VAS_pos_Median = median(Mean_VAS_pos),
    Mean_VAS_pos_Lower = bayestestR::hdi(Mean_VAS_pos, ci = 0.9)$CI_low,
    Mean_VAS_pos_Upper = bayestestR::hdi(Mean_VAS_pos, ci = 0.9)$CI_high,
    Mean_VAS2Lik_pos_Median = median(Mean_VAS2Lik_pos),
    Mean_VAS2Lik_pos_Lower = bayestestR::hdi(Mean_VAS2Lik_pos, ci = 0.9)$CI_low,
    Mean_VAS2Lik_pos_Upper = bayestestR::hdi(Mean_VAS2Lik_pos, ci = 0.9)$CI_high,
    Mean_DiffVAS2LikLik_pos_Median = median(Diff_VAS2Lik_Lik_pos),
    Mean_DiffVAS2LikLik_pos_Lower = bayestestR::hdi(Diff_VAS2Lik_Lik_pos, ci = 0.9)$CI_low,
    Mean_DiffVAS2LikLik_pos_Upper = bayestestR::hdi(Diff_VAS2Lik_Lik_pos, ci = 0.9)$CI_high,
    Mean_DiffVASLik_pos_Median = median(Diff_VAS_Lik_pos),
    Mean_DiffVASLik_pos_Lower = bayestestR::hdi(Diff_VAS_Lik_pos, ci = 0.9)$CI_low,
    Mean_DiffVASLik_pos_Upper = bayestestR::hdi(Diff_VAS_Lik_pos, ci = 0.9)$CI_high,
    Mean_PercExpl_pos_Median = median(PercExpl_pos),
    Mean_PercExpl_pos_Lower = bayestestR::hdi(PercExpl_pos, ci = 0.9)$CI_low,
    Mean_PercExpl_pos_Upper = bayestestR::hdi(PercExpl_pos, ci = 0.9)$CI_high,
    Mean_Likert_neg_Median = median(Mean_Lik_neg),
    Mean_Likert_neg_Lower = bayestestR::hdi(Mean_Lik_neg, ci = 0.9)$CI_low,
    Mean_Likert_neg_Upper = bayestestR::hdi(Mean_Lik_neg, ci = 0.9)$CI_high,
    Mean_VAS_neg_Median = median(Mean_VAS_neg),
    Mean_VAS_neg_Lower = bayestestR::hdi(Mean_VAS_neg, ci = 0.9)$CI_low,
    Mean_VAS_neg_Upper = bayestestR::hdi(Mean_VAS_neg, ci = 0.9)$CI_high,
    Mean_VAS2Lik_neg_Median = median(Mean_VAS2Lik_neg),
    Mean_VAS2Lik_neg_Lower = bayestestR::hdi(Mean_VAS2Lik_neg, ci = 0.9)$CI_low,
    Mean_VAS2Lik_neg_Upper = bayestestR::hdi(Mean_VAS2Lik_neg, ci = 0.9)$CI_high,
    Mean_DiffVAS2LikLik_neg_Median = median(Diff_VAS2Lik_Lik_neg),
    Mean_DiffVAS2LikLik_neg_Lower = bayestestR::hdi(Diff_VAS2Lik_Lik_neg, ci = 0.9)$CI_low,
    Mean_DiffVAS2LikLik_neg_Upper = bayestestR::hdi(Diff_VAS2Lik_Lik_neg, ci = 0.9)$CI_high,
    Mean_DiffVASLik_neg_Median = median(Diff_VAS_Lik_neg),
    Mean_DiffVASLik_neg_Lower = bayestestR::hdi(Diff_VAS_Lik_neg, ci = 0.9)$CI_low,
    Mean_DiffVASLik_neg_Upper = bayestestR::hdi(Diff_VAS_Lik_neg, ci = 0.9)$CI_high,
    Mean_PercExpl_neg_Median = median(PercExpl_neg),
    Mean_PercExpl_neg_Lower = bayestestR::hdi(PercExpl_neg, ci = 0.9)$CI_low,
    Mean_PercExpl_neg_Upper = bayestestR::hdi(PercExpl_neg, ci = 0.9)$CI_high
    ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "valence", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)_(.*)$") %>%
  mutate(Model = "MappingMean_Valence")
#On negative valence items the VAS2Likert-mapping process explains 50% of the difference between Likert- and VAS-means,
#but on positive valence items none?

#Likert positive only .33 and VAS positive only .44?
#check: 
emmeans(mod_Mean_zib_fit, ~ format | valence, type = "response") #emmeans says median is at .202 (Likert) and .270 (VAS)...
#emmeans says the same! check 1 (x)
#descriptives: 
dd <- lv_m_long %>% filter(format == "Likert" & valence == "1") %>% dplyr::select(Mean)
dd$Mean %>% describe() 
dd <- lv_m_long %>% filter(format == "Likert" & valence == "1" & Item == "Happy") %>% dplyr::select(Mean)
dd$Mean %>% describe()
#Perfect! Model describes descriptives well

#There is little difference between VAS and Likert means on negative valence-items (just about .035) but 75% of this are explained by the VAS2Likert-mapping process (CI90: .38-1.35)
#On positive valence-items, there is a larger difference (about .10) but the mapping process explains nothing.



```


### VAS2Lik: CorLag0

```{r Means.Vas2Lik}

##Results inspection

load("mod_CorLag0_beta_fit.Rdata")
summary(mod_CorLag0_beta_fit)

##Percent explained across all items (both valences)

EMM_MappingCorLag0 <- mod_CorLag0_beta_fit %>%
  spread_draws(b_Intercept, b_formatVAS, b_formatLikerttoVAS) %>%
  mutate(Mean_Lik = plogis(b_Intercept),
         Mean_VAS = plogis(b_Intercept + b_formatVAS),
         Mean_VAS2Lik = plogis(b_Intercept + b_formatLikerttoVAS),
         Diff_VAS2Lik_Lik = Mean_VAS2Lik - Mean_Lik,
         Diff_VAS_Lik = Mean_VAS - Mean_Lik,
         Diff_VAS_VAS2Lik = Mean_VAS - Mean_VAS2Lik,
         PercExpl = (Mean_VAS - Mean_VAS2Lik) / (Mean_VAS - Mean_Lik)) %>%
  dplyr::summarise(
    Mean_Likert_Median = median(Mean_Lik),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Lik, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Lik, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_VAS2Lik_Median = median(Mean_VAS2Lik),
    Mean_VAS2Lik_Lower = bayestestR::hdi(Mean_VAS2Lik, ci = 0.9)$CI_low,
    Mean_VAS2Lik_Upper = bayestestR::hdi(Mean_VAS2Lik, ci = 0.9)$CI_high,
    Mean_DiffVAS2LikLik_Median = median(Diff_VAS2Lik_Lik),
    Mean_DiffVAS2LikLik_Lower = bayestestR::hdi(Diff_VAS2Lik_Lik, ci = 0.9)$CI_low,
    Mean_DiffVAS2LikLik_Upper = bayestestR::hdi(Diff_VAS2Lik_Lik, ci = 0.9)$CI_high,
    Mean_DiffVASLik_Median = median(Diff_VAS_Lik),
    Mean_DiffVASLik_Lower = bayestestR::hdi(Diff_VAS_Lik, ci = 0.9)$CI_low,
    Mean_DiffVASLik_Upper = bayestestR::hdi(Diff_VAS_Lik, ci = 0.9)$CI_high,
    Mean_DiffVASVAS2Lik_Median = median(Diff_VAS_VAS2Lik),
    Mean_DiffVASVAS2Lik_Lower = bayestestR::hdi(Diff_VAS_VAS2Lik, ci = 0.9)$CI_low,
    Mean_DiffVASVAS2Lik_Upper = bayestestR::hdi(Diff_VAS_VAS2Lik, ci = 0.9)$CI_high,  
    Mean_PercExpl_Median = median(PercExpl),
    Mean_PercExpl_Lower = bayestestR::hdi(PercExpl, ci = 0.9)$CI_low,
    Mean_PercExpl_Upper = bayestestR::hdi(PercExpl, ci = 0.9)$CI_high
    ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "MappingCorLag0")

EMM_MappingCorLag0_Valence <- mod_CorLag0_beta_fit %>% spread_draws(b_Intercept, b_formatVAS, b_formatLikerttoVAS, b_valence,
          `b_formatVAS:valence`, `b_formatLikerttoVAS:valence`) %>%
  mutate(Mean_Lik_pos = plogis(b_Intercept + b_valence),
         Mean_Lik_neg = plogis(b_Intercept - b_valence),
         Mean_VAS_pos = plogis(b_Intercept + b_formatVAS + b_valence + `b_formatVAS:valence`),
         Mean_VAS2Lik_pos = plogis(b_Intercept + b_formatLikerttoVAS + b_valence + `b_formatLikerttoVAS:valence`),
         Mean_VAS_neg = plogis(b_Intercept + b_formatVAS - b_valence - `b_formatVAS:valence`),
         Mean_VAS2Lik_neg = plogis(b_Intercept + b_formatLikerttoVAS - b_valence - `b_formatLikerttoVAS:valence`),
         Diff_VAS2Lik_Lik_pos = Mean_VAS2Lik_pos - Mean_Lik_pos,
         Diff_VAS_Lik_pos = Mean_VAS_pos - Mean_Lik_pos,
         PercExpl_pos = (Mean_VAS_pos - Mean_VAS2Lik_pos) / (Mean_VAS_pos - Mean_Lik_pos),
         Diff_VAS2Lik_Lik_neg = Mean_VAS2Lik_neg - Mean_Lik_neg,
         Diff_VAS_Lik_neg = Mean_VAS_neg - Mean_Lik_neg,
         PercExpl_neg = (Mean_VAS_neg - Mean_VAS2Lik_neg) / (Mean_VAS_neg - Mean_Lik_neg)) %>%
  dplyr::summarise(
    Mean_Likert_pos_Median = median(Mean_Lik_pos),
    Mean_Likert_pos_Lower = bayestestR::hdi(Mean_Lik_pos, ci = 0.9)$CI_low,
    Mean_Likert_pos_Upper = bayestestR::hdi(Mean_Lik_pos, ci = 0.9)$CI_high,
    Mean_VAS_pos_Median = median(Mean_VAS_pos),
    Mean_VAS_pos_Lower = bayestestR::hdi(Mean_VAS_pos, ci = 0.9)$CI_low,
    Mean_VAS_pos_Upper = bayestestR::hdi(Mean_VAS_pos, ci = 0.9)$CI_high,
    Mean_VAS2Lik_pos_Median = median(Mean_VAS2Lik_pos),
    Mean_VAS2Lik_pos_Lower = bayestestR::hdi(Mean_VAS2Lik_pos, ci = 0.9)$CI_low,
    Mean_VAS2Lik_pos_Upper = bayestestR::hdi(Mean_VAS2Lik_pos, ci = 0.9)$CI_high,
    Mean_DiffVAS2LikLik_pos_Median = median(Diff_VAS2Lik_Lik_pos),
    Mean_DiffVAS2LikLik_pos_Lower = bayestestR::hdi(Diff_VAS2Lik_Lik_pos, ci = 0.9)$CI_low,
    Mean_DiffVAS2LikLik_pos_Upper = bayestestR::hdi(Diff_VAS2Lik_Lik_pos, ci = 0.9)$CI_high,
    Mean_DiffVASLik_pos_Median = median(Diff_VAS_Lik_pos),
    Mean_DiffVASLik_pos_Lower = bayestestR::hdi(Diff_VAS_Lik_pos, ci = 0.9)$CI_low,
    Mean_DiffVASLik_pos_Upper = bayestestR::hdi(Diff_VAS_Lik_pos, ci = 0.9)$CI_high,
    Mean_PercExpl_pos_Median = median(PercExpl_pos),
    Mean_PercExpl_pos_Lower = bayestestR::hdi(PercExpl_pos, ci = 0.9)$CI_low,
    Mean_PercExpl_pos_Upper = bayestestR::hdi(PercExpl_pos, ci = 0.9)$CI_high,
    Mean_Likert_neg_Median = median(Mean_Lik_neg),
    Mean_Likert_neg_Lower = bayestestR::hdi(Mean_Lik_neg, ci = 0.9)$CI_low,
    Mean_Likert_neg_Upper = bayestestR::hdi(Mean_Lik_neg, ci = 0.9)$CI_high,
    Mean_VAS_neg_Median = median(Mean_VAS_neg),
    Mean_VAS_neg_Lower = bayestestR::hdi(Mean_VAS_neg, ci = 0.9)$CI_low,
    Mean_VAS_neg_Upper = bayestestR::hdi(Mean_VAS_neg, ci = 0.9)$CI_high,
    Mean_VAS2Lik_neg_Median = median(Mean_VAS2Lik_neg),
    Mean_VAS2Lik_neg_Lower = bayestestR::hdi(Mean_VAS2Lik_neg, ci = 0.9)$CI_low,
    Mean_VAS2Lik_neg_Upper = bayestestR::hdi(Mean_VAS2Lik_neg, ci = 0.9)$CI_high,
    Mean_DiffVAS2LikLik_neg_Median = median(Diff_VAS2Lik_Lik_neg),
    Mean_DiffVAS2LikLik_neg_Lower = bayestestR::hdi(Diff_VAS2Lik_Lik_neg, ci = 0.9)$CI_low,
    Mean_DiffVAS2LikLik_neg_Upper = bayestestR::hdi(Diff_VAS2Lik_Lik_neg, ci = 0.9)$CI_high,
    Mean_DiffVASLik_neg_Median = median(Diff_VAS_Lik_neg),
    Mean_DiffVASLik_neg_Lower = bayestestR::hdi(Diff_VAS_Lik_neg, ci = 0.9)$CI_low,
    Mean_DiffVASLik_neg_Upper = bayestestR::hdi(Diff_VAS_Lik_neg, ci = 0.9)$CI_high,
    Mean_PercExpl_neg_Median = median(PercExpl_neg),
    Mean_PercExpl_neg_Lower = bayestestR::hdi(PercExpl_neg, ci = 0.9)$CI_low,
    Mean_PercExpl_neg_Upper = bayestestR::hdi(PercExpl_neg, ci = 0.9)$CI_high
    ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "valence", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)_(.*)$") %>%
  mutate(Model = "MappingCorLag0_Valence")

```

### VAS2Lik: AR1

```{r AR1.Vas2Lik}

##Results inspection

load("mod_AR_fit.Rdata")
summary(mod_AR_fit)

##Percent explained across all items (both valences)

EMM_MappingAR <- mod_AR_fit %>%
  spread_draws(b_Intercept, b_formatVAS, b_formatLikerttoVAS) %>%
  mutate(Mean_Lik = b_Intercept,
         Mean_VAS = b_Intercept + b_formatVAS,
         Mean_VAS2Lik = b_Intercept + b_formatLikerttoVAS,
         Diff_VAS2Lik_Lik = Mean_VAS2Lik - Mean_Lik,
         Diff_VAS_Lik = Mean_VAS - Mean_Lik,
         Diff_VAS_VAS2Lik = Mean_VAS - Mean_VAS2Lik,
         PercExpl = (Mean_VAS - Mean_VAS2Lik) / (Mean_VAS - Mean_Lik)) %>%
  dplyr::summarise(
    Mean_Likert_Median = median(Mean_Lik),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Lik, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Lik, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_VAS2Lik_Median = median(Mean_VAS2Lik),
    Mean_VAS2Lik_Lower = bayestestR::hdi(Mean_VAS2Lik, ci = 0.9)$CI_low,
    Mean_VAS2Lik_Upper = bayestestR::hdi(Mean_VAS2Lik, ci = 0.9)$CI_high,
    Mean_DiffVAS2LikLik_Median = median(Diff_VAS2Lik_Lik),
    Mean_DiffVAS2LikLik_Lower = bayestestR::hdi(Diff_VAS2Lik_Lik, ci = 0.9)$CI_low,
    Mean_DiffVAS2LikLik_Upper = bayestestR::hdi(Diff_VAS2Lik_Lik, ci = 0.9)$CI_high,
    Mean_DiffVASLik_Median = median(Diff_VAS_Lik),
    Mean_DiffVASLik_Lower = bayestestR::hdi(Diff_VAS_Lik, ci = 0.9)$CI_low,
    Mean_DiffVASLik_Upper = bayestestR::hdi(Diff_VAS_Lik, ci = 0.9)$CI_high,
    Mean_DiffVASVAS2Lik_Median = median(Diff_VAS_VAS2Lik),
    Mean_DiffVASVAS2Lik_Lower = bayestestR::hdi(Diff_VAS_VAS2Lik, ci = 0.9)$CI_low,
    Mean_DiffVASVAS2Lik_Upper = bayestestR::hdi(Diff_VAS_VAS2Lik, ci = 0.9)$CI_high,  
    Mean_PercExpl_Median = median(PercExpl),
    Mean_PercExpl_Lower = bayestestR::hdi(PercExpl, ci = 0.9)$CI_low,
    Mean_PercExpl_Upper = bayestestR::hdi(PercExpl, ci = 0.9)$CI_high
    ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "MappingAR")

EMM_MappingAR_Valence <- mod_AR_fit %>% spread_draws(b_Intercept, b_formatVAS, b_formatLikerttoVAS, b_valence,
          `b_formatVAS:valence`, `b_formatLikerttoVAS:valence`) %>%
  mutate(Mean_Lik_pos = b_Intercept + b_valence,
         Mean_Lik_neg = b_Intercept - b_valence,
         Mean_VAS_pos = b_Intercept + b_formatVAS + b_valence + `b_formatVAS:valence`,
         Mean_VAS2Lik_pos = b_Intercept + b_formatLikerttoVAS + b_valence + `b_formatLikerttoVAS:valence`,
         Mean_VAS_neg = b_Intercept + b_formatVAS - b_valence - `b_formatVAS:valence`,
         Mean_VAS2Lik_neg = b_Intercept + b_formatLikerttoVAS - b_valence - `b_formatLikerttoVAS:valence`,
         Diff_VAS2Lik_Lik_pos = Mean_VAS2Lik_pos - Mean_Lik_pos,
         Diff_VAS_Lik_pos = Mean_VAS_pos - Mean_Lik_pos,
         PercExpl_pos = (Mean_VAS_pos - Mean_VAS2Lik_pos) / (Mean_VAS_pos - Mean_Lik_pos),
         Diff_VAS2Lik_Lik_neg = Mean_VAS2Lik_neg - Mean_Lik_neg,
         Diff_VAS_Lik_neg = Mean_VAS_neg - Mean_Lik_neg,
         PercExpl_neg = (Mean_VAS_neg - Mean_VAS2Lik_neg) / (Mean_VAS_neg - Mean_Lik_neg)) %>%
  dplyr::summarise(
    Mean_Likert_pos_Median = median(Mean_Lik_pos),
    Mean_Likert_pos_Lower = bayestestR::hdi(Mean_Lik_pos, ci = 0.9)$CI_low,
    Mean_Likert_pos_Upper = bayestestR::hdi(Mean_Lik_pos, ci = 0.9)$CI_high,
    Mean_VAS_pos_Median = median(Mean_VAS_pos),
    Mean_VAS_pos_Lower = bayestestR::hdi(Mean_VAS_pos, ci = 0.9)$CI_low,
    Mean_VAS_pos_Upper = bayestestR::hdi(Mean_VAS_pos, ci = 0.9)$CI_high,
    Mean_VAS2Lik_pos_Median = median(Mean_VAS2Lik_pos),
    Mean_VAS2Lik_pos_Lower = bayestestR::hdi(Mean_VAS2Lik_pos, ci = 0.9)$CI_low,
    Mean_VAS2Lik_pos_Upper = bayestestR::hdi(Mean_VAS2Lik_pos, ci = 0.9)$CI_high,
    Mean_DiffVAS2LikLik_pos_Median = median(Diff_VAS2Lik_Lik_pos),
    Mean_DiffVAS2LikLik_pos_Lower = bayestestR::hdi(Diff_VAS2Lik_Lik_pos, ci = 0.9)$CI_low,
    Mean_DiffVAS2LikLik_pos_Upper = bayestestR::hdi(Diff_VAS2Lik_Lik_pos, ci = 0.9)$CI_high,
    Mean_DiffVASLik_pos_Median = median(Diff_VAS_Lik_pos),
    Mean_DiffVASLik_pos_Lower = bayestestR::hdi(Diff_VAS_Lik_pos, ci = 0.9)$CI_low,
    Mean_DiffVASLik_pos_Upper = bayestestR::hdi(Diff_VAS_Lik_pos, ci = 0.9)$CI_high,
    Mean_PercExpl_pos_Median = median(PercExpl_pos),
    Mean_PercExpl_pos_Lower = bayestestR::hdi(PercExpl_pos, ci = 0.9)$CI_low,
    Mean_PercExpl_pos_Upper = bayestestR::hdi(PercExpl_pos, ci = 0.9)$CI_high,
    Mean_Likert_neg_Median = median(Mean_Lik_neg),
    Mean_Likert_neg_Lower = bayestestR::hdi(Mean_Lik_neg, ci = 0.9)$CI_low,
    Mean_Likert_neg_Upper = bayestestR::hdi(Mean_Lik_neg, ci = 0.9)$CI_high,
    Mean_VAS_neg_Median = median(Mean_VAS_neg),
    Mean_VAS_neg_Lower = bayestestR::hdi(Mean_VAS_neg, ci = 0.9)$CI_low,
    Mean_VAS_neg_Upper = bayestestR::hdi(Mean_VAS_neg, ci = 0.9)$CI_high,
    Mean_VAS2Lik_neg_Median = median(Mean_VAS2Lik_neg),
    Mean_VAS2Lik_neg_Lower = bayestestR::hdi(Mean_VAS2Lik_neg, ci = 0.9)$CI_low,
    Mean_VAS2Lik_neg_Upper = bayestestR::hdi(Mean_VAS2Lik_neg, ci = 0.9)$CI_high,
    Mean_DiffVAS2LikLik_neg_Median = median(Diff_VAS2Lik_Lik_neg),
    Mean_DiffVAS2LikLik_neg_Lower = bayestestR::hdi(Diff_VAS2Lik_Lik_neg, ci = 0.9)$CI_low,
    Mean_DiffVAS2LikLik_neg_Upper = bayestestR::hdi(Diff_VAS2Lik_Lik_neg, ci = 0.9)$CI_high,
    Mean_DiffVASLik_neg_Median = median(Diff_VAS_Lik_neg),
    Mean_DiffVASLik_neg_Lower = bayestestR::hdi(Diff_VAS_Lik_neg, ci = 0.9)$CI_low,
    Mean_DiffVASLik_neg_Upper = bayestestR::hdi(Diff_VAS_Lik_neg, ci = 0.9)$CI_high,
    Mean_PercExpl_neg_Median = median(PercExpl_neg),
    Mean_PercExpl_neg_Lower = bayestestR::hdi(PercExpl_neg, ci = 0.9)$CI_low,
    Mean_PercExpl_neg_Upper = bayestestR::hdi(PercExpl_neg, ci = 0.9)$CI_high
    ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "valence", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)_(.*)$") %>%
  mutate(Model = "MappingAR_Valence")

```


### VAS2Lik: Skew

```{r Skew.Vas2Lik}

##Results inspection

load("mod_Skew_fit.Rdata")
summary(mod_Skew_fit)

##Percent explained across all items (both valences)

EMM_MappingSkew <- mod_Skew_fit %>%
  spread_draws(b_Intercept, b_formatVAS, b_formatLikerttoVAS) %>%
  mutate(Mean_Lik = b_Intercept,
         Mean_VAS = b_Intercept + b_formatVAS,
         Mean_VAS2Lik = b_Intercept + b_formatLikerttoVAS,
         Diff_VAS2Lik_Lik = Mean_VAS2Lik - Mean_Lik,
         Diff_VAS_Lik = Mean_VAS - Mean_Lik,
         Diff_VAS_VAS2Lik = Mean_VAS - Mean_VAS2Lik,
         PercExpl = (Mean_VAS - Mean_VAS2Lik) / (Mean_VAS - Mean_Lik)) %>%
  dplyr::summarise(
    Mean_Likert_Median = median(Mean_Lik),
    Mean_Likert_Lower = bayestestR::hdi(Mean_Lik, ci = 0.9)$CI_low,
    Mean_Likert_Upper = bayestestR::hdi(Mean_Lik, ci = 0.9)$CI_high,
    Mean_VAS_Median = median(Mean_VAS),
    Mean_VAS_Lower = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_VAS_Upper = bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_VAS2Lik_Median = median(Mean_VAS2Lik),
    Mean_VAS2Lik_Lower = bayestestR::hdi(Mean_VAS2Lik, ci = 0.9)$CI_low,
    Mean_VAS2Lik_Upper = bayestestR::hdi(Mean_VAS2Lik, ci = 0.9)$CI_high,
    Mean_DiffVAS2LikLik_Median = median(Diff_VAS2Lik_Lik),
    Mean_DiffVAS2LikLik_Lower = bayestestR::hdi(Diff_VAS2Lik_Lik, ci = 0.9)$CI_low,
    Mean_DiffVAS2LikLik_Upper = bayestestR::hdi(Diff_VAS2Lik_Lik, ci = 0.9)$CI_high,
    Mean_DiffVASLik_Median = median(Diff_VAS_Lik),
    Mean_DiffVASLik_Lower = bayestestR::hdi(Diff_VAS_Lik, ci = 0.9)$CI_low,
    Mean_DiffVASLik_Upper = bayestestR::hdi(Diff_VAS_Lik, ci = 0.9)$CI_high,
    Mean_DiffVASVAS2Lik_Median = median(Diff_VAS_VAS2Lik),
    Mean_DiffVASVAS2Lik_Lower = bayestestR::hdi(Diff_VAS_VAS2Lik, ci = 0.9)$CI_low,
    Mean_DiffVASVAS2Lik_Upper = bayestestR::hdi(Diff_VAS_VAS2Lik, ci = 0.9)$CI_high,  
    Mean_PercExpl_Median = median(PercExpl),
    Mean_PercExpl_Lower = bayestestR::hdi(PercExpl, ci = 0.9)$CI_low,
    Mean_PercExpl_Upper = bayestestR::hdi(PercExpl, ci = 0.9)$CI_high
    ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)$") %>%
  mutate(Model = "MappingSkew")

EMM_MappingSkew_Valence <- mod_Skew_fit %>% spread_draws(b_Intercept, b_formatVAS, b_formatLikerttoVAS, b_valence,
          `b_formatVAS:valence`, `b_formatLikerttoVAS:valence`) %>%
  mutate(Mean_Lik_pos = b_Intercept + b_valence,
         Mean_Lik_neg = b_Intercept - b_valence,
         Mean_VAS_pos = b_Intercept + b_formatVAS + b_valence + `b_formatVAS:valence`,
         Mean_VAS2Lik_pos = b_Intercept + b_formatLikerttoVAS + b_valence + `b_formatLikerttoVAS:valence`,
         Mean_VAS_neg = b_Intercept + b_formatVAS - b_valence - `b_formatVAS:valence`,
         Mean_VAS2Lik_neg = b_Intercept + b_formatLikerttoVAS - b_valence - `b_formatLikerttoVAS:valence`,
         Diff_VAS2Lik_Lik_pos = Mean_VAS2Lik_pos - Mean_Lik_pos,
         Diff_VAS_Lik_pos = Mean_VAS_pos - Mean_Lik_pos,
         PercExpl_pos = (Mean_VAS_pos - Mean_VAS2Lik_pos) / (Mean_VAS_pos - Mean_Lik_pos),
         Diff_VAS2Lik_Lik_neg = Mean_VAS2Lik_neg - Mean_Lik_neg,
         Diff_VAS_Lik_neg = Mean_VAS_neg - Mean_Lik_neg,
         PercExpl_neg = (Mean_VAS_neg - Mean_VAS2Lik_neg) / (Mean_VAS_neg - Mean_Lik_neg)) %>%
  dplyr::summarise(
    Mean_Likert_pos_Median = median(Mean_Lik_pos),
    Mean_Likert_pos_Lower = bayestestR::hdi(Mean_Lik_pos, ci = 0.9)$CI_low,
    Mean_Likert_pos_Upper = bayestestR::hdi(Mean_Lik_pos, ci = 0.9)$CI_high,
    Mean_VAS_pos_Median = median(Mean_VAS_pos),
    Mean_VAS_pos_Lower = bayestestR::hdi(Mean_VAS_pos, ci = 0.9)$CI_low,
    Mean_VAS_pos_Upper = bayestestR::hdi(Mean_VAS_pos, ci = 0.9)$CI_high,
    Mean_VAS2Lik_pos_Median = median(Mean_VAS2Lik_pos),
    Mean_VAS2Lik_pos_Lower = bayestestR::hdi(Mean_VAS2Lik_pos, ci = 0.9)$CI_low,
    Mean_VAS2Lik_pos_Upper = bayestestR::hdi(Mean_VAS2Lik_pos, ci = 0.9)$CI_high,
    Mean_DiffVAS2LikLik_pos_Median = median(Diff_VAS2Lik_Lik_pos),
    Mean_DiffVAS2LikLik_pos_Lower = bayestestR::hdi(Diff_VAS2Lik_Lik_pos, ci = 0.9)$CI_low,
    Mean_DiffVAS2LikLik_pos_Upper = bayestestR::hdi(Diff_VAS2Lik_Lik_pos, ci = 0.9)$CI_high,
    Mean_DiffVASLik_pos_Median = median(Diff_VAS_Lik_pos),
    Mean_DiffVASLik_pos_Lower = bayestestR::hdi(Diff_VAS_Lik_pos, ci = 0.9)$CI_low,
    Mean_DiffVASLik_pos_Upper = bayestestR::hdi(Diff_VAS_Lik_pos, ci = 0.9)$CI_high,
    Mean_PercExpl_pos_Median = median(PercExpl_pos),
    Mean_PercExpl_pos_Lower = bayestestR::hdi(PercExpl_pos, ci = 0.9)$CI_low,
    Mean_PercExpl_pos_Upper = bayestestR::hdi(PercExpl_pos, ci = 0.9)$CI_high,
    Mean_Likert_neg_Median = median(Mean_Lik_neg),
    Mean_Likert_neg_Lower = bayestestR::hdi(Mean_Lik_neg, ci = 0.9)$CI_low,
    Mean_Likert_neg_Upper = bayestestR::hdi(Mean_Lik_neg, ci = 0.9)$CI_high,
    Mean_VAS_neg_Median = median(Mean_VAS_neg),
    Mean_VAS_neg_Lower = bayestestR::hdi(Mean_VAS_neg, ci = 0.9)$CI_low,
    Mean_VAS_neg_Upper = bayestestR::hdi(Mean_VAS_neg, ci = 0.9)$CI_high,
    Mean_VAS2Lik_neg_Median = median(Mean_VAS2Lik_neg),
    Mean_VAS2Lik_neg_Lower = bayestestR::hdi(Mean_VAS2Lik_neg, ci = 0.9)$CI_low,
    Mean_VAS2Lik_neg_Upper = bayestestR::hdi(Mean_VAS2Lik_neg, ci = 0.9)$CI_high,
    Mean_DiffVAS2LikLik_neg_Median = median(Diff_VAS2Lik_Lik_neg),
    Mean_DiffVAS2LikLik_neg_Lower = bayestestR::hdi(Diff_VAS2Lik_Lik_neg, ci = 0.9)$CI_low,
    Mean_DiffVAS2LikLik_neg_Upper = bayestestR::hdi(Diff_VAS2Lik_Lik_neg, ci = 0.9)$CI_high,
    Mean_DiffVASLik_neg_Median = median(Diff_VAS_Lik_neg),
    Mean_DiffVASLik_neg_Lower = bayestestR::hdi(Diff_VAS_Lik_neg, ci = 0.9)$CI_low,
    Mean_DiffVASLik_neg_Upper = bayestestR::hdi(Diff_VAS_Lik_neg, ci = 0.9)$CI_high,
    Mean_PercExpl_neg_Median = median(PercExpl_neg),
    Mean_PercExpl_neg_Lower = bayestestR::hdi(PercExpl_neg, ci = 0.9)$CI_low,
    Mean_PercExpl_neg_Upper = bayestestR::hdi(PercExpl_neg, ci = 0.9)$CI_high
    ) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "valence", "Estimate"),
               names_pattern = "^Mean_(.*)_(.*)_(.*)$") %>%
  mutate(Model = "MappingSkew_Valence")

```

###VAS2Lik:Correlations with BSI

```{r correlations.BSI}
load("Model_BSI_VAS2Lik_group_fixed_fit.Rdata")
summary(Model_BSI_VAS2Lik_group_fixed_fit)

variables(Model_BSI_VAS2Lik_group_fixed_fit)

Model_BSI_VAS2Lik_group_fixed_fit_draws_long <- Model_BSI_VAS2Lik_group_fixed_fit %>% posterior_samples() %>% dplyr::select(starts_with("b_")) %>%
  dplyr::select(-contains("sigma")) %>% as_draws_array() %>% as_draws_df() %>%
  pivot_longer(cols = starts_with("b_"), names_to = "parameter", values_to = "value") %>% mutate(parameter = str_remove(parameter, "_BSIz"),
                    parameter = str_remove(parameter, "b_"),
                    parameter = str_remove(parameter, "format")) %>% mutate(OriginalParameter = parameter) %>%
  # Now separate the copied 'OriginalParameter' column into two new columns
  separate(OriginalParameter, into = c("Emotion", "Format"), sep = ":", extra = "merge") %>% mutate(Emotion = str_remove(Emotion, "z")) # %>% dplyr::select(-`.chain`, -`.iteration`, -`.draw`) %>%
  

Correlations_BSI_VAS2Lik_summary_stats <- Model_BSI_VAS2Lik_group_fixed_fit_draws_long %>%
  group_by(Emotion, Format) %>%
  dplyr::summarise(
    Median = median(value),
    HDI_Lower =bayestestR::hdi(value, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(value, ci = 0.9)$CI_high
  ) 

Model_BSI_VAS2Lik_group_fixed_fit_draws_wider <- Model_BSI_VAS2Lik_group_fixed_fit_draws_long %>%
  pivot_wider(names_from = Format, values_from = value,
              id_cols = c(".chain", "Emotion", ".iteration", ".draw")) %>%
  mutate(Difference_VASLik = VAS - Likert,
         Difference_LikVAS2Lik = VAS2Likert - Likert,
         PercExpl = Difference_LikVAS2Lik/Difference_VASLik
         ) %>%
  mutate(Emotion = gsub("b_", "", Emotion)) %>%
  mutate(valence = fct_recode(Emotion,
                              "positive" = "Energetic",
                              "positive" = "Happy",
                              "positive" = "LookForward",
                              "positive" = "SatisfiedS",
                              "positive" = "SatisfiedB",
                              "negative" = "Anxious",
                              "negative" = "Ashamed",
                              "negative" = "Discomfort",
                              "negative" = "Disgusted",
                              "negative" = "Guilty",
                              "negative" = "Irritated",
                              "negative" = "Lonely",
                              "negative" = "Sad",
                              "negative" = "Stressed"))

Correlations_BSI_VAS2Lik_summary_stats_Diff <- Model_BSI_VAS2Lik_group_fixed_fit_draws_wider %>%
  group_by(Emotion) %>%
  summarise(
    Median = median(Difference_VASLik),
    HDI_Lower =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_high
  ) 


save(Correlations_BSI_VAS2Lik_VAS2Lik_summary_stats, file = "Correlations_BSI_VAS2Lik_summary_stats.Rdata")
# 
# BSI_VAS2Lik_fixedeffects <- Model_BSI_VAS2Lik_group_fixed_fit_draws_wider %>%
#   group_by(valence, .draw) %>%
#   dplyr::summarize(BSI_Likert = mean(Likert),
#                    BSI_VAS = mean(VAS),
#                    BSI_VAS2Lik = mean(VAS2Likert),
#                    BSI_Diff_VASLik = mean(VAS - Likert),
#                    BSI_Diff_VAS2LikLik = mean(VAS2Likert - Likert),
#                    BSI_Diff_Expl = BSI_Diff_VAS2LikLik/BSI_Diff_VASLik) %>%
#   pivot_wider(values_from = c(BSI_Likert, BSI_VAS, BSI_VAS2Lik, BSI_Diff_VASLik, BSI_Diff_VAS2LikLik, BSI_Diff_Expl), names_from = valence) %>%
#   mutate(BSI_Likert = (abs(BSI_Likert_negative) + abs(BSI_Likert_positive))/2,
#          BSI_VAS = (abs(BSI_VAS_negative) + abs(BSI_VAS_positive))/2,
#          BSI_VAS2Lik = (abs(BSI_VAS2Lik_negative) + abs(BSI_VAS2Lik_positive)/2),
#          BSI_Diff_VASLik = (abs(BSI_Diff_VASLik_negative) + abs(BSI_Diff_VASLik_positive))/2,
#          BSI_Diff_VAS2LikLik = (abs(BSI_Diff_VAS2LikLik_negative) + abs(BSI_Diff_VAS2LikLik_positive))/2,
#          BSI_Diff_Expl = 1-((abs(BSI_Diff_Expl_negative) + abs(BSI_Diff_Expl_positive))/2)
#          ) %>%
#   ungroup %>%
#   dplyr::summarize(corrBSI_Likert_Median = median(BSI_Likert),
#                    corrBSI_VAS_Median = median(BSI_VAS),
#                    corrBSI_VAS2Lik_Median = median(BSI_VAS2Lik),
#                    corrBSI_DiffVAS2LikLik_Median = median(BSI_Diff_VAS2LikLik),
#                    corrBSI_DiffVASLik_Median = median(BSI_Diff_VASLik),
#                    corrBSI_PercExpl_Median = median(BSI_Diff_Expl),
#                    corrBSI_Likert_Lower =bayestestR::hdi(BSI_Likert, ci = 0.9)$CI_low,
#                    corrBSI_Likert_Upper =bayestestR::hdi(BSI_Likert, ci = 0.9)$CI_high,
#                    corrBSI_VAS_Lower =bayestestR::hdi(BSI_VAS, ci = 0.9)$CI_low,
#                    corrBSI_VAS_Upper =bayestestR::hdi(BSI_VAS, ci = 0.9)$CI_high,
#                    corrBSI_VAS2Lik_Lower = bayestestR::hdi(BSI_VAS2Lik, ci = 0.9)$CI_low,
#                    corrBSI_VAS2Lik_Upper = bayestestR::hdi(BSI_VAS2Lik, ci = 0.9)$CI_high,
#                    corrBSI_DiffVAS2LikLik_Lower =bayestestR::hdi(BSI_Diff_VAS2LikLik, ci = 0.9)$CI_low,
#                    corrBSI_DiffVAS2LikLik_Upper =bayestestR::hdi(BSI_Diff_VAS2LikLik, ci = 0.9)$CI_high,
#                    corrBSI_DiffVASLik_Lower =bayestestR::hdi(BSI_Diff_VASLik, ci = 0.9)$CI_low,
#                    corrBSI_DiffVASLik_Upper =bayestestR::hdi(BSI_Diff_VASLik, ci = 0.9)$CI_high,
#                    corrBSI_PercExpl_Lower =bayestestR::hdi(BSI_Diff_Expl, ci = 0.9)$CI_low,
#                    corrBSI_PercExpl_Upper =bayestestR::hdi(BSI_Diff_Expl, ci = 0.9)$CI_high) %>%
#   pivot_longer(cols = everything(),
#                names_to = c(".value", "Estimate"),
#                names_pattern = "^corrBSI_(.*)_(.*)$") %>%
#   mutate(Model = "MappingBSI")
# #Likert .29, VAS .52, diff .22

# seek and destroy bugs
# 

#Take the average absolute estimated correlation across all emotions within a draw and then get median and hdi of that derivedposterior?
#No weighing!!!
BSI_VAS2Lik_fixedeffects <- Model_BSI_VAS2Lik_group_fixed_fit_draws_wider %>%
  group_by(.draw) %>%
  dplyr::summarize(BSI_Likert = mean(abs(Likert)),
                   BSI_VAS = mean(abs(VAS)),
                   BSI_VAS2Lik = mean(abs(VAS2Likert)),
                   BSI_Diff_VASLik = BSI_VAS - BSI_Likert,
                   BSI_Diff_VAS2LikLik = BSI_VAS2Lik - BSI_Likert,
                   BSI_Diff_VAS_VAS2Lik = BSI_VAS - BSI_VAS2Lik,
                   BSI_Diff_Expl = (BSI_VAS - BSI_VAS2Lik) / (BSI_VAS - BSI_Likert)) %>%
  ungroup %>%
  dplyr::summarize(corrBSI_Likert_Median = median(BSI_Likert),
                   corrBSI_VAS_Median = median(BSI_VAS),
                   corrBSI_VAS2Lik_Median = median(BSI_VAS2Lik),
                   corrBSI_DiffVAS2LikLik_Median = median(BSI_Diff_VAS2LikLik),
                   corrBSI_DiffVASLik_Median = median(BSI_Diff_VASLik),
                   corrBSI_DiffVASVAS2Lik_Median = median(BSI_Diff_VAS_VAS2Lik),
                   corrBSI_PercExpl_Median = median(BSI_Diff_Expl),
                   corrBSI_Likert_Lower =bayestestR::hdi(BSI_Likert, ci = 0.9)$CI_low,
                   corrBSI_Likert_Upper =bayestestR::hdi(BSI_Likert, ci = 0.9)$CI_high,
                   corrBSI_VAS_Lower =bayestestR::hdi(BSI_VAS, ci = 0.9)$CI_low,
                   corrBSI_VAS_Upper =bayestestR::hdi(BSI_VAS, ci = 0.9)$CI_high,
                   corrBSI_VAS2Lik_Lower = bayestestR::hdi(BSI_VAS2Lik, ci = 0.9)$CI_low,
                   corrBSI_VAS2Lik_Upper = bayestestR::hdi(BSI_VAS2Lik, ci = 0.9)$CI_high,
                   corrBSI_DiffVAS2LikLik_Lower =bayestestR::hdi(BSI_Diff_VAS2LikLik, ci = 0.9)$CI_low,
                   corrBSI_DiffVAS2LikLik_Upper =bayestestR::hdi(BSI_Diff_VAS2LikLik, ci = 0.9)$CI_high,
                   corrBSI_DiffVASLik_Lower =bayestestR::hdi(BSI_Diff_VASLik, ci = 0.9)$CI_low,
                   corrBSI_DiffVASLik_Upper =bayestestR::hdi(BSI_Diff_VASLik, ci = 0.9)$CI_high,
                   corrBSI_DiffVASVAS2Lik_Lower =bayestestR::hdi(BSI_Diff_VAS_VAS2Lik, ci = 0.9)$CI_low,
                   corrBSI_DiffVASVAS2Lik_Upper =bayestestR::hdi(BSI_Diff_VAS_VAS2Lik, ci = 0.9)$CI_high,
                   corrBSI_PercExpl_Lower =bayestestR::hdi(BSI_Diff_Expl, ci = 0.9)$CI_low,
                   corrBSI_PercExpl_Upper =bayestestR::hdi(BSI_Diff_Expl, ci = 0.9)$CI_high) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^corrBSI_(.*)_(.*)$") %>%
  mutate(Model = "MappingBSI")
# #Likert .29, VAS .52, diff .22

BSI_VAS2Lik_fixedeffects_valence <- Model_BSI_VAS2Lik_group_fixed_fit_draws_wider %>%
  group_by(valence, .draw) %>%
  dplyr::summarize(BSI_Likert = mean(abs(Likert)),
                   BSI_VAS = mean(abs(VAS)),
                   BSI_VAS2Lik = mean(abs(VAS2Likert)),
                   BSI_Diff_VASLik = mean(VAS - Likert),
                   BSI_Diff_VAS2LikLik = mean(VAS2Likert - Likert),
                   BSI_Diff_VAS_VAS2Lik = BSI_VAS - BSI_VAS2Lik,
                   BSI_Diff_Expl = (BSI_VAS - BSI_VAS2Lik) / (BSI_VAS - BSI_Likert)) %>%
  ungroup %>%
  group_by(valence) %>%
  dplyr::summarize(corrBSI_Likert_Median = median(BSI_Likert),
                   corrBSI_VAS_Median = median(BSI_VAS),
                   corrBSI_VAS2Lik_Median = median(BSI_VAS2Lik),
                   corrBSI_DiffVAS2LikLik_Median = median(BSI_Diff_VAS2LikLik),
                   corrBSI_DiffVASLik_Median = median(BSI_Diff_VASLik),
                   corrBSI_PercExpl_Median = median(BSI_Diff_Expl),
                   corrBSI_Likert_Lower =bayestestR::hdi(BSI_Likert, ci = 0.9)$CI_low,
                   corrBSI_Likert_Upper =bayestestR::hdi(BSI_Likert, ci = 0.9)$CI_high,
                   corrBSI_VAS_Lower =bayestestR::hdi(BSI_VAS, ci = 0.9)$CI_low,
                   corrBSI_VAS_Upper =bayestestR::hdi(BSI_VAS, ci = 0.9)$CI_high,
                   corrBSI_VAS2Lik_Lower = bayestestR::hdi(BSI_VAS2Lik, ci = 0.9)$CI_low,
                   corrBSI_VAS2Lik_Upper = bayestestR::hdi(BSI_VAS2Lik, ci = 0.9)$CI_high,
                   corrBSI_DiffVAS2LikLik_Lower =bayestestR::hdi(BSI_Diff_VAS2LikLik, ci = 0.9)$CI_low,
                   corrBSI_DiffVAS2LikLik_Upper =bayestestR::hdi(BSI_Diff_VAS2LikLik, ci = 0.9)$CI_high,
                   corrBSI_DiffVASLik_Lower =bayestestR::hdi(BSI_Diff_VASLik, ci = 0.9)$CI_low,
                   corrBSI_DiffVASLik_Upper =bayestestR::hdi(BSI_Diff_VASLik, ci = 0.9)$CI_high,
                   corrBSI_PercExpl_Lower =bayestestR::hdi(BSI_Diff_Expl, ci = 0.9)$CI_low,
                   corrBSI_PercExpl_Upper =bayestestR::hdi(BSI_Diff_Expl, ci = 0.9)$CI_high) %>%
  pivot_longer(cols = -valence,
               names_to = c(".value", "Estimate"),
               names_pattern = "^corrBSI_(.*)_(.*)$") %>%
  mutate(Model = "MappingBSI_Valence")

# Correlations_BSI_VAS2Lik_summary_stats[dim(Correlations_BSI_VAS2Lik_summary_stats)[1] + 1,] <- c("Average", "Likert", BSI_VAS2Lik_fixedeffects[1, 1], BSI_VAS2Lik_fixedeffects[1, 4], BSI_VAS2Lik_fixedeffects[1, 5])
# 
# Correlations_BSI_VAS2Lik_summary_stats[dim(Correlations_BSI_VAS2Lik_summary_stats)[1] + 1,] <- c("Average", "VAS", BSI_VAS2Lik_fixedeffects[1, 2], BSI_VAS2Lik_fixedeffects[1, 6], BSI_VAS2Lik_fixedeffects[1, 7])
# 
# Correlations_BSI_VAS2Lik_summary_stats[dim(Correlations_BSI_VAS2Lik_summary_stats)[1] + 1,] <- c("Average", "Diff", BSI_VAS2Lik_fixedeffects[1, 3], BSI_VAS2Lik_fixedeffects[1, 8], BSI_VAS2Lik_fixedeffects[1, 9])

save(Correlations_BSI_VAS2Lik_summary_stats, file = "Correlations_BSI_VAS2Lik_summary_stats.Rdata")

##Descriptive check
# Correlations_BSI_VAS2Lik_summary_stats %>% filter(Emotion != "Average") %>%
#   group_by(Format) %>%
#   summarize(Average = mean(abs(Median)))
#.30 and .54 for Lik and VAS - fits!

```

### VAS2Lik: Correlations with DASS_S: Results

```{r correlations.DASS_S}

load("Model_DASS_S_VAS2Lik_group_fixed_fit.Rdata")

summary(Model_DASS_S_VAS2Lik_group_fixed_fit)

variables(Model_DASS_S_VAS2Lik_group_fixed_fit)

Model_DASS_S_VAS2Lik_group_fixed_fit_draws_long <- Model_DASS_S_VAS2Lik_group_fixed_fit %>% posterior_samples() %>% dplyr::select(starts_with("b_")) %>%
  dplyr::select(-contains("sigma")) %>% as_draws_array() %>% as_draws_df() %>%
  pivot_longer(cols = starts_with("b_"), names_to = "parameter", values_to = "value") %>% mutate(parameter = str_remove(parameter, "_BSIz"),
                    parameter = str_remove(parameter, "b_"),
                    parameter = str_remove(parameter, "format")) %>% mutate(OriginalParameter = parameter) %>%
  # Now separate the copied 'OriginalParameter' column into two new columns
  separate(OriginalParameter, into = c("Emotion", "Format"), sep = ":", extra = "merge") %>% mutate(Emotion = str_remove(Emotion, "z")) # %>% dplyr::select(-`.chain`, -`.iteration`, -`.draw`) %>%
  

Correlations_DASS_S_VAS2Lik_summary_stats <- Model_DASS_S_VAS2Lik_group_fixed_fit_draws_long %>%
  group_by(Emotion, Format) %>%
  dplyr::summarise(
    Median = median(value),
    HDI_Lower =bayestestR::hdi(value, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(value, ci = 0.9)$CI_high
  ) 

Model_DASS_S_VAS2Lik_group_fixed_fit_draws_wider <- Model_DASS_S_VAS2Lik_group_fixed_fit_draws_long %>%
  pivot_wider(names_from = Format, values_from = value,
              id_cols = c(".chain", "Emotion", ".iteration", ".draw")) %>%
  # dplyr::rename("VAS" = "formatVAS",
  #               "Likert" = "formatLikert",
  #               "VAS2Likert" = "formatVAS2Lik") %>%
  mutate(Difference_VASLik = VAS - Likert,
         Difference_LikVAS2Lik = VAS2Lik - Likert,
         PercExpl = Difference_LikVAS2Lik/Difference_VASLik
         ) %>%
  mutate(Emotion = gsub("b_", "", Emotion)) %>%
  mutate(Emotion = gsub("_DASS_Sz", "", Emotion)) %>%
  mutate(valence = fct_recode(Emotion,
                              "positive" = "Energetic",
                              "positive" = "Happy",
                              "positive" = "LookForward",
                              "positive" = "SatisfiedS",
                              "positive" = "SatisfiedB",
                              "negative" = "Anxious",
                              "negative" = "Ashamed",
                              "negative" = "Discomfort",
                              "negative" = "Disgusted",
                              "negative" = "Guilty",
                              "negative" = "Irritated",
                              "negative" = "Lonely",
                              "negative" = "Sad",
                              "negative" = "Stressed"))

Correlations_DASS_S_VAS2Lik_summary_stats_Diff <- Model_DASS_S_VAS2Lik_group_fixed_fit_draws_wider %>%
  group_by(Emotion) %>%
  summarise(
    Median = median(Difference_VASLik),
    HDI_Lower =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_high
  ) 


save(Correlations_DASS_S_VAS2Lik_summary_stats, file = "Correlations_DASS_S_VAS2Lik_summary_stats.Rdata")

DASS_S_VAS2Lik_fixedeffects <- Model_DASS_S_VAS2Lik_group_fixed_fit_draws_wider %>%
  group_by(.draw) %>%
  dplyr::summarize(DASS_S_Likert = mean(abs(Likert)),
                   DASS_S_VAS = mean(abs(VAS)),
                   DASS_S_VAS2Lik = mean(abs(VAS2Lik)),
                   DASS_S_Diff_VASLik = DASS_S_VAS - DASS_S_Likert,
                   DASS_S_Diff_VAS2LikLik = DASS_S_VAS2Lik - DASS_S_Likert,
                   DASS_S_Diff_VAS_VAS2Lik = DASS_S_VAS - DASS_S_VAS2Lik,
                   DASS_S_Diff_Expl = (DASS_S_VAS - DASS_S_VAS2Lik) / (DASS_S_VAS - DASS_S_Likert)) %>%
  ungroup %>%
  dplyr::summarize(corrDASS_S_Likert_Median = median(DASS_S_Likert),
                   corrDASS_S_VAS_Median = median(DASS_S_VAS),
                   corrDASS_S_VAS2Lik_Median = median(DASS_S_VAS2Lik),
                   corrDASS_S_DiffVAS2LikLik_Median = median(DASS_S_Diff_VAS2LikLik),
                   corrDASS_S_DiffVASLik_Median = median(DASS_S_Diff_VASLik),
                   corrDASS_S_DiffVASVAS2Lik_Median = median(DASS_S_Diff_VAS_VAS2Lik),
                   corrDASS_S_PercExpl_Median = median(DASS_S_Diff_Expl),
                   corrDASS_S_Likert_Lower =bayestestR::hdi(DASS_S_Likert, ci = 0.9)$CI_low,
                   corrDASS_S_Likert_Upper =bayestestR::hdi(DASS_S_Likert, ci = 0.9)$CI_high,
                   corrDASS_S_VAS_Lower =bayestestR::hdi(DASS_S_VAS, ci = 0.9)$CI_low,
                   corrDASS_S_VAS_Upper =bayestestR::hdi(DASS_S_VAS, ci = 0.9)$CI_high,
                   corrDASS_S_VAS2Lik_Lower = bayestestR::hdi(DASS_S_VAS2Lik, ci = 0.9)$CI_low,
                   corrDASS_S_VAS2Lik_Upper = bayestestR::hdi(DASS_S_VAS2Lik, ci = 0.9)$CI_high,
                   corrDASS_S_DiffVAS2LikLik_Lower =bayestestR::hdi(DASS_S_Diff_VAS2LikLik, ci = 0.9)$CI_low,
                   corrDASS_S_DiffVAS2LikLik_Upper =bayestestR::hdi(DASS_S_Diff_VAS2LikLik, ci = 0.9)$CI_high,
                   corrDASS_S_DiffVASLik_Lower =bayestestR::hdi(DASS_S_Diff_VASLik, ci = 0.9)$CI_low,
                   corrDASS_S_DiffVASLik_Upper =bayestestR::hdi(DASS_S_Diff_VASLik, ci = 0.9)$CI_high,
                   corrDASS_S_DiffVASVAS2Lik_Lower =bayestestR::hdi(DASS_S_Diff_VAS_VAS2Lik, ci = 0.9)$CI_low,
                   corrDASS_S_DiffVASVAS2Lik_Upper =bayestestR::hdi(DASS_S_Diff_VAS_VAS2Lik, ci = 0.9)$CI_high,
                   corrDASS_S_PercExpl_Lower =bayestestR::hdi(DASS_S_Diff_Expl, ci = 0.9)$CI_low,
                   corrDASS_S_PercExpl_Upper =bayestestR::hdi(DASS_S_Diff_Expl, ci = 0.9)$CI_high) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^corrDASS_S_(.*)_(.*)$") %>%
  mutate(Model = "MappingDASS_S")

DASS_S_VAS2Lik_fixedeffects_valence <- Model_DASS_S_VAS2Lik_group_fixed_fit_draws_wider %>%
  group_by(valence, .draw) %>%
  dplyr::summarize(DASS_S_Likert = mean(abs(Likert)),
                   DASS_S_VAS = mean(abs(VAS)),
                   DASS_S_VAS2Lik = mean(abs(VAS2Lik)),
                   DASS_S_Diff_VASLik = mean(VAS - Likert),
                   DASS_S_Diff_VAS2LikLik = mean(VAS2Lik - Likert),
                   DASS_S_Diff_VAS_VAS2Lik = DASS_S_VAS - DASS_S_VAS2Lik,
                   DASS_S_Diff_Expl = (DASS_S_VAS - DASS_S_VAS2Lik) / (DASS_S_VAS - DASS_S_Likert)) %>%
  ungroup %>%
  group_by(valence) %>%
  dplyr::summarize(corrDASS_S_Likert_Median = median(DASS_S_Likert),
                   corrDASS_S_VAS_Median = median(DASS_S_VAS),
                   corrDASS_S_VAS2Lik_Median = median(DASS_S_VAS2Lik),
                   corrDASS_S_DiffVAS2LikLik_Median = median(DASS_S_Diff_VAS2LikLik),
                   corrDASS_S_DiffVASLik_Median = median(DASS_S_Diff_VASLik),
                   corrDASS_S_PercExpl_Median = median(DASS_S_Diff_Expl),
                   corrDASS_S_Likert_Lower =bayestestR::hdi(DASS_S_Likert, ci = 0.9)$CI_low,
                   corrDASS_S_Likert_Upper =bayestestR::hdi(DASS_S_Likert, ci = 0.9)$CI_high,
                   corrDASS_S_VAS_Lower =bayestestR::hdi(DASS_S_VAS, ci = 0.9)$CI_low,
                   corrDASS_S_VAS_Upper =bayestestR::hdi(DASS_S_VAS, ci = 0.9)$CI_high,
                   corrDASS_S_VAS2Lik_Lower = bayestestR::hdi(DASS_S_VAS2Lik, ci = 0.9)$CI_low,
                   corrDASS_S_VAS2Lik_Upper = bayestestR::hdi(DASS_S_VAS2Lik, ci = 0.9)$CI_high,
                   corrDASS_S_DiffVAS2LikLik_Lower =bayestestR::hdi(DASS_S_Diff_VAS2LikLik, ci = 0.9)$CI_low,
                   corrDASS_S_DiffVAS2LikLik_Upper =bayestestR::hdi(DASS_S_Diff_VAS2LikLik, ci = 0.9)$CI_high,
                   corrDASS_S_DiffVASLik_Lower =bayestestR::hdi(DASS_S_Diff_VASLik, ci = 0.9)$CI_low,
                   corrDASS_S_DiffVASLik_Upper =bayestestR::hdi(DASS_S_Diff_VASLik, ci = 0.9)$CI_high,
                   corrDASS_S_PercExpl_Lower =bayestestR::hdi(DASS_S_Diff_Expl, ci = 0.9)$CI_low,
                   corrDASS_S_PercExpl_Upper =bayestestR::hdi(DASS_S_Diff_Expl, ci = 0.9)$CI_high) %>%
  pivot_longer(cols = -valence,
               names_to = c(".value", "Estimate"),
               names_pattern = "^corrDASS_S_(.*)_(.*)$") %>%
  mutate(Model = "MappingDASS_S_Valence")

# Correlations_DASS_S_VAS2Lik_summary_stats[dim(Correlations_DASS_S_VAS2Lik_summary_stats)[1] + 1,] <- c("Average", "Likert", DASS_S_fixedeffects[1, 1], DASS_S_fixedeffects[1, 4], DASS_S_fixedeffects[1, 5])
# 
# Correlations_DASS_S_VAS2Lik_summary_stats[dim(Correlations_DASS_S_VAS2Lik_summary_stats)[1] + 1,] <- c("Average", "VAS", DASS_S_fixedeffects[1, 2], DASS_S_fixedeffects[1, 6], DASS_S_fixedeffects[1, 7])
# 
# Correlations_DASS_S_VAS2Lik_summary_stats[dim(Correlations_DASS_S_VAS2Lik_summary_stats)[1] + 1,] <- c("Average", "Diff", DASS_S_fixedeffects[1, 3], DASS_S_fixedeffects[1, 8], DASS_S_fixedeffects[1, 9])
# 
 save(Correlations_DASS_S_VAS2Lik_summary_stats, file = "Correlations_DASS_S_VAS2Lik_summary_stats.Rdata")

```

### VAS2Lik: Correlations with DASS_A: Results

```{r correlations.DASS_A}

load("Model_DASS_A_VAS2Lik_group_fixed_fit.Rdata")

summary(Model_DASS_A_VAS2Lik_group_fixed_fit)

variables(Model_DASS_A_VAS2Lik_group_fixed_fit)

Model_DASS_A_VAS2Lik_group_fixed_fit_draws_long <- Model_DASS_A_VAS2Lik_group_fixed_fit %>% posterior_samples() %>% dplyr::select(starts_with("b_")) %>%
  dplyr::select(-contains("sigma")) %>% as_draws_array() %>% as_draws_df() %>%
  pivot_longer(cols = starts_with("b_"), names_to = "parameter", values_to = "value") %>% mutate(parameter = str_remove(parameter, "_BSIz"),
                    parameter = str_remove(parameter, "b_"),
                    parameter = str_remove(parameter, "format")) %>% mutate(OriginalParameter = parameter) %>%
  # Now separate the copied 'OriginalParameter' column into two new columns
  separate(OriginalParameter, into = c("Emotion", "Format"), sep = ":", extra = "merge") %>% mutate(Emotion = str_remove(Emotion, "z")) # %>% dplyr::select(-`.chain`, -`.iteration`, -`.draw`) %>%
  

Correlations_DASS_A_VAS2Lik_summary_stats <- Model_DASS_A_VAS2Lik_group_fixed_fit_draws_long %>%
  group_by(Emotion, Format) %>%
  dplyr::summarise(
    Median = median(value),
    HDI_Lower =bayestestR::hdi(value, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(value, ci = 0.9)$CI_high
  ) 

Model_DASS_A_VAS2Lik_group_fixed_fit_draws_wider <- Model_DASS_A_VAS2Lik_group_fixed_fit_draws_long %>%
  pivot_wider(names_from = Format, values_from = value,
              id_cols = c(".chain", "Emotion", ".iteration", ".draw")) %>%
  # dplyr::rename("VAS" = "formatVAS",
  #               "Likert" = "formatLikert",
  #               "VAS2Likert" = "formatVAS2Lik") %>%
  mutate(Difference_VASLik = VAS - Likert,
         Difference_LikVAS2Lik = VAS2Lik - Likert,
         PercExpl = 1-(Difference_LikVAS2Lik/Difference_VASLik)
         ) %>%
  mutate(Emotion = gsub("b_", "", Emotion)) %>%
  mutate(Emotion = gsub("_DASS_Az", "", Emotion)) %>%
  mutate(valence = fct_recode(Emotion,
                              "positive" = "Energetic",
                              "positive" = "Happy",
                              "positive" = "LookForward",
                              "positive" = "SatisfiedS",
                              "positive" = "SatisfiedB",
                              "negative" = "Anxious",
                              "negative" = "Ashamed",
                              "negative" = "Discomfort",
                              "negative" = "Disgusted",
                              "negative" = "Guilty",
                              "negative" = "Irritated",
                              "negative" = "Lonely",
                              "negative" = "Sad",
                              "negative" = "Stressed"))

Correlations_DASS_A_VAS2Lik_summary_stats_Diff <- Model_DASS_A_VAS2Lik_group_fixed_fit_draws_wider %>%
  group_by(Emotion) %>%
  summarise(
    Median = median(Difference_VASLik),
    HDI_Lower =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_high
  ) 


save(Correlations_DASS_A_VAS2Lik_summary_stats, file = "Correlations_DASS_A_VAS2Lik_summary_stats.Rdata")

DASS_A_VAS2Lik_fixedeffects <- Model_DASS_A_VAS2Lik_group_fixed_fit_draws_wider %>%
  group_by(.draw) %>%
  dplyr::summarize(DASS_A_Likert = mean(abs(Likert)),
                   DASS_A_VAS = mean(abs(VAS)),
                   DASS_A_VAS2Lik = mean(abs(VAS2Lik)),
                   DASS_A_Diff_VASLik = DASS_A_VAS - DASS_A_Likert,
                   DASS_A_Diff_VAS2LikLik = DASS_A_VAS2Lik - DASS_A_Likert,
                   DASS_A_Diff_VAS_VAS2Lik = DASS_A_VAS - DASS_A_VAS2Lik,
                   DASS_A_Diff_Expl = (DASS_A_VAS - DASS_A_VAS2Lik) / (DASS_A_VAS - DASS_A_Likert)) %>%
  ungroup %>%
  dplyr::summarize(corrDASS_A_Likert_Median = median(DASS_A_Likert),
                   corrDASS_A_VAS_Median = median(DASS_A_VAS),
                   corrDASS_A_VAS2Lik_Median = median(DASS_A_VAS2Lik),
                   corrDASS_A_DiffVAS2LikLik_Median = median(DASS_A_Diff_VAS2LikLik),
                   corrDASS_A_DiffVASLik_Median = median(DASS_A_Diff_VASLik),
                   corrDASS_A_DiffVASVAS2Lik_Median = median(DASS_A_Diff_VAS_VAS2Lik),
                   corrDASS_A_PercExpl_Median = median(DASS_A_Diff_Expl),
                   corrDASS_A_Likert_Lower =bayestestR::hdi(DASS_A_Likert, ci = 0.9)$CI_low,
                   corrDASS_A_Likert_Upper =bayestestR::hdi(DASS_A_Likert, ci = 0.9)$CI_high,
                   corrDASS_A_VAS_Lower =bayestestR::hdi(DASS_A_VAS, ci = 0.9)$CI_low,
                   corrDASS_A_VAS_Upper =bayestestR::hdi(DASS_A_VAS, ci = 0.9)$CI_high,
                   corrDASS_A_VAS2Lik_Lower = bayestestR::hdi(DASS_A_VAS2Lik, ci = 0.9)$CI_low,
                   corrDASS_A_VAS2Lik_Upper = bayestestR::hdi(DASS_A_VAS2Lik, ci = 0.9)$CI_high,
                   corrDASS_A_DiffVAS2LikLik_Lower =bayestestR::hdi(DASS_A_Diff_VAS2LikLik, ci = 0.9)$CI_low,
                   corrDASS_A_DiffVAS2LikLik_Upper =bayestestR::hdi(DASS_A_Diff_VAS2LikLik, ci = 0.9)$CI_high,
                   corrDASS_A_DiffVASLik_Lower =bayestestR::hdi(DASS_A_Diff_VASLik, ci = 0.9)$CI_low,
                   corrDASS_A_DiffVASLik_Upper =bayestestR::hdi(DASS_A_Diff_VASLik, ci = 0.9)$CI_high,
                   corrDASS_A_DiffVASVAS2Lik_Lower =bayestestR::hdi(DASS_A_Diff_VAS_VAS2Lik, ci = 0.9)$CI_low,
                   corrDASS_A_DiffVASVAS2Lik_Upper =bayestestR::hdi(DASS_A_Diff_VAS_VAS2Lik, ci = 0.9)$CI_high,
                   corrDASS_A_PercExpl_Lower =bayestestR::hdi(DASS_A_Diff_Expl, ci = 0.9)$CI_low,
                   corrDASS_A_PercExpl_Upper =bayestestR::hdi(DASS_A_Diff_Expl, ci = 0.9)$CI_high) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^corrDASS_A_(.*)_(.*)$") %>%
  mutate(Model = "MappingDASS_A")

DASS_A_VAS2Lik_fixedeffects_valence <- Model_DASS_A_VAS2Lik_group_fixed_fit_draws_wider %>%
  group_by(valence, .draw) %>%
  dplyr::summarize(DASS_A_Likert = mean(abs(Likert)),
                   DASS_A_VAS = mean(abs(VAS)),
                   DASS_A_VAS2Lik = mean(abs(VAS2Lik)),
                   DASS_A_Diff_VASLik = mean(VAS - Likert),
                   DASS_A_Diff_VAS2LikLik = mean(VAS2Lik - Likert),
                   DASS_A_Diff_VAS_VAS2Lik = DASS_A_VAS - DASS_A_VAS2Lik,
                   DASS_A_Diff_Expl = (DASS_A_VAS - DASS_A_VAS2Lik) / (DASS_A_VAS - DASS_A_Likert)) %>%
  ungroup %>%
  group_by(valence) %>%
  dplyr::summarize(corrDASS_A_Likert_Median = median(DASS_A_Likert),
                   corrDASS_A_VAS_Median = median(DASS_A_VAS),
                   corrDASS_A_VAS2Lik_Median = median(DASS_A_VAS2Lik),
                   corrDASS_A_DiffVAS2LikLik_Median = median(DASS_A_Diff_VAS2LikLik),
                   corrDASS_A_DiffVASLik_Median = median(DASS_A_Diff_VASLik),
                   corrDASS_A_PercExpl_Median = median(DASS_A_Diff_Expl),
                   corrDASS_A_Likert_Lower =bayestestR::hdi(DASS_A_Likert, ci = 0.9)$CI_low,
                   corrDASS_A_Likert_Upper =bayestestR::hdi(DASS_A_Likert, ci = 0.9)$CI_high,
                   corrDASS_A_VAS_Lower =bayestestR::hdi(DASS_A_VAS, ci = 0.9)$CI_low,
                   corrDASS_A_VAS_Upper =bayestestR::hdi(DASS_A_VAS, ci = 0.9)$CI_high,
                   corrDASS_A_VAS2Lik_Lower = bayestestR::hdi(DASS_A_VAS2Lik, ci = 0.9)$CI_low,
                   corrDASS_A_VAS2Lik_Upper = bayestestR::hdi(DASS_A_VAS2Lik, ci = 0.9)$CI_high,
                   corrDASS_A_DiffVAS2LikLik_Lower =bayestestR::hdi(DASS_A_Diff_VAS2LikLik, ci = 0.9)$CI_low,
                   corrDASS_A_DiffVAS2LikLik_Upper =bayestestR::hdi(DASS_A_Diff_VAS2LikLik, ci = 0.9)$CI_high,
                   corrDASS_A_DiffVASLik_Lower =bayestestR::hdi(DASS_A_Diff_VASLik, ci = 0.9)$CI_low,
                   corrDASS_A_DiffVASLik_Upper =bayestestR::hdi(DASS_A_Diff_VASLik, ci = 0.9)$CI_high,
                   corrDASS_A_PercExpl_Lower =bayestestR::hdi(DASS_A_Diff_Expl, ci = 0.9)$CI_low,
                   corrDASS_A_PercExpl_Upper =bayestestR::hdi(DASS_A_Diff_Expl, ci = 0.9)$CI_high) %>%
  pivot_longer(cols = -valence,
               names_to = c(".value", "Estimate"),
               names_pattern = "^corrDASS_A_(.*)_(.*)$") %>%
  mutate(Model = "MappingDASS_A_Valence")

# Correlations_DASS_A_VAS2Lik_summary_stats[dim(Correlations_DASS_A_VAS2Lik_summary_stats)[1] + 1,] <- c("Average", "Likert", DASS_A_fixedeffects[1, 1], DASS_A_fixedeffects[1, 4], DASS_A_fixedeffects[1, 5])
# 
# Correlations_DASS_A_VAS2Lik_summary_stats[dim(Correlations_DASS_A_VAS2Lik_summary_stats)[1] + 1,] <- c("Average", "VAS", DASS_A_fixedeffects[1, 2], DASS_A_fixedeffects[1, 6], DASS_A_fixedeffects[1, 7])
# 
# Correlations_DASS_A_VAS2Lik_summary_stats[dim(Correlations_DASS_A_VAS2Lik_summary_stats)[1] + 1,] <- c("Average", "Diff", DASS_A_fixedeffects[1, 3], DASS_A_fixedeffects[1, 8], DASS_A_fixedeffects[1, 9])
# 
 save(Correlations_DASS_A_VAS2Lik_summary_stats, file = "Correlations_DASS_A_VAS2Lik_summary_stats.Rdata")

```

### VAS2Lik: Correlations with DASS_D: Results

```{r correlations.DASS_D}

load("Model_DASS_D_VAS2Lik_group_fixed_fit.Rdata")

summary(Model_DASS_D_VAS2Lik_group_fixed_fit)

variables(Model_DASS_D_VAS2Lik_group_fixed_fit)

Model_DASS_D_VAS2Lik_group_fixed_fit_draws_long <- Model_DASS_D_VAS2Lik_group_fixed_fit %>% posterior_samples() %>% dplyr::select(starts_with("b_")) %>%
  dplyr::select(-contains("sigma")) %>% as_draws_array() %>% as_draws_df() %>%
  pivot_longer(cols = starts_with("b_"), names_to = "parameter", values_to = "value") %>% mutate(parameter = str_remove(parameter, "_BSIz"),
                    parameter = str_remove(parameter, "b_"),
                    parameter = str_remove(parameter, "format")) %>% mutate(OriginalParameter = parameter) %>%
  # Now separate the copied 'OriginalParameter' column into two new columns
  separate(OriginalParameter, into = c("Emotion", "Format"), sep = ":", extra = "merge") %>% mutate(Emotion = str_remove(Emotion, "z")) # %>% dplyr::select(-`.chain`, -`.iteration`, -`.draw`) %>%
  

Correlations_DASS_D_VAS2Lik_summary_stats <- Model_DASS_D_VAS2Lik_group_fixed_fit_draws_long %>%
  group_by(Emotion, Format) %>%
  dplyr::summarise(
    Median = median(value),
    HDI_Lower =bayestestR::hdi(value, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(value, ci = 0.9)$CI_high
  ) 

Model_DASS_D_VAS2Lik_group_fixed_fit_draws_wider <- Model_DASS_D_VAS2Lik_group_fixed_fit_draws_long %>%
  pivot_wider(names_from = Format, values_from = value,
              id_cols = c(".chain", "Emotion", ".iteration", ".draw")) %>%
  # dplyr::rename("VAS" = "formatVAS",
  #               "Likert" = "formatLikert",
  #               "VAS2Likert" = "formatVAS2Lik") %>%
  mutate(Difference_VASLik = VAS - Likert,
         Difference_LikVAS2Lik = VAS2Lik - Likert,
         PercExpl = 1-(Difference_LikVAS2Lik/Difference_VASLik)
         ) %>%
  mutate(Emotion = gsub("b_", "", Emotion)) %>%
  mutate(Emotion = gsub("_DASS_Dz", "", Emotion)) %>%
  mutate(valence = fct_recode(Emotion,
                              "positive" = "Energetic",
                              "positive" = "Happy",
                              "positive" = "LookForward",
                              "positive" = "SatisfiedS",
                              "positive" = "SatisfiedB",
                              "negative" = "Anxious",
                              "negative" = "Ashamed",
                              "negative" = "Discomfort",
                              "negative" = "Disgusted",
                              "negative" = "Guilty",
                              "negative" = "Irritated",
                              "negative" = "Lonely",
                              "negative" = "Sad",
                              "negative" = "Stressed"))

Correlations_DASS_D_VAS2Lik_summary_stats_Diff <- Model_DASS_D_VAS2Lik_group_fixed_fit_draws_wider %>%
  group_by(Emotion) %>%
  summarise(
    Median = median(Difference_VASLik),
    HDI_Lower =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_low,
    HDI_Upper =bayestestR::hdi(Difference_VASLik, ci = 0.9)$CI_high
  ) 


save(Correlations_DASS_D_VAS2Lik_summary_stats, file = "Correlations_DASS_D_VAS2Lik_summary_stats.Rdata")

DASS_D_VAS2Lik_fixedeffects <- Model_DASS_D_VAS2Lik_group_fixed_fit_draws_wider %>%
  group_by(.draw) %>%
  dplyr::summarize(DASS_D_Likert = mean(abs(Likert)),
                   DASS_D_VAS = mean(abs(VAS)),
                   DASS_D_VAS2Lik = mean(abs(VAS2Lik)),
                   DASS_D_Diff_VASLik = DASS_D_VAS - DASS_D_Likert,
                   DASS_D_Diff_VAS2LikLik = DASS_D_VAS2Lik - DASS_D_Likert,
                   DASS_D_Diff_VAS_VAS2Lik = DASS_D_VAS - DASS_D_VAS2Lik,
                   DASS_D_Diff_Expl = (DASS_D_VAS - DASS_D_VAS2Lik) / (DASS_D_VAS - DASS_D_Likert)) %>%
  ungroup %>%
  dplyr::summarize(corrDASS_D_Likert_Median = median(DASS_D_Likert),
                   corrDASS_D_VAS_Median = median(DASS_D_VAS),
                   corrDASS_D_VAS2Lik_Median = median(DASS_D_VAS2Lik),
                   corrDASS_D_DiffVAS2LikLik_Median = median(DASS_D_Diff_VAS2LikLik),
                   corrDASS_D_DiffVASLik_Median = median(DASS_D_Diff_VASLik),
                   corrDASS_D_DiffVASVAS2Lik_Median = median(DASS_D_Diff_VAS_VAS2Lik),
                   corrDASS_D_PercExpl_Median = median(DASS_D_Diff_Expl),
                   corrDASS_D_Likert_Lower =bayestestR::hdi(DASS_D_Likert, ci = 0.9)$CI_low,
                   corrDASS_D_Likert_Upper =bayestestR::hdi(DASS_D_Likert, ci = 0.9)$CI_high,
                   corrDASS_D_VAS_Lower =bayestestR::hdi(DASS_D_VAS, ci = 0.9)$CI_low,
                   corrDASS_D_VAS_Upper =bayestestR::hdi(DASS_D_VAS, ci = 0.9)$CI_high,
                   corrDASS_D_VAS2Lik_Lower = bayestestR::hdi(DASS_D_VAS2Lik, ci = 0.9)$CI_low,
                   corrDASS_D_VAS2Lik_Upper = bayestestR::hdi(DASS_D_VAS2Lik, ci = 0.9)$CI_high,
                   corrDASS_D_DiffVAS2LikLik_Lower =bayestestR::hdi(DASS_D_Diff_VAS2LikLik, ci = 0.9)$CI_low,
                   corrDASS_D_DiffVAS2LikLik_Upper =bayestestR::hdi(DASS_D_Diff_VAS2LikLik, ci = 0.9)$CI_high,
                   corrDASS_D_DiffVASLik_Lower =bayestestR::hdi(DASS_D_Diff_VASLik, ci = 0.9)$CI_low,
                   corrDASS_D_DiffVASLik_Upper =bayestestR::hdi(DASS_D_Diff_VASLik, ci = 0.9)$CI_high,
                   corrDASS_D_DiffVASVAS2Lik_Lower =bayestestR::hdi(DASS_D_Diff_VAS_VAS2Lik, ci = 0.9)$CI_low,
                   corrDASS_D_DiffVASVAS2Lik_Upper =bayestestR::hdi(DASS_D_Diff_VAS_VAS2Lik, ci = 0.9)$CI_high,
                   corrDASS_D_PercExpl_Lower =bayestestR::hdi(DASS_D_Diff_Expl, ci = 0.9)$CI_low,
                   corrDASS_D_PercExpl_Upper =bayestestR::hdi(DASS_D_Diff_Expl, ci = 0.9)$CI_high) %>%
  pivot_longer(cols = everything(),
               names_to = c(".value", "Estimate"),
               names_pattern = "^corrDASS_D_(.*)_(.*)$") %>%
  mutate(Model = "MappingDASS_D")

DASS_D_VAS2Lik_fixedeffects_valence <- Model_DASS_D_VAS2Lik_group_fixed_fit_draws_wider %>%
  group_by(valence, .draw) %>%
  dplyr::summarize(DASS_D_Likert = mean(abs(Likert)),
                   DASS_D_VAS = mean(abs(VAS)),
                   DASS_D_VAS2Lik = mean(abs(VAS2Lik)),
                   DASS_D_Diff_VASLik = mean(VAS - Likert),
                   DASS_D_Diff_VAS2LikLik = mean(VAS2Lik - Likert),
                   DASS_D_Diff_VAS_VAS2Lik = DASS_D_VAS - DASS_D_VAS2Lik,
                   DASS_D_Diff_Expl = (DASS_D_VAS - DASS_D_VAS2Lik) / (DASS_D_VAS - DASS_D_Likert)) %>%
  ungroup %>%
  group_by(valence) %>%
  dplyr::summarize(corrDASS_D_Likert_Median = median(DASS_D_Likert),
                   corrDASS_D_VAS_Median = median(DASS_D_VAS),
                   corrDASS_D_VAS2Lik_Median = median(DASS_D_VAS2Lik),
                   corrDASS_D_DiffVAS2LikLik_Median = median(DASS_D_Diff_VAS2LikLik),
                   corrDASS_D_DiffVASLik_Median = median(DASS_D_Diff_VASLik),
                   corrDASS_D_PercExpl_Median = median(DASS_D_Diff_Expl),
                   corrDASS_D_Likert_Lower =bayestestR::hdi(DASS_D_Likert, ci = 0.9)$CI_low,
                   corrDASS_D_Likert_Upper =bayestestR::hdi(DASS_D_Likert, ci = 0.9)$CI_high,
                   corrDASS_D_VAS_Lower =bayestestR::hdi(DASS_D_VAS, ci = 0.9)$CI_low,
                   corrDASS_D_VAS_Upper =bayestestR::hdi(DASS_D_VAS, ci = 0.9)$CI_high,
                   corrDASS_D_VAS2Lik_Lower = bayestestR::hdi(DASS_D_VAS2Lik, ci = 0.9)$CI_low,
                   corrDASS_D_VAS2Lik_Upper = bayestestR::hdi(DASS_D_VAS2Lik, ci = 0.9)$CI_high,
                   corrDASS_D_DiffVAS2LikLik_Lower =bayestestR::hdi(DASS_D_Diff_VAS2LikLik, ci = 0.9)$CI_low,
                   corrDASS_D_DiffVAS2LikLik_Upper =bayestestR::hdi(DASS_D_Diff_VAS2LikLik, ci = 0.9)$CI_high,
                   corrDASS_D_DiffVASLik_Lower =bayestestR::hdi(DASS_D_Diff_VASLik, ci = 0.9)$CI_low,
                   corrDASS_D_DiffVASLik_Upper =bayestestR::hdi(DASS_D_Diff_VASLik, ci = 0.9)$CI_high,
                   corrDASS_D_PercExpl_Lower =bayestestR::hdi(DASS_D_Diff_Expl, ci = 0.9)$CI_low,
                   corrDASS_D_PercExpl_Upper =bayestestR::hdi(DASS_D_Diff_Expl, ci = 0.9)$CI_high) %>%
  pivot_longer(cols = -valence,
               names_to = c(".value", "Estimate"),
               names_pattern = "^corrDASS_D_(.*)_(.*)$") %>%
  mutate(Model = "MappingDASS_D_Valence")

# Correlations_DASS_D_VAS2Lik_summary_stats[dim(Correlations_DASS_D_VAS2Lik_summary_stats)[1] + 1,] <- c("Average", "Likert", DASS_D_fixedeffects[1, 1], DASS_D_fixedeffects[1, 4], DASS_D_fixedeffects[1, 5])
# 
# Correlations_DASS_D_VAS2Lik_summary_stats[dim(Correlations_DASS_D_VAS2Lik_summary_stats)[1] + 1,] <- c("Average", "VAS", DASS_D_fixedeffects[1, 2], DASS_D_fixedeffects[1, 6], DASS_D_fixedeffects[1, 7])
# 
# Correlations_DASS_D_VAS2Lik_summary_stats[dim(Correlations_DASS_D_VAS2Lik_summary_stats)[1] + 1,] <- c("Average", "Diff", DASS_D_fixedeffects[1, 3], DASS_D_fixedeffects[1, 8], DASS_D_fixedeffects[1, 9])
# 
 save(Correlations_DASS_D_VAS2Lik_summary_stats, file = "Correlations_DASS_D_VAS2Lik_summary_stats.Rdata")

```


### VAS2Lik: Results Export

```{r VAS2Lik.export}


EMM_Mapping <- rbind(EMM_MappingMean,
                     EMM_MappingCorLag0,
                     EMM_MappingAR,
                     EMM_MappingSkew,
                     BSI_VAS2Lik_fixedeffects,
                     DASS_D_VAS2Lik_fixedeffects,
                     DASS_A_VAS2Lik_fixedeffects,
                     DASS_S_VAS2Lik_fixedeffects)

save(EMM_Mapping, file = "EMM_Mapping.Rdata")

EMM_Mapping_Valence <- rbind(EMM_MappingMean_Valence,
                     EMM_MappingCorLag0_Valence,
                     EMM_MappingAR_Valence,
                     EMM_MappingSkew_Valence,
                     BSI_VAS2Lik_fixedeffects_valence,
                     DASS_D_VAS2Lik_fixedeffects_valence,
                     DASS_A_VAS2Lik_fixedeffects_valence,
                     DASS_S_VAS2Lik_fixedeffects_valence)

save(EMM_Mapping_Valence, file = "EMM_Mapping_Valence.Rdata")


Mapping_Medians_HDIs <- 
  rbind(Correlations_BSI_VAS2Lik_summary_stats %>% mutate(Model = "BSI_Mapping"),
  Correlations_DASS_S_VAS2Lik_summary_stats %>% mutate(Model = "DASS_S_Mapping"),
      Correlations_DASS_A_VAS2Lik_summary_stats %>% mutate(Model = "DASS_A_Mapping"),
      Correlations_DASS_D_VAS2Lik_summary_stats  %>% mutate(Model = "DASS_D_Mapping"))

save(Mapping_Medians_HDIs, file = "Mapping_Medians_HDIs.Rdata")

```


## Appendix figures

### Figure: pp Checks

```{r}

##Unnessecary after objects import
pp_Mean <- pp_check(mod_Mean_zib_noLiktoVAS_fit, ndraws = 30) +
  labs(title = "Means") + theme(plot.title = element_text(size=10))
pp_SD <- pp_check(mod_SD_zib_noLiktoVAS_fit, ndraws = 30) +
  labs(title = "Standard deviations") + theme(plot.title = element_text(size=10))
pp_CorLag0 <- pp_check(mod_CorLag0_beta_noLiktoVAS_fit, ndraws = 30) +
  labs(title = "Average interitem correlations") + theme(plot.title = element_text(size=10))
pp_Skew <- pp_check(mod_Skew_noLiktoVAS_fit, ndraws = 30) +
  labs(title = "Skewnesses") + theme(plot.title = element_text(size=10))
pp_RMSSD <- pp_check(mod_RMSSD_zib_noLiktoVAS_fit, ndraws = 30) +
  labs(title = "RMSSD") + theme(plot.title = element_text(size=10))
pp_AR <- pp_check(mod_AR_noLiktoVAS_fit, ndraws = 30) +
  labs(title = "Autocorrelations") + theme(plot.title = element_text(size=10))
pp_IEB <- pp_check(mod_IEB_noLiktoVAS_fit, ndraws = 30) +
  labs(title = "Initial elevation bias") + theme(plot.title = element_text(size=10))
pp_Mean_mapping <- pp_check(mod_Mean_zib_fit, ndraws = 30) +
  labs(title = "Means with VAS mapped to LIkert") + theme(plot.title = element_text(size=10))
pp_Modality <- pp_check(mod_Modality_noLiktoVAS_fit, ndraws = 30, type = "bars_grouped", group = "format") +
  labs(title = "Modality") + theme(plot.title = element_text(size=10))
pp_Missings <- pp_check(mod_Missings_zoib_noVAS2Lik_fit, ndraws = 30) +
  labs(title = "Missingness") + theme(plot.title = element_text(size=10))
pp_Duration <- pp_check(mod_duration_log_fit, ndraws = 30) +
  labs(title = "Duration") + theme(plot.title = element_text(size=10))
pp_Post_ExpNotif <- pp_check(model_post_fit, ndraws = 30, resp = "ExpNotif") +
  labs(title = "Post ExpNotif") + theme(plot.title = element_text(size=10))
pp_Post_Burden <- pp_check(model_post_fit, ndraws = 30, resp = "Burden") +
  labs(title = "Post Burden") + theme(plot.title = element_text(size=10))
pp_Post_Freq <- pp_check(model_post_fit, ndraws = 30, resp = "Freq") +
  labs(title = "Post Frequency") + theme(plot.title = element_text(size=10))
pp_Post_Clear <- pp_check(model_post_fit, ndraws = 30, resp = "Clear") +
  labs(title = "Post Clarity")  + theme(plot.title = element_text(size=10))
pp_Post_KnowAnswer <- pp_check(model_post_fit, ndraws = 30, resp = "KnowAnswer") +
  labs(title = "Post KnowAnswer") + theme(plot.title = element_text(size=10))
pp_Post_Infl <- pp_check(model_post_fit, ndraws = 30, resp = "Infl") +
  labs(title = "Post Infl") + theme(plot.title = element_text(size=10))

##Posterior predictive checks figure
pdf("pp_check.pdf", width = 6, height = 10)
grid.arrange(pp_Mean, pp_SD,
          pp_CorLag0, pp_Skew,
          pp_RMSSD, pp_AR,
          pp_IEB, pp_Mean_mapping,
          pp_Missings, 
          pp_Duration,
          pp_Modality,
          pp_Post_ExpNotif, pp_Post_Burden, pp_Post_Freq,
          pp_Post_Clear, pp_Post_KnowAnswer, pp_Post_Infl,
          ncol = 6,
         widths = c(1, 1, 1, 1, 1, 1),
  layout_matrix = rbind(c(1, 1, 1, 2, 2, 2),
                        c(3, 3, 3, 4, 4, 4),
                        c(5, 5, 5, 6, 6, 6),
                        c(7, 7, 7, 8, 8, 8),
                        c(9, 9, 9, 10, 10, 10),
                        c(11, 11, 11, 11, 11, 11),
                        c(12, 12, 13, 13, 14, 14),
                        c(15, 15, 16, 16, 17, 17))
)
dev.off()


```

### Figure: Means: Full results

```{r Means.results}

#import fitted model
load("mod_Mean_zib_noLiktoVAS_fit.Rdata")

#inspect model summary
summary(mod_Mean_zib_noLiktoVAS_fit)

#HPDIs
mod_Mean_zib_noLiktoVAS_fit %>%
  spread_draws(`b_.*`, regex = TRUE) %>% 
  mutate(across(starts_with("b_phi"), ~exp(.))) %>%
  mutate(across((!starts_with(".") & !starts_with("b_phi")), ~plogis(.))) %>%
  gather_variables() %>% 
  median_hdi()

#Plotting
posterior_Mean <- mod_Mean_zib_noLiktoVAS_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zi_"), "Zero", "Mu")),
         intercept = str_detect(.variable, "Intercept"))

posterior_Mean %<>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zi_formatVAS",
                                "valence" = "b_zi_valence",
                                "VAS:valence" = "b_zi_formatVAS:valence",
                                "Intercept" = "b_zi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence")))

ggplot(posterior_Mean, aes(x = .value, y = fct_rev(.variable), fill = component)) +
  geom_vline(xintercept = 0) +
  stat_halfeye(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(component), ncol = 1, scales = "free_y") +
  ggthemes::theme_clean() +
  theme(plot.background = element_rect(colour = "white"))

ggsave("ridge_Mean.pdf", dpi = 450, width = 7, height = 7)

#Descriptive check
#Variance higher in VAS than in Likert for means? Maybe only on negative valence-items?
#str(lv_m_long_noLiktoVAS)
#lv_m_long_noLiktoVAS_check <-lv_m_long_noLiktoVAS %>% mutate(format_valence = interaction(format, valence)) %>% filter(Mean > 0)

#describeBy(lv_m_long_noLiktoVAS_check$Mean, lv_m_long_noLiktoVAS_check$format_valence)
#Likert neg .12
#Likert pos .17 (no 0s: .16)
#VAS neg .15
#VAS pos .18
#- overall, higher SD on VAS, but very little and more on neg. valence items
#describeBy(lv_m_long_check$Mean, lv_m_long_check$format)
#sd = .21 for Likert, .25 for VAS (.24 for non-0s)

#describeBy(lv_m_long$Mean, lv_m_long$format_valence)

#Posterior predictive check
pp_check(mod_Mean_zib_noLiktoVAS_fit, ndraws = 30)

ggsave("ppcheck_Mean.pdf", dpi = 450, width = 6, height = 4)

## marginal effects
mod_Mean_zib_noLiktoVAS_fit %>% 
  avg_comparisons(variables = "format")

#Posterior predictives
#mod_Mean_pred <- mod_Mean_zib_noLiktoVAS_fit %>% 
#  epred_draws(lv_m_long_noLiktoVAS)
# 
# ggplot(mod_Mean_pred, aes(x = .epred, y = format, fill = format)) +
#   stat_halfeye(.width = c(0.90), point_interval = "median_hdi") +
#   scale_x_continuous(labels = label_percent()) +
#   scale_fill_viridis_d(option = "plasma", end = 0.8) +
#   guides(fill = "none") +
#   labs(x = "Predicted means by scale type", y = NULL,
#        caption = "90% credible interval shown in black") +
#   theme_clean() +
#   theme(plot.background = element_rect(colour = "white"))
# 
# describeBy(mod_Mean_pred$.epred, mod_Mean_pred$format)
# #SDs very well captured!
# #So, the SD is .03 larger in VAS than in Likert.
# 
# save(mod_Mean_pred, file = "mod_Mean_pred.Rdata")

###Check: Comparison of predicted means with Gaussian model

library(emmeans)
library(marginaleffects)
load("mod_Mean_zib_noLiktoVAS_fit.Rdata")
emmeans(mod_Mean_zib_noLiktoVAS_fit, ~ format, )

mod_Mean_zib_noLiktoVAS_fit
mod_Mean_normal_noLiktoVAS_fit

#conditional_effects(mod_Mean_zib_noLiktoVAS_fit, effects = "format")
#conditional_effects(mod_Mean_normal_noLiktoVAS_fit, effects = "format")

posterior_Mean <- mod_Mean_zib_noLiktoVAS_fit %>%
  gather_draws(`b_.*`, regex = TRUE) %>%
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zi_"), "Zero", "Mean")),
         intercept = str_detect(.variable, "Intercept"),
         Model = "Mean")

posterior_Mean_wider <- posterior_Mean %>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zi_formatVAS",
                                "valence" = "b_zi_valence",
                                "VAS:valence" = "b_zi_formatVAS:valence",
                                "Intercept" = "b_zi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence"))) %>%
  pivot_wider(values_from = ".value", names_from = c("component", ".variable"),
              id_cols = c(".chain", ".iteration", ".draw"))


posterior_Mean_Mean <- posterior_Mean_wider %>%
  mutate(Zero_Likert = plogis(Zero_Intercept),
         Zero_VAS = plogis(Zero_Intercept + Zero_VAS),
         Mean_Likert = (1-Zero_Likert)*plogis(Mean_Intercept),
         Mean_VAS = (1-Zero_VAS)*plogis(Mean_Intercept + Mean_VAS),
         Mean_Total = (Mean_Likert + Mean_VAS)/2,
         Mean_Diff = Mean_VAS - Mean_Likert)

describe(posterior_Mean_Mean)

posterior_Mean_Mean_long <- posterior_Mean_Mean %>%
  pivot_longer(cols = c(Mean_Likert, Mean_VAS, Mean_Diff),
               values_to = "value",
               names_to = "Parameter") %>%
  mutate(Model = "Mean")

posterior_Mean_Mean_summary_stats <- posterior_Mean_Mean %>%
  summarise(
    Mean_Mean_Likert_Median = median(Mean_Likert),
    Mean_Mean_Likert_HDI_Lower =bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_low,
    Mean_Mean_Likert_HDI_Upper =bayestestR::hdi(Mean_Likert, ci = 0.9)$CI_high,
    Mean_Mean_VAS_Median = median(Mean_VAS),
    Mean_Mean_VAS_HDI_Lower =bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_low,
    Mean_Mean_VAS_HDI_Upper =bayestestR::hdi(Mean_VAS, ci = 0.9)$CI_high,
    Mean_Mean_Total_Median = median(Mean_Total),
    Mean_Mean_Total_HDI_Lower =bayestestR::hdi(Mean_Total, ci = 0.9)$CI_low,
    Mean_Mean_Total_HDI_Upper =bayestestR::hdi(Mean_Total, ci = 0.9)$CI_high,
    Mean_Mean_Diff_Median = median(Mean_Diff),
    Mean_Mean_Diff_HDI_Lower =bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_low,
    Mean_Mean_Diff_HDI_Upper =bayestestR::hdi(Mean_Diff, ci = 0.9)$CI_high
  )
#conditional_effects(mod_Mean_zib_noLiktoVAS_fit, effects = "format") #Bugged!

Mean_Mean_Likert <- lv_m_long %>%
  filter(format == "Likert") %>%
  dplyr::select(Mean) %>% as.data.frame() %>% summarize(Mean_Lik = mean(Mean))
Mean_Mean_VAS <- lv_m_long %>%
  filter(format == "VAS") %>%
  dplyr::select(Mean) %>% as.data.frame() %>% summarize(Mean_VAS = mean(Mean))
Mean_Mean_Total <- lv_m_long %>%
  filter(format == "VAS" | format == "Likert") %>%
  dplyr::select(Mean) %>% as.data.frame() %>% summarize(Var_Lik = sd(Mean)^2)
Mean_Mean_Diff = Mean_Mean_VAS - Mean_Mean_Likert
Mean_Mean_Likert
Mean_Mean_VAS
Mean_Mean_Diff
#.16, .24 are observed medians. Observed means are much higher (.22 and .29; model-implied means are slightly below... that's ok fit is very good)

# Model estimated means from Gaussian model:

ce_Gaussian <- conditional_effects(mod_Mean_normal_noLiktoVAS_fit, effects = "format", prob = .90)

ce_Gaussian$format$estimate__
ce_Gaussian$format$lower__
ce_Gaussian$format$upper__

posterior_Mean_Mean_summary_stats$Mean_Mean_Likert_Median
posterior_Mean_Mean_summary_stats$Mean_Mean_Likert_HDI_Low
posterior_Mean_Mean_summary_stats$Mean_Mean_Likert_HDI_High

#Model estimated marginal means across formats are extremely similar for Gaussian and non-Gaussian models but CIs are wider in zero-inflated Beta-regression model

```


### Figure: SDs: Full results

```{r SDs.results}

load("mod_SD_zib_noLiktoVAS_fit.Rdata")

mod_SD_zib_noLiktoVAS_fit %>%
  spread_draws(`b_.*`, regex = TRUE) %>% 
  mutate(across(starts_with("b_phi"), ~exp(.))) %>%
  mutate(across((!starts_with(".") & !starts_with("b_phi")), ~plogis(.))) %>%
  gather_variables() %>% 
  median_hdi()

posterior_SD <- mod_SD_zib_noLiktoVAS_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zi_"), "Zero", "Mu")),
         intercept = str_detect(.variable, "Intercept"))

posterior_SD %<>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zi_formatVAS",
                                "valence" = "b_zi_valence",
                                "VAS:valence" = "b_zi_formatVAS:valence",
                                "Intercept" = "b_zi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence")))

ggplot(posterior_SD, aes(x = .value, y = fct_rev(.variable), fill = component)) +
  geom_vline(xintercept = 0) +
  stat_halfeye(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(component), ncol = 1, scales = "free_y") +
  ggthemes::theme_clean() +
  theme(plot.background = element_rect(colour = "white"))

ggsave("ridge_SD.pdf", dpi = 450, width = 7, height = 7)

pp_check(mod_SD_zib_noLiktoVAS_fit, ndraws = 30)

ggsave("ppcheck_SD.pdf", dpi = 450, width = 6, height = 4)

```

### Figure: Mean item correlations: Full results

```{r CorLag0.results}

load("mod_CorLag0_beta_noLiktoVAS_fit.Rdata")

summary(mod_CorLag0_beta_noLiktoVAS_fit)

mod_CorLag0_beta_noLiktoVAS_fit %>%
  spread_draws(`b_.*`, regex = TRUE) %>% 
  mutate(across(starts_with("b_phi"), ~exp(.))) %>%
  mutate(across((!starts_with(".") & !starts_with("b_phi")), ~plogis(.))) %>%
  gather_variables() %>% 
  median_hdi()

posterior_CorLag0 <- mod_CorLag0_beta_noLiktoVAS_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", "Mu"),
         intercept = str_detect(.variable, "Intercept"))

posterior_CorLag0 %<>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zi_formatVAS",
                                "valence" = "b_zi_valence",
                                "VAS:valence" = "b_zi_formatVAS:valence",
                                "Intercept" = "b_zi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence")))

ggplot(posterior_CorLag0, aes(x = .value, y = fct_rev(.variable), fill = component)) +
  geom_vline(xintercept = 0) +
  stat_halfeye(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(component), ncol = 1, scales = "free_y") +
  ggthemes::theme_clean() +
  theme(plot.background = element_rect(colour = "white"))

ggsave("ridge_CorLag0.pdf", dpi = 450, width = 7, height = 5)

pp_check(mod_CorLag0_beta_noLiktoVAS_fit, ndraws = 30)

ggsave("ppcheck_CorLag0.pdf", dpi = 450, width = 6, height = 4)

```


### Figure: Skewnesses: Full results

```{r skew.results}

load("mod_Skew_noLiktoVAS_fit.Rdata")

summary(mod_Skew_noLiktoVAS_fit)

mod_Skew_noLiktoVAS_fit %>%
  spread_draws(`b_.*`, regex = TRUE) %>% 
  mutate(across(starts_with("b_phi"), ~exp(.))) %>%
  mutate(across((!starts_with(".") & !starts_with("b_phi")), ~plogis(.))) %>%
  gather_variables() %>% 
  median_hdi()

posterior_Skew <- mod_Skew_noLiktoVAS_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "sigma_"), "Sigma", "Mu"),
         intercept = str_detect(.variable, "Intercept"))

posterior_Skew %<>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_sigma_formatVAS",
                                "valence" = "b_sigma_valence",
                                "VAS:valence" = "b_sigma_formatVAS:valence",
                                "Intercept" = "b_sigma_Intercept",
                                "VAS" = "b_alpha_formatVAS")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence")))

ggplot(posterior_Skew, aes(x = .value, y = fct_rev(.variable), fill = component)) +
  geom_vline(xintercept = 0) +
  stat_halfeye(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(component), ncol = 1, scales = "free_y") +
  ggthemes::theme_clean() +
  theme(plot.background = element_rect(colour = "white"))

ggsave("ridge_Skew.pdf", dpi = 450, width = 7, height = 5)

pp_check(mod_Skew_noLiktoVAS_fit, ndraws = 30)

ggsave("ppcheck_Skew.pdf", dpi = 450, width = 6, height = 4)

```


### Figure: RMSSD: Full results

```{r RMSSD.results}

load("mod_RMSSD_zib_noLiktoVAS_fit.Rdata")

summary(mod_RMSSD_zib_noLiktoVAS_fit)

mod_RMSSD_zib_noLiktoVAS_fit %>%
  spread_draws(`b_.*`, regex = TRUE) %>% 
  mutate(across(starts_with("b_phi"), ~exp(.))) %>%
  mutate(across((!starts_with(".") & !starts_with("b_phi")), ~plogis(.))) %>%
  gather_variables() %>% 
  median_hdi()

posterior_RMSSD <- mod_RMSSD_zib_noLiktoVAS_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zi_"), "Zero", "Mu")),
         intercept = str_detect(.variable, "Intercept"))

posterior_RMSSD %<>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zi_formatVAS",
                                "valence" = "b_zi_valence",
                                "VAS:valence" = "b_zi_formatVAS:valence",
                                "Intercept" = "b_zi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence")))

ggplot(posterior_RMSSD, aes(x = .value, y = fct_rev(.variable), fill = component)) +
  geom_vline(xintercept = 0) +
  stat_halfeye(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(component), ncol = 1, scales = "free_y") +
  ggthemes::theme_clean() +
  theme(plot.background = element_rect(colour = "white"))

ggsave("ridge_RMSSD.pdf", dpi = 450, width = 7, height = 7)

pp_check(mod_RMSSD_zib_noLiktoVAS_fit, ndraws = 30)

ggsave("ppcheck_RMSSD.pdf", dpi = 450, width = 6, height = 4)

```

### Figure: AR: Full results

```{r AR.results}

load("mod_AR_noLiktoVAS_fit.Rdata")

summary(mod_AR_noLiktoVAS_fit)

mod_AR_noLiktoVAS_fit %>%
  spread_draws(`b_.*`, regex = TRUE) %>% 
  mutate(across(starts_with("b_phi"), ~exp(.))) %>%
  mutate(across((!starts_with(".") & !starts_with("b_phi")), ~plogis(.))) %>%
  gather_variables() %>% 
  median_hdi()

posterior_AR <- mod_AR_noLiktoVAS_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "sigma_"), "Sigma", "Mu"),
         intercept = str_detect(.variable, "Intercept"))

posterior_AR %<>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_sigma_formatVAS",
                                "valence" = "b_sigma_valence",
                                "VAS:valence" = "b_sigma_formatVAS:valence",
                                "Intercept" = "b_sigma_Intercept",
                                "VAS" = "b_alpha_formatVAS")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence")))

ggplot(posterior_AR, aes(x = .value, y = fct_rev(.variable), fill = component)) +
  geom_vline(xintercept = 0) +
  stat_halfeye(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(component), ncol = 1, scales = "free_y") +
  ggthemes::theme_clean() +
  theme(plot.background = element_rect(colour = "white"))

ggsave("ridge_AR.pdf", dpi = 450, width = 7, height = 5)

pp_check(mod_AR_noLiktoVAS_fit, ndraws = 30)

ggsave("ppcheck_AR.pdf", dpi = 450, width = 6, height = 4)

```


### Figure: IEB: Full results

```{r IEB.results}

load("mod_IEB_noLiktoVAS_fit.Rdata")

summary(mod_IEB_noLiktoVAS_fit)

mod_IEB_noLiktoVAS_fit %>%
  spread_draws(`b_.*`, regex = TRUE) %>% 
  mutate(across(starts_with("b_sigma"), ~exp(.))) %>%
  gather_variables() %>% 
  median_hdi()

posterior_IEB <- mod_IEB_noLiktoVAS_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "sigma_"), "Sigma", "Mu"),
         intercept = str_detect(.variable, "Intercept"))

posterior_IEB %<>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_sigma_formatVAS",
                                "valence" = "b_sigma_valence",
                                "VAS:valence" = "b_sigma_formatVAS:valence",
                                "Intercept" = "b_sigma_Intercept",
                                "VAS" = "b_alpha_formatVAS")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence")))

ggplot(posterior_IEB, aes(x = .value, y = fct_rev(.variable), fill = component)) +
  geom_vline(xintercept = 0) +
  stat_halfeye(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(component), ncol = 1, scales = "free_y") +
  ggthemes::theme_clean() +
  theme(plot.background = element_rect(colour = "white"))

ggsave("ridge_IEB.pdf", dpi = 450, width = 7, height = 5)

pp_check(mod_IEB_noLiktoVAS_fit, ndraws = 30)

ggsave("ppcheck_IEB.pdf", dpi = 450, width = 6, height = 4)

```


### Figure: Modality: Full results

```{r Modality.results}

load("mod_Modality_noLiktoVAS_fit.Rdata")

summary(mod_Modality_noLiktoVAS_fit)

posterior_Modality <- mod_Modality_noLiktoVAS_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = "Mu",
         intercept = str_detect(.variable, "Intercept"))

posterior_Modality %<>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence")))

ggplot(posterior_Modality, aes(x = .value, y = fct_rev(.variable), fill = component)) +
  geom_vline(xintercept = 0) +
  stat_halfeye(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(component), ncol = 1, scales = "free_y") +
  ggthemes::theme_clean() +
  theme(plot.background = element_rect(colour = "white"))

ggsave("ridge_Modality.pdf", dpi = 450, width = 7, height = 2)

pp_check(mod_Modality_noLiktoVAS_fit, ndraws = 30, type = "bars_grouped", group = "format")

ggsave("ppcheck_Modality.pdf", dpi = 450, width = 6, height = 4)

#describeBy(lv_Modality_long_noLiktoVAS$Modality, lv_m_long_noLiktoVAS$format)

```

### Figure: Mapping: Full results

```{r Mapping.results}

#import fitted model
load("mod_Mean_zib_fit.Rdata")

#inspect model summary
summary(mod_Mean_zib_fit)

#HPDIs
mod_Mean_zib_fit %>%
  spread_draws(`b_.*`, regex = TRUE) %>% 
  mutate(across(starts_with("b_phi"), ~exp(.))) %>%
  mutate(across((!starts_with(".") & !starts_with("b_phi")), ~plogis(.))) %>%
  gather_variables() %>% 
  median_hdi()

#Plotting
posterior_Mapping <- mod_Mean_zib_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zi_"), "Zero", "Mu")),
         intercept = str_detect(.variable, "Intercept"))

posterior_Mapping %<>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "valence" = "b_valence",
                                "VAS:valence" = "b_formatVAS:valence",
                                "Intercept" = "b_Intercept",
                                "Mapping" = "b_formatVAS2Lik",
                                "Mapping:valence" = "b_formatVAS2Lik:valence",
                                "VAS" = "b_phi_formatVAS",
                                "Mapping" = "b_phi_formatVAS2Lik",
                                "valence" = "b_phi_valence",
                                "VAS:valence" = "b_phi_formatVAS:valence",
                                "Mapping:valence" = "b_phi_formatVAS2Lik:valence",
                                "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zi_formatVAS",
                                "valence" = "b_zi_valence",
                                "VAS:valence" = "b_zi_formatVAS:valence",
                                "Intercept" = "b_zi_Intercept",
                                                                "Mapping" = "b_zi_formatVAS2Lik",
                                "Mapping:valence" = "b_zi_formatVAS2Lik:valence")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS", "valence", "VAS:valence")))

ggplot(posterior_Mapping, aes(x = .value, y = fct_rev(.variable), fill = component)) +
  geom_vline(xintercept = 0) +
  stat_halfeye(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(component), ncol = 1, scales = "free_y") +
  ggthemes::theme_clean() +
  theme(plot.background = element_rect(colour = "white"))

ggsave("ridge_Mapping.pdf", dpi = 450, width = 7, height = 7)

```

### Figure: Missings: Full results

```{r missings.fit}


load("mod_Missings_zoib_noVAS2Lik_fit.Rdata")

summary(mod_Missings_zoib_noVAS2Lik_fit, robust = TRUE)

#HPDIs
mod_Missings_zoib_noVAS2Lik_fit %>%
  spread_draws(`b_.*`, regex = TRUE) %>% 
  mutate(across(starts_with("b_phi"), ~exp(.))) %>%
  mutate(across((!starts_with(".") & !starts_with("b_phi")), ~plogis(.))) %>%
  gather_variables() %>% 
  median_hdi()

#Plotting
posterior_Missings <- mod_Missings_zoib_noVAS2Lik_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "phi_"), "Precision", ifelse(str_detect(.variable, "zoi_"), "Zero/One", ifelse(str_detect(.variable, "coi_"), "One","Mu"))),
         intercept = str_detect(.variable, "Intercept"))

posterior_Missings %<>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                 "Intercept" = "b_Intercept",
                                "VAS" = "b_phi_formatVAS",
                                 "Intercept" = "b_phi_Intercept",
                                "VAS" = "b_zoi_formatVAS",
                                 "Intercept" = "b_zoi_Intercept",
                                "VAS" = "b_coi_formatVAS",
                                 "Intercept" = "b_coi_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS")))

posterior_Missings %<>% mutate(component = fct_relevel(component,
                                                       c("Mu",
                                                         "Precision",
                                                         "Zero/One",
                                                         "One")))

ggplot(posterior_Missings, aes(x = .value, y = fct_rev(.variable), fill = component)) +
  geom_vline(xintercept = 0) +
  stat_halfeye(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "", y = "") +
  facet_wrap(vars(component), ncol = 1, scales = "free_y") +
  ggthemes::theme_clean() +
  theme(plot.background = element_rect(colour = "white"))

ggsave("ridge_Missings.pdf", dpi = 450, width = 7, height = 5)

## marginal effects
mod_Missings_zoib_noVAS2Lik_fit %>% 
  avg_comparisons(variables = "format")

#Posterior predictives
# mod_Missings_pred <- mod_Missings_zoib_noVAS2Lik_fit %>% 
#   epred_draws(NA_dat)
# 
# ggplot(mod_Missings_pred, aes(x = .epred, y = format, fill = format)) +
#   stat_halfeye(.width = c(0.90), point_interval = "median_hdi") +
#   scale_x_continuous(labels = label_percent()) +
#   scale_fill_viridis_d(option = "plasma", end = 0.8) +
#   guides(fill = "none") +
#   labs(x = "Predicted means by scale type", y = NULL,
#        caption = "90% credible interval shown in black") +
#   theme_clean() +
#   theme(plot.background = element_rect(colour = "white"))
# 
# describeBy(mod_Missings_pred$.epred, mod_Missings_pred$format)
#Missings very well captured!
#So, the proportion of missings is .03 smaller in VAS than in Likert.

save(mod_Missings_pred, file = "mod_Missings_pred.Rdata")

describeBy(NA_dat$prop_missing, NA_dat$format)

str(posterior_Missings)

bayestestR::hdi(mod_Missings_zoib_noVAS2Lik_fit, level = .90)

```

### Figure: Duration: Full results

```{r duration.results}

load("mod_duration_log_fit.Rdata")

summary(mod_duration_log_fit)

mod_duration_log_fit %>%
  spread_draws(`b_.*`, regex = TRUE) %>% 
  mutate(across(starts_with("b_sigma"), ~exp(.))) %>%
  gather_variables() %>% 
  median_hdi()

posterior_duration <- mod_duration_log_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "sigma_"), "Sigma", "Mu"),
         intercept = str_detect(.variable, "Intercept"))

posterior_duration %<>%
  mutate(.variable = fct_recode(.variable,
                                "VAS" = "b_formatVAS",
                                "Intercept" = "b_Intercept",
                                "VAS" = "b_sigma_formatVAS",
                                "Intercept" = "b_sigma_Intercept")) %>%
  mutate(.variable = fct_relevel(.variable,
                                 c("Intercept", "VAS")))

ggplot(posterior_duration, aes(x = .value, y = fct_rev(.variable), fill = component)) +
  geom_vline(xintercept = 0) +
  stat_halfeye(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(component), ncol = 1, scales = "free") +
  ggthemes::theme_clean() +
  theme(plot.background = element_rect(colour = "white"))

ggsave("ridge_duration.pdf", dpi = 450, width = 7, height = 3)

pp_check(mod_duration_fit, ndraws = 30)

ggsave("ppcheck_duration.pdf", dpi = 450, width = 6, height = 4)

```


### Figure: Post questionnaire

```{r fig.post}

load("model_post_fit.Rdata")

summary(model_post_fit)

conditional_effects(model_post_fit)

posterior_post <- model_post_fit %>% 
  gather_draws(`b_.*`, regex = TRUE) %>% 
  mutate(component = ifelse(str_detect(.variable, "disc_"), "disc", "Mu"),
         intercept = str_detect(.variable, "Intercept"))

posterior_post %<>%
  mutate(.variable = str_remove(.variable, "^b_disc_")) %>%
  mutate(.variable = str_remove(.variable, "^b_")) %>%
  separate(.variable, into = c("Variable", "Parameter"), sep = "_")

posterior_post_wider <- posterior_post %>%
  pivot_wider(names_from = "Parameter",
              values_from = ".value",
              id_cols = c("component", "Variable", ".draw"))

summary(model_post_fit)

#exp(-.04)
#latent_variance <- (pi^2 / 3) * 0.96^2
#1.25^2
#1/exp(-.04)

describe(data_post[data_post$Group == "Likert",]$ExpNotif)
describe(data_post[data_post$Group == "VAS",]$ExpNotif)
describe(data_post$Clear)

posterior_post %<>% mutate(component = fct_relevel(component,
                                                       c("Mu",
                                                         "disc")))

ggplot(posterior_post, aes(x = .value, y = fct_rev(interaction(Parameter, Variable)), fill = component)) +
  geom_vline(xintercept = 0) +
  stat_halfeye(aes(slab_alpha = intercept), 
               .width = c(0.9, 0.9), point_interval = "median_hdi") +
  scale_fill_viridis_d(option = "viridis", end = 0.6) +
  scale_slab_alpha_discrete(range = c(0.9, 0.9)) +
  guides(fill = "none", slab_alpha = "none") +
  labs(x = "Coefficient", y = "Parameter") +
  facet_wrap(vars(component), ncol = 1, scales = "free") +
  ggthemes::theme_clean() +
  theme(plot.background = element_rect(colour = "white")) +
  scale_x_continuous(limits = c(-10, 10))

ggsave("ridge_post.pdf", dpi = 450, width = 7, height = 10)

pp_check(model_post_fit, ndraws = 30, resp = "ExpNotif")
ggsave("ppcheck_post_ExpNotif.pdf", dpi = 450, width = 6, height = 4)
pp_check(model_post_fit, ndraws = 30, resp = "Burden")
ggsave("ppcheck_post_Burden.pdf", dpi = 450, width = 6, height = 4)
pp_check(model_post_fit, ndraws = 30, resp = "Freq")
ggsave("ppcheck_post_Freq.pdf", dpi = 450, width = 6, height = 4)
pp_check(model_post_fit, ndraws = 30, resp = "Clear")
ggsave("ppcheck_post_Clear.pdf", dpi = 450, width = 6, height = 4)
pp_check(model_post_fit, ndraws = 30, resp = "KnowAnswer")
ggsave("ppcheck_post_KnowAnswer.pdf", dpi = 450, width = 6, height = 4)
pp_check(model_post_fit, ndraws = 30, resp = "Infl")
ggsave("ppcheck_post_Infl.pdf", dpi = 450, width = 6, height = 4)


```


